<ManagementPack xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ContentReadable="true" SchemaVersion="2.0" OriginalSchemaVersion="2.0"><Manifest><Identity><ID>Microsoft.Windows.Server.2016.ProcessPortMonitoring</ID><Version>10.1.1.0</Version></Identity><Name>Microsoft.Windows.Server.2016.ProcessPortMonitoring</Name><References><Reference Alias="SCDW"><ID>Microsoft.SystemCenter.DataWarehouse.Library</ID><Version>7.1.10226.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="DWReport"><ID>Microsoft.SystemCenter.DataWarehouse.Report.Library</ID><Version>7.1.10226.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="SC"><ID>Microsoft.SystemCenter.Library</ID><Version>7.0.8433.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="OM"><ID>Microsoft.SystemCenter.OperationsManager.Library</ID><Version>7.1.10226.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="Windows"><ID>Microsoft.Windows.Library</ID><Version>7.5.8501.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="Health"><ID>System.Health.Library</ID><Version>7.0.8433.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="System"><ID>System.Library</ID><Version>7.5.8501.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="Perf"><ID>System.Performance.Library</ID><Version>7.0.8433.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="Visualization"><ID>Microsoft.SystemCenter.Visualization.Library</ID><Version>7.1.10226.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="Server2016"><ID>Microsoft.Windows.Server.2016.Discovery</ID><Version>10.1.1.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference><Reference Alias="WindowsServer"><ID>Microsoft.Windows.Server.Library</ID><Version>10.1.1.0</Version><PublicKeyToken>31bf3856ad364e35</PublicKeyToken></Reference></References></Manifest><TypeDefinitions><EntityTypes><ClassTypes><ClassType ID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Accessibility="Public" Abstract="false" Base="System!System.Group" Hosted="false" Singleton="true" Extension="false"/><ClassType ID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group" Accessibility="Public" Abstract="false" Base="System!System.Group" Hosted="false" Singleton="true" Extension="false"/><ClassType ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Seed.Group" Accessibility="Public" Abstract="false" Base="System!System.Group" Hosted="false" Singleton="true" Extension="false"/><ClassType ID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Accessibility="Public" Abstract="false" Base="System!System.Group" Hosted="false" Singleton="true" Extension="false"/><ClassType ID="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group" Accessibility="Public" Abstract="false" Base="System!System.Group" Hosted="false" Singleton="true" Extension="false"/><ClassType ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" Accessibility="Public" Abstract="false" Base="WindowsServer!Microsoft.Windows.Server.ProcessSeed" Hosted="true" Singleton="false" Extension="false"/></ClassTypes><RelationshipTypes><RelationshipType ID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.ContainsWindowsServer.10.0.Computer" Accessibility="Public" Abstract="false" Base="System!System.Containment"><Source ID="Source" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group"/><Target ID="Target" MinCardinality="0" MaxCardinality="2147483647" Type="Server2016!Microsoft.Windows.Server.10.0.Computer"/></RelationshipType><RelationshipType ID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.ContainsWindowsServer.10.0.Computer" Accessibility="Public" Abstract="false" Base="System!System.Containment"><Source ID="Source" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group"/><Target ID="Target" MinCardinality="0" MaxCardinality="2147483647" Type="Server2016!Microsoft.Windows.Server.10.0.Computer"/></RelationshipType><RelationshipType ID="Microsoft.Windows.Server.10.0.ProcessMonitoringSeedGroup.ContainsProcessSeed" Accessibility="Public" Abstract="false" Base="System!System.Containment"><Source ID="Source" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.ProcessMonitoring.Seed.Group"/><Target ID="Target" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"/></RelationshipType><RelationshipType ID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed" Accessibility="Public" Abstract="false" Base="System!System.Containment"><Source ID="Source" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group"/><Target ID="Target" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"/></RelationshipType><RelationshipType ID="Microsoft.Windows.Server.10.0.PortMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed" Accessibility="Public" Abstract="false" Base="System!System.Containment"><Source ID="Source" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group"/><Target ID="Target" MinCardinality="0" MaxCardinality="2147483647" Type="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"/></RelationshipType></RelationshipTypes></EntityTypes><DataTypes><DataType ID="Microsoft.Windows.Server.10.0.DataItemProcessHealthState.Type" Accessibility="Public" Base="Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type"><Implementation><Assembly>Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.DataTypes.DataItemProcessHealthState</Type></Implementation></DataType><DataType ID="Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type" Accessibility="Public" Base="System!System.BaseData"><Implementation><Assembly>Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.DataTypes.ProcessInfoDataItem</Type></Implementation></DataType><DataType ID="Microsoft.Windows.Server.10.0.DataItemProcessPerformance.Type" Accessibility="Public" Base="Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type"><Implementation><Assembly>Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.DataTypes.DataItemProcessPerformance</Type></Implementation></DataType><DataType ID="Microsoft.Windows.Server.10.0.DataItemProcessPort.Type" Accessibility="Public" Base="Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type"><Implementation><Assembly>Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.DataTypes.DataItemProcessPort</Type></Implementation></DataType><DataType ID="Microsoft.Windows.Server.10.0.DataItemProcessState.Type" Accessibility="Public" Base="Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type"><Implementation><Assembly>Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.DataTypes.DataItemProcessState</Type></Implementation></DataType><DataType ID="Microsoft.Windows.Server.10.0.ProcessAlertData.Type" Accessibility="Public" Base="System!System.BaseData"><Implementation><Assembly>Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.DataTypes.DataItemProcessAlert</Type></Implementation></DataType></DataTypes><SecureReferences><SecureReference ID="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" Accessibility="Public" Context="System!System.Entity"/></SecureReferences><ModuleTypes><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.AlertSubscription.DataSource" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ChannelId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DropItems" type="xsd:boolean"/></Configuration><ModuleImplementation Isolation="Any"><Native><ClassID>8DB8C3B0-3AB0-494a-A09B-5F3643CC27A7</ClassID></Native></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.ProcessAlertData.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Port.DWSubscription.DataSource.Inner" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ChannelId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DropItems" type="xsd:boolean"/></Configuration><ModuleImplementation Isolation="Any"><Native><ClassID>8DB8C3B0-3AB0-494a-A09B-5F3643CC27A7</ClassID></Native></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessPort.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Port.DWSubscription.DataSource" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ChannelId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DropItems" type="xsd:boolean"/></Configuration><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="Data" TypeID="Microsoft.Windows.Server.10.0.Port.DWSubscription.DataSource.Inner"><ManagementGroupId>$Config/ManagementGroupId$</ManagementGroupId><ChannelId>$Config/ChannelId$</ChannelId><DropItems>$Config/DropItems$</DropItems></DataSource></MemberModules><Composition><Node ID="Data"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessPort.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.HealthState.DWSubscription.DataSource.Inner" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ChannelId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DropItems" type="xsd:boolean"/></Configuration><ModuleImplementation Isolation="Any"><Native><ClassID>8DB8C3B0-3AB0-494a-A09B-5F3643CC27A7</ClassID></Native></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessHealthState.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.ProcessInfo.DWSubscription.HealthState.DataSource" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ChannelId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DropItems" type="xsd:boolean"/></Configuration><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="Data" TypeID="Microsoft.Windows.Server.10.0.Process.HealthState.DWSubscription.DataSource.Inner"><ManagementGroupId>$Config/ManagementGroupId$</ManagementGroupId><ChannelId>$Config/ChannelId$</ChannelId><DropItems>$Config/DropItems$</DropItems></DataSource></MemberModules><Composition><Node ID="Data"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessHealthState.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.DWSubscription.DataSource.Inner" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ChannelId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DropItems" type="xsd:boolean"/></Configuration><ModuleImplementation Isolation="Any"><Native><ClassID>8DB8C3B0-3AB0-494a-A09B-5F3643CC27A7</ClassID></Native></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessPerformance.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.ProcessInfo.DWSubscription.PerfMetrics.DataSource" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ChannelId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DropItems" type="xsd:boolean"/></Configuration><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="Data" TypeID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.DWSubscription.DataSource.Inner"><ManagementGroupId>$Config/ManagementGroupId$</ManagementGroupId><ChannelId>$Config/ChannelId$</ChannelId><DropItems>$Config/DropItems$</DropItems></DataSource></MemberModules><Composition><Node ID="Data"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessPerformance.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagedEntityId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="HandleCountIncreaseThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MemoryPercentageThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="PercentProcessorTimeThreshold" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="SampleCount" Selector="$Config/SampleCount$" ParameterType="int"/><OverrideableParameter ID="HandleCountIncreaseThreshold" Selector="$Config/HandleCountIncreaseThreshold$" ParameterType="int"/><OverrideableParameter ID="MemoryPercentageThreshold" Selector="$Config/MemoryPercentageThreshold$" ParameterType="int"/><OverrideableParameter ID="PercentProcessorTimeThreshold" Selector="$Config/PercentProcessorTimeThreshold$" ParameterType="int"/><OverrideableParameter ID="MonitoringConfiguration" Selector="$Config/MonitoringConfiguration$" ParameterType="string"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="DataSource" TypeID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource.Internal"><MonitoringConfiguration>$Config/MonitoringConfiguration$</MonitoringConfiguration><LogLevel>$Config/LogLevel$</LogLevel><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ManagedEntityId>$Config/ManagedEntityId$</ManagedEntityId><IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds><SampleCount>$Config/SampleCount$</SampleCount><HandleCountIncreaseThreshold>$Config/HandleCountIncreaseThreshold$</HandleCountIncreaseThreshold><MemoryPercentageThreshold>$Config/MemoryPercentageThreshold$</MemoryPercentageThreshold><PercentProcessorTimeThreshold>$Config/PercentProcessorTimeThreshold$</PercentProcessorTimeThreshold></DataSource></MemberModules><Composition><Node ID="DataSource"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessHealthState.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource.Internal" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagedEntityId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="HandleCountIncreaseThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MemoryPercentageThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="PercentProcessorTimeThreshold" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="SampleCount" Selector="$Config/SampleCount$" ParameterType="int"/><OverrideableParameter ID="HandleCountIncreaseThreshold" Selector="$Config/HandleCountIncreaseThreshold$" ParameterType="int"/><OverrideableParameter ID="MemoryPercentageThreshold" Selector="$Config/MemoryPercentageThreshold$" ParameterType="int"/><OverrideableParameter ID="PercentProcessorTimeThreshold" Selector="$Config/PercentProcessorTimeThreshold$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.HealthStateCollectionDS</Type></Managed></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessHealthState.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Port.PerfMetrics.Collection.DataSource" Accessibility="Public" Batching="true"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagedEntityId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="MonitoringConfiguration" Selector="$Config/MonitoringConfiguration$" ParameterType="string"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.PortStateCollectionDS</Type></Managed></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessPort.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagedEntityId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="MonitoringConfiguration" Selector="$Config/MonitoringConfiguration$" ParameterType="string"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="DataSource" TypeID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource.Internal"><MonitoringConfiguration>$Config/MonitoringConfiguration$</MonitoringConfiguration><LogLevel>$Config/LogLevel$</LogLevel><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ManagedEntityId>$Config/ManagedEntityId$</ManagedEntityId><IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds></DataSource></MemberModules><Composition><Node ID="DataSource"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessPort.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource.Internal" Accessibility="Internal" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagementGroupId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="ManagedEntityId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.PerfMetricsCollectionDS</Type></Managed></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.DataItemProcessPort.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.ProcessCountMonitoring.Inner.DataSource" Accessibility="Public" Batching="true"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" maxOccurs="1" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" maxOccurs="1" name="ManagedEntityId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" maxOccurs="1" name="RuleId" type="xsd:string"/></Configuration><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.ProcessCountMonitoring</Type></Managed></ModuleImplementation><OutputType>Perf!System.Performance.Data</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.CountMonitoring.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SyncTime" type="xsd:string"/></Configuration><OverrideableParameters><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="Probe" TypeID="Microsoft.Windows.Server.10.0.ProcessCountMonitoring.Inner.DataSource"><IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds><ManagedEntityId>$Target/Id$</ManagedEntityId><RuleId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessCount.Collection"]$</RuleId></DataSource></MemberModules><Composition><Node ID="Probe"/></Composition></Composite></ModuleImplementation><OutputType>Perf!System.Performance.Data</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="HandleCountIncreaseThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="SampleCount" Selector="$Config/SampleCount$" ParameterType="int"/><OverrideableParameter ID="HandleCountIncreaseThreshold" Selector="$Config/HandleCountIncreaseThreshold$" ParameterType="int"/><OverrideableParameter ID="MonitoringConfiguration" Selector="$Config/MonitoringConfiguration$" ParameterType="string"/><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="DS" TypeID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource"><MonitoringConfiguration>$Config/MonitoringConfiguration$</MonitoringConfiguration><IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds><SampleCount>$Config/SampleCount$</SampleCount><HandleCountIncreaseThreshold>$Config/HandleCountIncreaseThreshold$</HandleCountIncreaseThreshold><MemoryPercentageThreshold>50</MemoryPercentageThreshold><PercentProcessorTimeThreshold>50</PercentProcessorTimeThreshold><SeedId>$Target/Id$</SeedId><LogLevel>$Config/LogLevel$</LogLevel></DataSource></MemberModules><Composition><Node ID="DS"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.ProcessAlertData.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.HandleCountMonitoring.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="TimeoutSeconds" type="xsd:integer"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="Threshold" type="xsd:int"/></Configuration><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.ProcessHandleCountMonitoring</Type></Managed></ModuleImplementation><OutputType>System!System.PropertyBagData</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="HandleCountIncreaseThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MemoryPercentageThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="PercentProcessorTimeThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SeedId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="SampleCount" Selector="$Config/SampleCount$" ParameterType="int"/><OverrideableParameter ID="HandleCountIncreaseThreshold" Selector="$Config/HandleCountIncreaseThreshold$" ParameterType="int"/><OverrideableParameter ID="MemoryPercentageThreshold" Selector="$Config/MemoryPercentageThreshold$" ParameterType="int"/><OverrideableParameter ID="PercentProcessorTimeThreshold" Selector="$Config/PercentProcessorTimeThreshold$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.ProcessAlertDS</Type></Managed></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.ProcessAlertData.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MemoryPercentageThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="SampleCount" Selector="$Config/SampleCount$" ParameterType="int"/><OverrideableParameter ID="MemoryPercentageThreshold" Selector="$Config/MemoryPercentageThreshold$" ParameterType="int"/><OverrideableParameter ID="MonitoringConfiguration" Selector="$Config/MonitoringConfiguration$" ParameterType="string"/><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="DS" TypeID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource"><MonitoringConfiguration>$Config/MonitoringConfiguration$</MonitoringConfiguration><IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds><SampleCount>$Config/SampleCount$</SampleCount><HandleCountIncreaseThreshold>20</HandleCountIncreaseThreshold><MemoryPercentageThreshold>$Config/MemoryPercentageThreshold$</MemoryPercentageThreshold><PercentProcessorTimeThreshold>50</PercentProcessorTimeThreshold><SeedId>$Target/Id$</SeedId><LogLevel>$Config/LogLevel$</LogLevel></DataSource></MemberModules><Composition><Node ID="DS"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.ProcessAlertData.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.Monitoring.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="TimeoutSeconds" type="xsd:integer"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/></Configuration><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.ProcessMonitoring</Type></Managed></ModuleImplementation><OutputType>System!System.PropertyBagData</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="MonitoringConfiguration" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="SampleCount" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="PercentProcessorTimeThreshold" type="xsd:int"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="0" maxOccurs="1" name="LogLevel" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/><OverrideableParameter ID="SampleCount" Selector="$Config/SampleCount$" ParameterType="int"/><OverrideableParameter ID="PercentProcessorTimeThreshold" Selector="$Config/PercentProcessorTimeThreshold$" ParameterType="int"/><OverrideableParameter ID="MonitoringConfiguration" Selector="$Config/MonitoringConfiguration$" ParameterType="string"/><OverrideableParameter ID="LogLevel" Selector="$Config/LogLevel$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="DS" TypeID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource"><MonitoringConfiguration>$Config/MonitoringConfiguration$</MonitoringConfiguration><IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds><SampleCount>$Config/SampleCount$</SampleCount><HandleCountIncreaseThreshold>20</HandleCountIncreaseThreshold><MemoryPercentageThreshold>50</MemoryPercentageThreshold><PercentProcessorTimeThreshold>$Config/PercentProcessorTimeThreshold$</PercentProcessorTimeThreshold><SeedId>$Target/Id$</SeedId><LogLevel>$Config/LogLevel$</LogLevel></DataSource></MemberModules><Composition><Node ID="DS"/></Composition></Composite></ModuleImplementation><OutputType>Microsoft.Windows.Server.10.0.ProcessAlertData.Type</OutputType></DataSourceModuleType><DataSourceModuleType ID="Microsoft.Windows.Server.10.0.ProcessSeedDiscovery.ModuleType" Accessibility="Public" Batching="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="IntervalSeconds" type="xsd:int"/></Configuration><OverrideableParameters><OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int"/></OverrideableParameters><ModuleImplementation Isolation="Any"><Composite><MemberModules><DataSource ID="Scheduler" TypeID="System!System.Discovery.Scheduler"><Scheduler><SimpleReccuringSchedule><Interval Unit="Seconds">$Config/IntervalSeconds$</Interval></SimpleReccuringSchedule><ExcludeDates/></Scheduler></DataSource><ConditionDetection ID="CD" TypeID="System!System.Discovery.ClassSnapshotDataMapper"><ClassId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"]$</ClassId><InstanceSettings><Settings><Setting><Name>$MPElement[Name="System!System.Entity"]/DisplayName$</Name><Value>Windows Process Monitoring ($Target/Property[Type="System!System.Entity"]/DisplayName$)</Value></Setting><Setting><Name>$MPElement[Name="Windows!Microsoft.Windows.Computer"]/PrincipalName$</Name><Value>$Target/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</Value></Setting></Settings></InstanceSettings></ConditionDetection></MemberModules><Composition><Node ID="CD"><Node ID="Scheduler"/></Node></Composition></Composite></ModuleImplementation><OutputType>System!System.Discovery.Data</OutputType></DataSourceModuleType><ProbeActionModuleType ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProbeAction" Accessibility="Public" Batching="true" PassThrough="false"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" maxOccurs="1" name="TimeoutSeconds" type="xsd:integer"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" maxOccurs="1" name="Process" type="xsd:string"/></Configuration><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.ProcessMonitoring</Type></Managed></ModuleImplementation><OutputType>System!System.PropertyBagData</OutputType><TriggerOnly>true</TriggerOnly></ProbeActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.CloseAlertWriteAction" Accessibility="Public" Batching="true"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="TimeoutSeconds" type="xsd:integer"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="RuleId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="Metric" type="xsd:string"/></Configuration><ModuleImplementation Isolation="Any"><Managed><Assembly>Microsoft.Windows.Server.2016.Modules.Assembly</Assembly><Type>Microsoft.Windows.Server.Modules.Monitoring.CloseAlertWA</Type></Managed></ModuleImplementation><InputType>Microsoft.Windows.Server.10.0.ProcessAlertData.Type</InputType></WriteActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.GenerateAlertWriteAction" Accessibility="Internal" Batching="true"><Configuration><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" name="AlertMessageId" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" name="Threshold" type="xsd:string"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" minOccurs="1" name="Metric" type="xsd:string"/></Configuration><ModuleImplementation Isolation="Any"><Composite><MemberModules><ConditionDetection ID="CD" TypeID="System!System.ExpressionFilter"><Expression><SimpleExpression><ValueExpression><XPathQuery Type="String">$Config/Metric$</XPathQuery></ValueExpression><Operator>Equal</Operator><ValueExpression><Value Type="String">true</Value></ValueExpression></SimpleExpression></Expression></ConditionDetection><WriteAction ID="WA" TypeID="Health!System.Health.GenerateAlert"><Priority>2</Priority><Severity>2</Severity><AlertMessageId>$Config/AlertMessageId$</AlertMessageId><AlertParameters><AlertParameter1>$Data/ProcessId$</AlertParameter1><AlertParameter2>$Data/ProcessName$</AlertParameter2><AlertParameter3>$Config/Threshold$</AlertParameter3></AlertParameters><Suppression><SuppressionValue>$Data/ProcessId$ $Data/ProcessName$</SuppressionValue></Suppression><Custom1>$Data/ProcessName$</Custom1><Custom2>$Data/ProcessId$</Custom2></WriteAction></MemberModules><Composition><Node ID="WA"><Node ID="CD"/></Node></Composition></Composite></ModuleImplementation><InputType>System!System.BaseData</InputType></WriteActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.Process.HealthStatePublish.WriteAction" Accessibility="Internal" Batching="false"><Configuration/><ModuleImplementation Isolation="Any"><Composite><MemberModules><WriteAction ID="WA" TypeID="System!System.PublishData"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ChannelId>$MPElement[Name="Microsoft.Windows.Server.10.0.Process.HealthState.Collection"]$</ChannelId></WriteAction></MemberModules><Composition><Node ID="WA"/></Composition></Composite></ModuleImplementation><InputType>System!System.BaseData</InputType></WriteActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.Process.PerfMetricsPublish.WriteAction" Accessibility="Internal" Batching="false"><Configuration/><ModuleImplementation Isolation="Any"><Composite><MemberModules><WriteAction ID="WA" TypeID="System!System.PublishData"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ChannelId>$MPElement[Name="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection"]$</ChannelId></WriteAction></MemberModules><Composition><Node ID="WA"/></Composition></Composite></ModuleImplementation><InputType>System!System.BaseData</InputType></WriteActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.Process.PortsPublish.WriteAction" Accessibility="Internal" Batching="false"><Configuration/><ModuleImplementation Isolation="Any"><Composite><MemberModules><WriteAction ID="WA" TypeID="System!System.PublishData"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ChannelId>$MPElement[Name="Microsoft.Windows.Server.10.0.Process.Ports.Collection"]$</ChannelId></WriteAction></MemberModules><Composition><Node ID="WA"/></Composition></Composite></ModuleImplementation><InputType>System!System.BaseData</InputType></WriteActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.Process.HealthStateDW.WriteAction" Accessibility="Internal" Batching="false"><Configuration/><ModuleImplementation Isolation="Any"><Composite><MemberModules><WriteAction ID="WA" TypeID="SCDW!Microsoft.SystemCenter.DataWarehouse.BulkInsertBulkDataWriter"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><DataSetId>$MPElement[Name='Microsoft.Windows.Server.10.0.HealthStatesCollection.Dataset']$</DataSetId><DataRoutingKey/><BulkInsertBatchSize>5000</BulkInsertBatchSize><MaxBatchesToProcessBeforeMaintenanceCount>100</MaxBatchesToProcessBeforeMaintenanceCount><TableName>ProcessMonitoring.ProcesStateStaging</TableName><MaxExecutionAttemptCount>0</MaxExecutionAttemptCount><ExecutionAttemptTimeoutIntervalSeconds>0</ExecutionAttemptTimeoutIntervalSeconds><TableColumns><Column><Name>ManagedEntityGuid</Name><Type>Guid</Type><XPathExpression Target="DataItem">DataItem/MeId</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CollectedDate</Name><Type>DateTime</Type><XPathExpression Target="DataItem">DataItem/Dt</XPathExpression><ValueProperty>Value</ValueProperty><AdditionalProcessing><DateTimeToSqlFormat/></AdditionalProcessing></Column><Column><Name>DateKey</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Dk</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>TimeKey</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Tk</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>ProcessId</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Pid</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CpuHealthState</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/CpuHs</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>MemoryHealthState</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/MemHs</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>HandleCountHealthState</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/HlcHs</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>AggregateHealthState</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/aHs</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CpuThreshold</Name><Type>Double</Type><XPathExpression Target="DataItem">DataItem/CpuThreshold</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>MemoryThreshold</Name><Type>Double</Type><XPathExpression Target="DataItem">DataItem/MemThreshold</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>HandleCountThreshold</Name><Type>Double</Type><XPathExpression Target="DataItem">DataItem/HlcThreshold</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>ProcessName</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Name</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>Description</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Desc</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CommandLine</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Cmd</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CommandLineHash</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Hash</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>UserName</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/User</XPathExpression><ValueProperty>Value</ValueProperty></Column></TableColumns><SqlAuthentication><Login>$RunAs[Name='SCDW!Microsoft.SystemCenter.DataWarehouse.SqlAuthenticationActionAccount']/UserName$</Login><Password>$RunAs[Name='SCDW!Microsoft.SystemCenter.DataWarehouse.SqlAuthenticationActionAccount']/Password$</Password></SqlAuthentication></WriteAction></MemberModules><Composition><Node ID="WA"/></Composition></Composite></ModuleImplementation><InputType>Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type</InputType></WriteActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.Process.PerfMetricsDW.WriteAction" Accessibility="Internal" Batching="false"><Configuration/><ModuleImplementation Isolation="Any"><Composite><MemberModules><WriteAction ID="WA" TypeID="SCDW!Microsoft.SystemCenter.DataWarehouse.BulkInsertBulkDataWriter"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><DataSetId>$MPElement[Name='Microsoft.Windows.Server.10.0.MetricsCollection.Dataset']$</DataSetId><DataRoutingKey/><BulkInsertBatchSize>5000</BulkInsertBatchSize><MaxBatchesToProcessBeforeMaintenanceCount>100</MaxBatchesToProcessBeforeMaintenanceCount><TableName>ProcessMonitoring.ProcesStaging</TableName><MaxExecutionAttemptCount>0</MaxExecutionAttemptCount><ExecutionAttemptTimeoutIntervalSeconds>0</ExecutionAttemptTimeoutIntervalSeconds><TableColumns><Column><Name>ManagedEntityGuid</Name><Type>Guid</Type><XPathExpression Target="DataItem">DataItem/MeId</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CollectedDate</Name><Type>DateTime</Type><XPathExpression Target="DataItem">DataItem/Dt</XPathExpression><ValueProperty>Value</ValueProperty><AdditionalProcessing><DateTimeToSqlFormat/></AdditionalProcessing></Column><Column><Name>DateKey</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Dk</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>TimeKey</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Tk</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>ProcessId</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Pid</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CpuUsage</Name><Type>Double</Type><XPathExpression Target="DataItem">DataItem/Cpu</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>MemoryUsage</Name><Type>Double</Type><XPathExpression Target="DataItem">DataItem/Mem</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>HandleCount</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Handles</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>ThreadCount</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Threads</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>PageFaultCount</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Faults</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CpuTime</Name><Type>Long</Type><XPathExpression Target="DataItem">DataItem/CpuTime</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>TotalProcessTime</Name><Type>Long</Type><XPathExpression Target="DataItem">DataItem/tProcessTime</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>IOReadPerSecond</Name><Type>Double</Type><XPathExpression Target="DataItem">DataItem/Read</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>IOWritePerSecond</Name><Type>Double</Type><XPathExpression Target="DataItem">DataItem/Write</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>ProcessName</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Name</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>Description</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Desc</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CommandLine</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Cmd</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CommandLineHash</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Hash</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>UserName</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/User</XPathExpression><ValueProperty>Value</ValueProperty></Column></TableColumns><SqlAuthentication><Login>$RunAs[Name='SCDW!Microsoft.SystemCenter.DataWarehouse.SqlAuthenticationActionAccount']/UserName$</Login><Password>$RunAs[Name='SCDW!Microsoft.SystemCenter.DataWarehouse.SqlAuthenticationActionAccount']/Password$</Password></SqlAuthentication></WriteAction></MemberModules><Composition><Node ID="WA"/></Composition></Composite></ModuleImplementation><InputType>Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type</InputType></WriteActionModuleType><WriteActionModuleType ID="Microsoft.Windows.Server.10.0.Process.PortDW.WriteAction" Accessibility="Internal" Batching="false"><Configuration/><ModuleImplementation Isolation="Any"><Composite><MemberModules><WriteAction ID="WA" TypeID="SCDW!Microsoft.SystemCenter.DataWarehouse.BulkInsertBulkDataWriter"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><DataSetId>$MPElement[Name='Microsoft.Windows.Server.10.0.NetPortsCollection.Dataset']$</DataSetId><DataRoutingKey/><BulkInsertBatchSize>5000</BulkInsertBatchSize><MaxBatchesToProcessBeforeMaintenanceCount>100</MaxBatchesToProcessBeforeMaintenanceCount><TableName>ProcessMonitoring.PortStaging</TableName><MaxExecutionAttemptCount>0</MaxExecutionAttemptCount><ExecutionAttemptTimeoutIntervalSeconds>0</ExecutionAttemptTimeoutIntervalSeconds><TableColumns><Column><Name>ManagedEntityGuid</Name><Type>Guid</Type><XPathExpression Target="DataItem">DataItem/MeId</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CollectedDate</Name><Type>DateTime</Type><XPathExpression Target="DataItem">DataItem/Dt</XPathExpression><ValueProperty>Value</ValueProperty><AdditionalProcessing><DateTimeToSqlFormat/></AdditionalProcessing></Column><Column><Name>DateKey</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Dk</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>TimeKey</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Tk</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>ProcessId</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Pid</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>LocalAddress</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/LIP</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>RemoteAddress</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/RIP</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>LocalPort</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Lport</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>RemotePort</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/Rport</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>OldPortState</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/OldState</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>PortState</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/pState</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>TimeInOldState</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/tInOldState</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>PortType</Name><Type>Int</Type><XPathExpression Target="DataItem">DataItem/pType</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>IPV6</Name><Type>Boolean</Type><XPathExpression Target="DataItem">DataItem/IPV6</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>ProcessName</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Name</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>Description</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Desc</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CommandLine</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Cmd</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>CommandLineHash</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/Hash</XPathExpression><ValueProperty>Value</ValueProperty></Column><Column><Name>UserName</Name><Type>String</Type><XPathExpression Target="DataItem">DataItem/User</XPathExpression><ValueProperty>Value</ValueProperty></Column></TableColumns><SqlAuthentication><Login>$RunAs[Name='SCDW!Microsoft.SystemCenter.DataWarehouse.SqlAuthenticationActionAccount']/UserName$</Login><Password>$RunAs[Name='SCDW!Microsoft.SystemCenter.DataWarehouse.SqlAuthenticationActionAccount']/Password$</Password></SqlAuthentication></WriteAction></MemberModules><Composition><Node ID="WA"/></Composition></Composite></ModuleImplementation><InputType>Microsoft.Windows.Server.10.0.DataItemProcessInfo.Type</InputType></WriteActionModuleType></ModuleTypes></TypeDefinitions><Categories><Category ID="Microsoft.Windows.Server.2016.Assembly.Category.Windows" Target="Res.Microsoft.Windows.Server.2016.Assembly.UI" Value="Visualization!Microsoft.SystemCenter.Visualization.WindowsAssembly"/><Category ID="Microsoft.Windows.Server.2016.Assembly.Category.Category" Target="Res.Microsoft.Windows.Server.2016.Assembly.Components.WPF" Value="Visualization!Microsoft.SystemCenter.Visualization.WpfComponentAssembly"/><Category ID="Res.Microsoft.Windows.Server.2016.Assembly.Visualization.DataProviders.Category" Target="Res.Microsoft.Windows.Server.2016.Assembly.Visualization.DataProviders.Assembly" Value="Visualization!Microsoft.SystemCenter.Visualization.DataProviderAssembly"/><Category ID="Res.Microsoft.Windows.Server.2016.Modules.Assembly.Category.Windows" Target="Microsoft.Windows.Server.2016.Modules.Assembly" Value="Visualization!Microsoft.SystemCenter.Visualization.WindowsAssembly"/><Category ID="Res.Microsoft.Windows.Server.NativeApi.Assembly.Category.Windows" Target="Microsoft.Windows.Server.NativeApi.Assembly" Value="Visualization!Microsoft.SystemCenter.Visualization.WindowsAssembly"/></Categories><Monitoring><Discoveries><Discovery ID="Microsoft.Windows.Server.10.0.ProcessSeed.Core.Discovery" Enabled="true" Target="Server2016!Microsoft.Windows.Server.10.0.Core.Computer" ConfirmDelivery="false" Remotable="true" Priority="Normal"><Category>Discovery</Category><DiscoveryTypes><DiscoveryClass TypeID="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"><Property TypeID="Windows!Microsoft.Windows.Computer" PropertyID="PrincipalName"/><Property TypeID="System!System.Entity" PropertyID="DisplayName"/><Property TypeID="WindowsServer!Microsoft.Windows.Server.ProcessSeed" PropertyID="PortMonitoringEnabled"/><Property TypeID="WindowsServer!Microsoft.Windows.Server.ProcessSeed" PropertyID="ProcessMonitoringEnabled"/></DiscoveryClass></DiscoveryTypes><DataSource ID="DS" TypeID="Microsoft.Windows.Server.10.0.ProcessSeedDiscovery.ModuleType"><IntervalSeconds>86400</IntervalSeconds></DataSource></Discovery><Discovery ID="Microsoft.Windows.Server.10.0.ProcessSeed.Full.Discovery" Enabled="true" Target="Server2016!Microsoft.Windows.Server.10.0.Full.Computer" ConfirmDelivery="false" Remotable="true" Priority="Normal"><Category>Discovery</Category><DiscoveryTypes><DiscoveryClass TypeID="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"><Property TypeID="Windows!Microsoft.Windows.Computer" PropertyID="PrincipalName"/><Property TypeID="System!System.Entity" PropertyID="DisplayName"/><Property TypeID="WindowsServer!Microsoft.Windows.Server.ProcessSeed" PropertyID="PortMonitoringEnabled"/><Property TypeID="WindowsServer!Microsoft.Windows.Server.ProcessSeed" PropertyID="ProcessMonitoringEnabled"/></DiscoveryClass></DiscoveryTypes><DataSource ID="DS" TypeID="Microsoft.Windows.Server.10.0.ProcessSeedDiscovery.ModuleType"><IntervalSeconds>86400</IntervalSeconds></DataSource></Discovery><Discovery ID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group.Discovery" Enabled="true" Target="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" ConfirmDelivery="false" Remotable="true" Priority="Normal"><Category>Discovery</Category><DiscoveryTypes><DiscoveryRelationship TypeID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.ContainsWindowsServer.10.0.Computer"/></DiscoveryTypes><DataSource ID="DS" TypeID="SC!Microsoft.SystemCenter.GroupPopulator"><RuleId>$MPElement$</RuleId><GroupInstanceId>$Target/Id$</GroupInstanceId><MembershipRules><MembershipRule><MonitoringClass>$MPElement[Name="Server2016!Microsoft.Windows.Server.10.0.Computer"]$</MonitoringClass><RelationshipClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.ContainsWindowsServer.10.0.Computer"]$</RelationshipClass><Expression><Contains><MonitoringClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"]$</MonitoringClass><Expression><SimpleExpression><ValueExpression><Property>$MPElement[Name='WindowsServer!Microsoft.Windows.Server.ProcessSeed']/ProcessMonitoringEnabled$</Property></ValueExpression><Operator>Equal</Operator><ValueExpression><Value>True</Value></ValueExpression></SimpleExpression></Expression></Contains></Expression></MembershipRule></MembershipRules></DataSource></Discovery><Discovery ID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group.Discovery" Enabled="true" Target="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group" ConfirmDelivery="false" Remotable="true" Priority="Normal"><Category>Discovery</Category><DiscoveryTypes><DiscoveryRelationship TypeID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.ContainsWindowsServer.10.0.Computer"/></DiscoveryTypes><DataSource ID="DS" TypeID="SC!Microsoft.SystemCenter.GroupPopulator"><RuleId>$MPElement$</RuleId><GroupInstanceId>$Target/Id$</GroupInstanceId><MembershipRules><MembershipRule><MonitoringClass>$MPElement[Name="Server2016!Microsoft.Windows.Server.10.0.Computer"]$</MonitoringClass><RelationshipClass>$MPElement[Name="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.ContainsWindowsServer.10.0.Computer"]$</RelationshipClass><Expression><Contains><MonitoringClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"]$</MonitoringClass><Expression><SimpleExpression><ValueExpression><Property>$MPElement[Name='WindowsServer!Microsoft.Windows.Server.ProcessSeed']/PortMonitoringEnabled$</Property></ValueExpression><Operator>Equal</Operator><ValueExpression><Value>True</Value></ValueExpression></SimpleExpression></Expression></Contains></Expression></MembershipRule></MembershipRules></DataSource></Discovery><Discovery ID="Microsoft.Windows.Server.10.0.ProcessMonitoringSeed.Group.Discovery" Enabled="true" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.Seed.Group" ConfirmDelivery="false" Remotable="true" Priority="Normal"><Category>Discovery</Category><DiscoveryTypes><DiscoveryRelationship TypeID="Microsoft.Windows.Server.10.0.ProcessMonitoringSeedGroup.ContainsProcessSeed"/></DiscoveryTypes><DataSource ID="DS" TypeID="SC!Microsoft.SystemCenter.GroupPopulator"><RuleId>$MPElement$</RuleId><GroupInstanceId>$Target/Id$</GroupInstanceId><MembershipRules><MembershipRule><MonitoringClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"]$</MonitoringClass><RelationshipClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoringSeedGroup.ContainsProcessSeed"]$</RelationshipClass></MembershipRule></MembershipRules></DataSource></Discovery><Discovery ID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group.Discovery" Enabled="true" Target="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" ConfirmDelivery="false" Remotable="true" Priority="Normal"><Category>Discovery</Category><DiscoveryTypes><DiscoveryRelationship TypeID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed"/></DiscoveryTypes><DataSource ID="DS" TypeID="SC!Microsoft.SystemCenter.GroupPopulator"><RuleId>$MPElement$</RuleId><GroupInstanceId>$Target/Id$</GroupInstanceId><MembershipRules><MembershipRule><MonitoringClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"]$</MonitoringClass><RelationshipClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed"]$</RelationshipClass><Expression><Or><Expression><SimpleExpression><ValueExpression><Property>$MPElement[Name='WindowsServer!Microsoft.Windows.Server.ProcessSeed']/ProcessMonitoringEnabled$</Property></ValueExpression><Operator>Equal</Operator><ValueExpression><Value>False</Value></ValueExpression></SimpleExpression></Expression><Expression><UnaryExpression><ValueExpression><Property>$MPElement[Name='WindowsServer!Microsoft.Windows.Server.ProcessSeed']/ProcessMonitoringEnabled$</Property></ValueExpression><Operator>IsNull</Operator></UnaryExpression></Expression></Or></Expression></MembershipRule></MembershipRules></DataSource></Discovery><Discovery ID="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group.Discovery" Enabled="true" Target="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group" ConfirmDelivery="false" Remotable="true" Priority="Normal"><Category>Discovery</Category><DiscoveryTypes><DiscoveryRelationship TypeID="Microsoft.Windows.Server.10.0.PortMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed"/></DiscoveryTypes><DataSource ID="DS" TypeID="SC!Microsoft.SystemCenter.GroupPopulator"><RuleId>$MPElement$</RuleId><GroupInstanceId>$Target/Id$</GroupInstanceId><MembershipRules><MembershipRule><MonitoringClass>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"]$</MonitoringClass><RelationshipClass>$MPElement[Name="Microsoft.Windows.Server.10.0.PortMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed"]$</RelationshipClass><Expression><Or><Expression><SimpleExpression><ValueExpression><Property>$MPElement[Name='WindowsServer!Microsoft.Windows.Server.ProcessSeed']/PortMonitoringEnabled$</Property></ValueExpression><Operator>Equal</Operator><ValueExpression><Value>False</Value></ValueExpression></SimpleExpression></Expression><Expression><UnaryExpression><ValueExpression><Property>$MPElement[Name='WindowsServer!Microsoft.Windows.Server.ProcessSeed']/PortMonitoringEnabled$</Property></ValueExpression><Operator>IsNull</Operator></UnaryExpression></Expression></Or></Expression></MembershipRule></MembershipRules></DataSource></Discovery></Discoveries><Rules><Rule ID="Microsoft.Windows.Server.10.0.ProcessCount.Collection" Enabled="false" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" ConfirmDelivery="false" Remotable="true" Priority="Normal" DiscardLevel="100"><Category>PerformanceCollection</Category><DataSources><DataSource ID="DS" TypeID="Microsoft.Windows.Server.10.0.Process.CountMonitoring.DataSource"><IntervalSeconds>300</IntervalSeconds><SyncTime/></DataSource></DataSources><WriteActions><WriteAction ID="WriteToDB" TypeID="SC!Microsoft.SystemCenter.CollectPerformanceData"/><WriteAction ID="WriteToDW" TypeID="SCDW!Microsoft.SystemCenter.DataWarehouse.PublishPerformanceData"/></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert" Enabled="false" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" ConfirmDelivery="false" Remotable="true" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="DS" RunAs="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" TypeID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource"><MonitoringConfiguration>$Target/Property[Type="WindowsServer!Microsoft.Windows.Server.ProcessSeed"]/ThresholdsByProcess$</MonitoringConfiguration><IntervalSeconds>120</IntervalSeconds><SampleCount>6</SampleCount><HandleCountIncreaseThreshold>20</HandleCountIncreaseThreshold><LogLevel>4</LogLevel></DataSource></DataSources><WriteActions><WriteAction ID="GenerateAlert" TypeID="Microsoft.Windows.Server.10.0.GenerateAlertWriteAction"><AlertMessageId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert.AlertMessage"]$</AlertMessageId><Threshold>$Data/HandleCountIncreaseThreshold$</Threshold><Metric>DoesHandleCountIncreaseTooFast</Metric></WriteAction><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.CloseAlertWriteAction" Target="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer"><TimeoutSeconds>300</TimeoutSeconds><RuleId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert"]$</RuleId><Metric>DoesHandleCountIncreaseTooFast</Metric></WriteAction></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert" Enabled="false" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" ConfirmDelivery="false" Remotable="true" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="DS" RunAs="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" TypeID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource"><MonitoringConfiguration>$Target/Property[Type="WindowsServer!Microsoft.Windows.Server.ProcessSeed"]/ThresholdsByProcess$</MonitoringConfiguration><IntervalSeconds>73</IntervalSeconds><SampleCount>6</SampleCount><PercentProcessorTimeThreshold>50</PercentProcessorTimeThreshold><LogLevel>4</LogLevel></DataSource></DataSources><WriteActions><WriteAction ID="GenerateAlert" TypeID="Microsoft.Windows.Server.10.0.GenerateAlertWriteAction"><AlertMessageId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert.AlertMessage"]$</AlertMessageId><Threshold>$Data/PercentProcessorTimeThreshold$</Threshold><Metric>IsPercentProcessorTimeTooHigh</Metric></WriteAction><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.CloseAlertWriteAction" Target="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer"><TimeoutSeconds>300</TimeoutSeconds><RuleId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert"]$</RuleId><Metric>IsPercentProcessorTimeTooHigh</Metric></WriteAction></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert" Enabled="false" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" ConfirmDelivery="false" Remotable="true" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="DS" RunAs="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" TypeID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource"><MonitoringConfiguration>$Target/Property[Type="WindowsServer!Microsoft.Windows.Server.ProcessSeed"]/ThresholdsByProcess$</MonitoringConfiguration><IntervalSeconds>67</IntervalSeconds><SampleCount>6</SampleCount><MemoryPercentageThreshold>50</MemoryPercentageThreshold><LogLevel>4</LogLevel></DataSource></DataSources><WriteActions><WriteAction ID="GenerateAlert" TypeID="Microsoft.Windows.Server.10.0.GenerateAlertWriteAction"><AlertMessageId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert.AlertMessage"]$</AlertMessageId><Threshold>$Data/MemoryPercentageThreshold$</Threshold><Metric>IsMemoryPercentageTooHigh</Metric></WriteAction><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.CloseAlertWriteAction" Target="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer"><TimeoutSeconds>300</TimeoutSeconds><RuleId>$MPElement[Name="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert"]$</RuleId><Metric>IsMemoryPercentageTooHigh</Metric></WriteAction></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.Process.HealthStateSubscription.Rule" Enabled="false" Target="SC!Microsoft.SystemCenter.HealthService" ConfirmDelivery="true" Remotable="true" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="Subscribe" TypeID="Microsoft.Windows.Server.10.0.ProcessInfo.DWSubscription.HealthState.DataSource"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ChannelId>$MPElement[Name="Microsoft.Windows.Server.10.0.Process.HealthState.Collection"]$</ChannelId><DropItems>false</DropItems></DataSource></DataSources><WriteActions><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.Process.HealthStateDW.WriteAction" Target="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer"/></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.Process.PerfMetricsSubscription.Rule" Enabled="false" Target="SC!Microsoft.SystemCenter.HealthService" ConfirmDelivery="true" Remotable="true" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="Subscribe" TypeID="Microsoft.Windows.Server.10.0.ProcessInfo.DWSubscription.PerfMetrics.DataSource"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ChannelId>$MPElement[Name="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection"]$</ChannelId><DropItems>false</DropItems></DataSource></DataSources><WriteActions><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.Process.PerfMetricsDW.WriteAction" Target="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer"/></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.Process.PortSubscription.Rule" Enabled="false" Target="SC!Microsoft.SystemCenter.HealthService" ConfirmDelivery="false" Remotable="true" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="Subscribe" TypeID="Microsoft.Windows.Server.10.0.Port.DWSubscription.DataSource"><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ChannelId>$MPElement[Name="Microsoft.Windows.Server.10.0.Process.Ports.Collection"]$</ChannelId><DropItems>false</DropItems></DataSource></DataSources><WriteActions><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.Process.PortDW.WriteAction" Target="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer"/></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection" Enabled="false" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" ConfirmDelivery="true" Remotable="false" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="DS" RunAs="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" TypeID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource"><MonitoringConfiguration>$Target/Property[Type="WindowsServer!Microsoft.Windows.Server.ProcessSeed"]/ThresholdsByProcess$</MonitoringConfiguration><LogLevel>4</LogLevel><ManagedEntityId>$Target/Host/Id$</ManagedEntityId><IntervalSeconds>60</IntervalSeconds><SampleCount>6</SampleCount><HandleCountIncreaseThreshold>20</HandleCountIncreaseThreshold><MemoryPercentageThreshold>50</MemoryPercentageThreshold><PercentProcessorTimeThreshold>50</PercentProcessorTimeThreshold></DataSource></DataSources><WriteActions><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.Process.HealthStatePublish.WriteAction"/></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.Process.Ports.Collection" Enabled="false" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" ConfirmDelivery="true" Remotable="false" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="DS" RunAs="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" TypeID="Microsoft.Windows.Server.10.0.Port.PerfMetrics.Collection.DataSource"><MonitoringConfiguration>$Target/Property[Type="WindowsServer!Microsoft.Windows.Server.ProcessSeed"]/ThresholdsByProcess$</MonitoringConfiguration><LogLevel>4</LogLevel><ManagementGroupId>$Target/ManagementGroup/Id$</ManagementGroupId><ManagedEntityId>$Target/Host/Id$</ManagedEntityId><IntervalSeconds>60</IntervalSeconds></DataSource></DataSources><WriteActions><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.Process.PortsPublish.WriteAction"/></WriteActions></Rule><Rule ID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection" Enabled="false" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" ConfirmDelivery="true" Remotable="false" Priority="Normal" DiscardLevel="100"><Category>Custom</Category><DataSources><DataSource ID="DS" RunAs="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" TypeID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource"><MonitoringConfiguration>$Target/Property[Type="WindowsServer!Microsoft.Windows.Server.ProcessSeed"]/ThresholdsByProcess$</MonitoringConfiguration><LogLevel>4</LogLevel><ManagedEntityId>$Target/Host/Id$</ManagedEntityId><IntervalSeconds>60</IntervalSeconds></DataSource></DataSources><WriteActions><WriteAction ID="WA" TypeID="Microsoft.Windows.Server.10.0.Process.PerfMetricsPublish.WriteAction"/></WriteActions></Rule></Rules><Overrides><RulePropertyOverride ID="ProcessHandleCountAlertingDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMemoryPercentageAlertingDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessPercentProecssorTimeAlertingDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessCountDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessCount.Collection" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMetricsCollectionDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessHealthStateCollectionDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.HealthState.Collection" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="PortCollectionDisabledOverride" Context="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.Ports.Collection" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMetricsSubscriptionDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PerfMetricsSubscription.Rule" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessHealthStateSubscriptionDisabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.HealthStateSubscription.Rule" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="PortCollectionSubscriptionsDisabledOverride" Context="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PortSubscription.Rule" Property="Enabled"><Value>false</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMetricsCollectionEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessHealthStateCollectionEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.HealthState.Collection" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="PortCollectionEnabledOverride" Context="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.Ports.Collection" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessHandleCountAlertingEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMemoryPercentageAlertingEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessPercentProecssorTimeAlertingEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessCountEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessCount.Collection" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMetricsSubscriptionEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PerfMetricsSubscription.Rule" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessHealthStateSubscriptionEnabledOverride" Context="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.HealthStateSubscription.Rule" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="PortCollectionSubscriptionsEnabledOverride" Context="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PortSubscription.Rule" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMetricsSubscriptionDwhEnabledOverride" Context="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PerfMetricsSubscription.Rule" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessHealthStateSubscriptionDwhEnabledOverride" Context="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.HealthStateSubscription.Rule" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="PortCollectionSubscriptionsDwhEnabledOverride" Context="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer" Enforced="false" Rule="Microsoft.Windows.Server.10.0.Process.PortSubscription.Rule" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessHandleCountAlertingDwhEnabledOverride" Context="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessMemoryPercentageAlertingDwhEnabledOverride" Context="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert" Property="Enabled"><Value>true</Value></RulePropertyOverride><RulePropertyOverride ID="ProcessPercentProecssorTimeAlertingDwhEnabledOverride" Context="SCDW!Microsoft.SystemCenter.DataWarehouseConnectorServer" Enforced="false" Rule="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert" Property="Enabled"><Value>true</Value></RulePropertyOverride></Overrides></Monitoring><Templates><Template ID="Microsoft.Windows.Server.10.0.Template.ProcessesAndPorts"><Configuration/><References><Reference ID="Self"/><Reference ID="System"/><Reference ID="Windows"/><Reference ID="SC"/></References><Implementation><TypeDefinitions><EntityTypes><ClassTypes/></EntityTypes></TypeDefinitions><Monitoring/></Implementation></Template></Templates><PresentationTypes><UIPages><UIPage ID="Microsoft.Windows.Server.10.0.UIPage.ProcessesAndPortsTemplate.MainPage" Accessibility="Public"><Implementation><Assembly>Res.Microsoft.Windows.Server.2016.Assembly.UI</Assembly><Type>Microsoft.Windows.Server.UI.ProcessesAndPortsWizard.MainPage</Type></Implementation></UIPage><UIPage ID="Microsoft.Windows.Server.10.0.UIPage.ProcessesAndPortsTemplate.ProcessThresholdsPage" Accessibility="Public"><Implementation><Assembly>Res.Microsoft.Windows.Server.2016.Assembly.UI</Assembly><Type>Microsoft.Windows.Server.UI.ProcessesAndPortsWizard.ProcessThresholdsPage</Type></Implementation></UIPage><UIPage ID="Microsoft.Windows.Server.10.0.UIPage.ProcessesAndPortsTemplate.Summary" Accessibility="Public"><Implementation><Assembly>Res.Microsoft.Windows.Server.2016.Assembly.UI</Assembly><Type>Microsoft.Windows.Server.UI.ProcessesAndPortsWizard.Summary</Type></Implementation></UIPage></UIPages><UIPageSets><UIPageSet ID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate" TypeDefinitionID="Microsoft.Windows.Server.10.0.Template.ProcessesAndPorts"><UIPageReferences><UIPageReference ID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.MainPage" PageID="Microsoft.Windows.Server.10.0.UIPage.ProcessesAndPortsTemplate.MainPage" Usage="CreationAndUpdate"><Title ID="Title"/><SubTitle ID="SubTitle"/><TabName ID="TabName"/></UIPageReference><UIPageReference ID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.ProcessThresholdsPage" PageID="Microsoft.Windows.Server.10.0.UIPage.ProcessesAndPortsTemplate.ProcessThresholdsPage" Usage="UpdateOnly"><Title ID="Title"/><SubTitle ID="SubTitle"/><TabName ID="TabName"/></UIPageReference><UIPageReference ID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.Summary" PageID="Microsoft.Windows.Server.10.0.UIPage.ProcessesAndPortsTemplate.Summary" Usage="CreationOnly"><Title ID="Title"/><SubTitle ID="SubTitle"/><TabName ID="TabName"/></UIPageReference></UIPageReferences><OutputTransform><xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"><xsl:output method="xml" indent="yes" omit-xml-declaration="yes"/><xsl:template match="/"><xsl:element name="Configuration"/></xsl:template></xsl:stylesheet></OutputTransform></UIPageSet></UIPageSets></PresentationTypes><Presentation><Views><View ID="Microsoft.Windows.Server.10.0.Presentation.ActiveAlert.View" Accessibility="Public" Enabled="true" Target="Microsoft.Windows.Server.10.0.ProcessMonitoring.Seed.Group" TypeID="SC!Microsoft.SystemCenter.AlertViewType" Visible="true"><Category>Alert</Category><Criteria><ResolutionState><StateRange Operator="NotEquals">255</StateRange></ResolutionState></Criteria><Presentation><ColumnInfo Index="0" SortIndex="0" Width="22" Grouped="true" Sorted="false" IsSortable="true" Visible="true" SortOrder="Ascending"><Name>Severity</Name><Id>Severity</Id></ColumnInfo><ColumnInfo Index="1" SortIndex="-1" Width="50" Grouped="true" Sorted="false" IsSortable="false" Visible="true" SortOrder="Ascending"><Name>Icon</Name><Id>Icon</Id></ColumnInfo><ColumnInfo Index="2" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Path</Name><Id>MonitoringObjectPath</Id></ColumnInfo><ColumnInfo Index="3" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="true" SortOrder="Ascending"><Name>Source</Name><Id>MonitoringObjectDisplayName</Id></ColumnInfo><ColumnInfo Index="4" SortIndex="-1" Width="22" Grouped="false" Sorted="false" IsSortable="true" Visible="true" SortOrder="Ascending"><Name>Maintenance Mode</Name><Id>MonitoringObjectInMaintenanceMode</Id></ColumnInfo><ColumnInfo Index="5" SortIndex="-1" Width="250" Grouped="false" Sorted="false" IsSortable="true" Visible="true" SortOrder="Ascending"><Name>Name</Name><Id>Name</Id></ColumnInfo><ColumnInfo Index="6" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="true" SortOrder="Ascending"><Name>Resolution State</Name><Id>ResolutionState</Id></ColumnInfo><ColumnInfo Index="7" SortIndex="-1" Width="150" Grouped="false" Sorted="false" IsSortable="true" Visible="true" SortOrder="Ascending"><Name>Created</Name><Id>TimeRaised</Id></ColumnInfo><ColumnInfo Index="8" SortIndex="1" Width="100" Grouped="false" Sorted="true" IsSortable="true" Visible="true" SortOrder="Ascending"><Name>Age</Name><Id>Age</Id></ColumnInfo><ColumnInfo Index="9" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Type</Name><Id>Category</Id></ColumnInfo><ColumnInfo Index="10" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Owner</Name><Id>Owner</Id></ColumnInfo><ColumnInfo Index="11" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Priority</Name><Id>Priority</Id></ColumnInfo><ColumnInfo Index="12" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Latency</Name><Id>Latency</Id></ColumnInfo><ColumnInfo Index="13" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Description</Name><Id>Description</Id></ColumnInfo><ColumnInfo Index="14" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Connector</Name><Id>ConnectorId</Id></ColumnInfo><ColumnInfo Index="15" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Forwarding Status</Name><Id>ConnectorStatus</Id></ColumnInfo><ColumnInfo Index="16" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Class</Name><Id>Class</Id></ColumnInfo><ColumnInfo Index="17" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Time in State</Name><Id>TimeInState</Id></ColumnInfo><ColumnInfo Index="18" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 1</Name><Id>CustomField1</Id></ColumnInfo><ColumnInfo Index="19" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 2</Name><Id>CustomField2</Id></ColumnInfo><ColumnInfo Index="20" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 3</Name><Id>CustomField3</Id></ColumnInfo><ColumnInfo Index="21" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 4</Name><Id>CustomField4</Id></ColumnInfo><ColumnInfo Index="22" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 5</Name><Id>CustomField5</Id></ColumnInfo><ColumnInfo Index="23" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 6</Name><Id>CustomField6</Id></ColumnInfo><ColumnInfo Index="24" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 7</Name><Id>CustomField7</Id></ColumnInfo><ColumnInfo Index="25" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 8</Name><Id>CustomField8</Id></ColumnInfo><ColumnInfo Index="26" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 9</Name><Id>CustomField9</Id></ColumnInfo><ColumnInfo Index="27" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Custom Field 10</Name><Id>CustomField10</Id></ColumnInfo><ColumnInfo Index="28" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Resolved By</Name><Id>ResolvedBy</Id></ColumnInfo><ColumnInfo Index="29" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Time Resolved</Name><Id>TimeResolved</Id></ColumnInfo><ColumnInfo Index="30" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Last State Change</Name><Id>TimeResolutionStateLastModified</Id></ColumnInfo><ColumnInfo Index="31" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Last Modified</Name><Id>LastModified</Id></ColumnInfo><ColumnInfo Index="32" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Last Modified By</Name><Id>LastModifiedBy</Id></ColumnInfo><ColumnInfo Index="33" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Management Group</Name><Id>ManagementGroup</Id></ColumnInfo><ColumnInfo Index="34" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Site</Name><Id>SiteName</Id></ColumnInfo><ColumnInfo Index="35" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Repeat Count</Name><Id>RepeatCount</Id></ColumnInfo><ColumnInfo Index="36" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>Ticket ID</Name><Id>TicketId</Id></ColumnInfo><ColumnInfo Index="37" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>TFS Work Item ID</Name><Id>TfsWorkItemId</Id></ColumnInfo><ColumnInfo Index="38" SortIndex="-1" Width="100" Grouped="false" Sorted="false" IsSortable="true" Visible="false" SortOrder="Ascending"><Name>TFS Work Item Owner</Name><Id>TfsWorkItemOwner</Id></ColumnInfo></Presentation></View></Views><Folders><Folder ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Folder.Root" Accessibility="Public" ParentFolder="WindowsServer!Microsoft.Windows.Server.ViewFolder.Root"/><Folder ID="Microsoft.Windows.Server.10.0.TemplateFolder.ProcessesAndPorts" Accessibility="Public" ParentFolder="OM!Microsoft.SystemCenter.OperationsManager.Authoring.TemplateParsers.Root"/></Folders><FolderItems><FolderItem ElementID="Microsoft.Windows.Server.10.0.Presentation.ActiveAlert.View" ID="Id_1" Folder="Microsoft.Windows.Server.10.0.ProcessMonitoring.Folder.Root"/><FolderItem ElementID="Microsoft.Windows.Server.10.0.Template.ProcessesAndPorts" ID="Microsoft.Windows.Server.10.0.Template.ProcessesAndPorts" Folder="Microsoft.Windows.Server.10.0.TemplateFolder.ProcessesAndPorts"/></FolderItems><StringResources><StringResource ID="Microsoft.Windows.Server.10.0.HealthStatesCollection.Dataset.DefaultConfiguration"/><StringResource ID="Microsoft.Windows.Server.10.0.MetricsCollection.Dataset.DefaultConfiguration"/><StringResource ID="Microsoft.Windows.Server.10.0.NetPortsCollection.Dataset.DefaultConfiguration"/><StringResource ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.N"/><StringResource ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.OrderBy"/><StringResource ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.StartDate"/><StringResource ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.EndDate"/><StringResource ID="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert.AlertMessage"/><StringResource ID="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert.AlertMessage"/><StringResource ID="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert.AlertMessage"/></StringResources><ComponentTypes><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.DataGridColumnsToPropertyNames" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Columns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]" BindingDirection="In"/><Property Name="GroupedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="In"/><Property Name="SortedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="In"/><Property Name="PropertyNames" Type="xsd://string[]" BindingDirection="Both"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.Common.OrEmptyItem" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Input" Type="BaseDataType[]" BindingDirection="In"/><Property Name="Output" Type="BaseDataType[]" BindingDirection="Out"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.Common.EmptyItemConsolidator" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Input" Type="BaseDataType[]" BindingDirection="In"/><Property Name="Dummy" Type="BaseDataType[]" BindingDirection="In"/><Property Name="Output" Type="BaseDataType[]" BindingDirection="In"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Visualization.Components.Filter" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Criteria" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/FilterCriteria" BindingDirection="In"/><Property Name="PropertyNames" Type="xsd://string[]" BindingDirection="Both"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Visualization.Components.FilterControl" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Criteria" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/FilterCriteria" BindingDirection="Out"/><Property Name="FilterActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action" BindingDirection="In"/><Property Name="ControlIsVisible" Type="xsd://boolean" BindingDirection="In"><SimpleValue Type="xsd://boolean" Value="True"/></Property></ComponentType><ComponentType ID="AlertCriteriaXMLToQueryString" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="ConfigurationXMLString" Type="xsd://string" BindingDirection="In"/><Property Name="QueryString" Type="xsd://string" BindingDirection="Out"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.GetManagedEntitiesDataSource" Accessibility="Internal" Base="CommonDataSourceInterface" Lifetime="ManagementPackElement"><Property Name="CriteriaString" Type="xsd://string" BindingDirection="In"/><Property Name="BaseTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="MaxEntities" Type="xsd://int" BindingDirection="In"/><Property Name="TargetEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="In"/><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="SortProperties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]" BindingDirection="In"/></ComponentType><ComponentType ID="StateCriteriaXMLToQueryString" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="ConfigurationXMLString" Type="xsd://string" BindingDirection="In"/><Property Name="QueryString" Type="xsd://string" BindingDirection="Out"/></ComponentType><ComponentType ID="CommonDetailQueryInterface" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Properties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]" BindingDirection="In"/><Property Name="DataSourceIncludeProperties" Type="xsd://string" BindingDirection="In"/><Property Name="Input" Type="BaseDataType[]" BindingDirection="In"/><Property Name="Output" Type="BaseDataType[]" BindingDirection="Out"/><Property Name="DisplayStrings" Type="BaseDataType" BindingDirection="In"/><Property Name="Refresh" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/RefreshAction" BindingDirection="In"/><Property Name="IsBusy" Type="BaseDataType" BindingDirection="Out"/><Property Name="ConnectionSessionTicket" Type="xsd://string" BindingDirection="In"/><Property Name="LastError" Type="BaseDataType" BindingDirection="Out"/></ComponentType><ComponentType ID="GetAlertDetails" Accessibility="Internal" Base="CommonDetailQueryInterface" Lifetime="ManagementPackElement"><Property Name="SingleObject" Type="xsd://boolean" BindingDirection="In"/></ComponentType><ComponentType ID="CommonChunkingDetailsQuery" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="InitialChunkSize" Type="xsd://int" BindingDirection="In"/><Property Name="ChunkSize" Type="xsd://int" BindingDirection="In"/><Property Name="Properties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]" BindingDirection="In"/><Property Name="DataSourceIncludeProperties" Type="xsd://string" BindingDirection="In"/><Property Name="KeyPropertyName" Type="xsd://string" BindingDirection="In"/><Property Name="Data" Type="BaseDataType[]" BindingDirection="Out"/><Property Name="DisplayStrings" Type="BaseDataType" BindingDirection="In"/><Property Name="Refresh" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/RefreshAction" BindingDirection="In"/><Property Name="RefreshStrategy" Type="xsd://string" BindingDirection="In"/><Property Name="IsBusy" Type="BaseDataType" BindingDirection="Out"/><Property Name="LastError" Type="BaseDataType" BindingDirection="Out"/></ComponentType><ComponentType ID="ChunkingQuery" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="DetailInputKeyPropertyName" Type="xsd://string" BindingDirection="In"/><Property Name="DetailOutputKeyPropertyName" Type="xsd://string" BindingDirection="In"/><Property Name="DetailInput" Type="BaseDataType[]" BindingDirection="Out"/><Property Name="DetailOutput" Type="BaseDataType[]" BindingDirection="In"/><Property Name="InitialChunkSize" Type="xsd://int" BindingDirection="In"/><Property Name="ChunkSize" Type="xsd://int" BindingDirection="In"/><Property Name="Data" Type="BaseDataType[]" BindingDirection="In"/><Property Name="RefreshStrategy" Type="xsd://string" BindingDirection="In"/><Property Name="IsBusy" Type="BaseDataType" BindingDirection="Out"/><Property Name="Refresh" Type="BaseDataType" BindingDirection="In"/></ComponentType><ComponentType ID="ChunkingAlertDetailsQuery" Accessibility="Internal" Base="CommonChunkingDetailsQuery" Lifetime="ManagementPackElement"><Property Name="SingleObject" Type="xsd://boolean" BindingDirection="In"/></ComponentType><ComponentType ID="ComponentCollection" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Items" Type="BaseDataType[]" BindingDirection="Both"/></ComponentType><ComponentType ID="CommonDataSourceInterface" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="Properties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]" BindingDirection="In"/><Property Name="DataSourceIncludeProperties" Type="xsd://string" BindingDirection="In"/><Property Name="Output" Type="BaseDataType[]" BindingDirection="Out"/><Property Name="OutputItem" Type="BaseDataType" BindingDirection="Out"/><Property Name="DisplayStrings" Type="BaseDataType" BindingDirection="Out"/><Property Name="Refresh" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/RefreshAction" BindingDirection="In"/><Property Name="ConnectionSessionTicket" Type="xsd://string" BindingDirection="In"/><Property Name="IsBusy" Type="BaseDataType" BindingDirection="Out"/><Property Name="LastError" Type="BaseDataType" BindingDirection="Out"/></ComponentType><ComponentType ID="GetAlertsForEntitiesDataSource" Accessibility="Internal" Base="CommonDataSourceInterface" Lifetime="ManagementPackElement"><Property Name="ManagedEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="In"/><Property Name="CriteriaString" Type="xsd://string" BindingDirection="In"/><Property Name="SortProperties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]" BindingDirection="In"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.ActionsHost" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="ContentElement" Type="BaseDataType" BindingDirection="In"/><Property Name="ActionTypes" Type="xsd://string[]" BindingDirection="Out"/><Property Name="Action" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action" BindingDirection="Out"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.TriggeredComponentHost" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="ComponentType" Type="xsd://string" BindingDirection="In"/><Property Name="ComponentTarget" Type="BaseDataType" BindingDirection="In"/><Property Name="TriggerInstance" Type="BaseDataType" BindingDirection="In"/><Property Name="TriggerTypes" Type="xsd://string[]" BindingDirection="In"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.DataGridSortColumnsToSortColumnBaseCollection" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="GroupedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/SortColumnBase[]" BindingDirection="In"/><Property Name="SortedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/SortColumnBase[]" BindingDirection="In"/><Property Name="SortColumnBaseCollection" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortColumnBase[]" BindingDirection="Out"/></ComponentType><ComponentType ID="ColumnsToQueryConfigurationMapper" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="PropertyList" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/ColumnBase[]" BindingDirection="In"/><Property Name="SortPropertyList" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/SortColumnBase[]" BindingDirection="In"/><Property Name="PropertyCollections" Type="BaseDataType" BindingDirection="Out"/><Property Name="SortPropertyCollections" Type="BaseDataType" BindingDirection="Out"/></ComponentType><ComponentType ID="GetAlertsForEntitiesQuery" Accessibility="Internal" Base="Visualization!CommonQueryInterface" Lifetime="ManagementPackElement"><Property Name="ManagedEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="In"/><Property Name="CriteriaString" Type="xsd://string" BindingDirection="In"/><Property Name="SortProperties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]" BindingDirection="In"/><Property Name="AlertProperties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]" BindingDirection="In"/><Property Name="DisplayStrings" Type="BaseDataType" BindingDirection="Both"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Visualization.Components.WidgetFilterControl" Accessibility="Internal" Base="Microsoft.Windows.Server.10.0.Visualization.Components.FilterControl" Lifetime="ManagementPackElement"/><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Port" Accessibility="Public" Lifetime="ManagementPackElement"/><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.GridLayoutType" Accessibility="Public" Base="Visualization!Microsoft.SystemCenter.Visualization.GridLayout" Lifetime="ManagementPackElement"/><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Process" Accessibility="Public" Lifetime="ManagementPackElement"/><ComponentType ID="GridLayout02CellSplitVerticalConfig" Accessibility="Public" Base="Visualization!Microsoft.SystemCenter.Visualization.GridLayoutGenericConfig" Lifetime="ManagementPackElement"/><ComponentType ID="GridLayout03CellBigLeftConfig" Accessibility="Public" Base="Visualization!Microsoft.SystemCenter.Visualization.GridLayoutGenericConfig" Lifetime="ManagementPackElement"/><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget.Port" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="TargetServers" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="Both"/><Property Name="SelectedEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="Both"/><Property Name="AutoRefreshTickInterval" Type="xsd://int" BindingDirection="In"><SimpleValue Type="xsd://int" Value="300"/></Property><Property Name="Columns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.HealthState/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="Path"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.Path/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='Path']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="GroupedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"/><Property Name="SortedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Ascending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="Criteria" Type="xsd://string" BindingDirection="In"/><Property Name="TargetIds" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel[]" BindingDirection="In"/><Property Name="BaseManagementPackTypes" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="ShowSearchBar" Type="xsd://boolean" BindingDirection="In"><SimpleValue Type="xsd://boolean" Value="True"/></Property><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType"><Binding PropertyId="FullyQualifiedName"><SimpleValue Type="xsd://string" Value="System.Library!System.Group"/></Binding></ComplexValue></ComplexValueCollection></Property></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.PortList.Widget" Accessibility="Internal" Base="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget.Port" Lifetime="ManagementPackElement"/><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="TargetServers" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="Both"/><Property Name="SelectedEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="Both"/><Property Name="AutoRefreshTickInterval" Type="xsd://int" BindingDirection="In"><SimpleValue Type="xsd://int" Value="300"/></Property><Property Name="Columns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.HealthState/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="Path"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.Path/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='Path']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="GroupedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"/><Property Name="SortedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Ascending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="Criteria" Type="xsd://string" BindingDirection="In"/><Property Name="TargetIds" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel[]" BindingDirection="In"/><Property Name="BaseManagementPackTypes" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="ShowSearchBar" Type="xsd://boolean" BindingDirection="In"><SimpleValue Type="xsd://boolean" Value="True"/></Property><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType"><Binding PropertyId="FullyQualifiedName"><SimpleValue Type="xsd://string" Value="System.Library!System.Group"/></Binding></ComplexValue></ComplexValueCollection></Property></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.Widget" Accessibility="Internal" Base="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget" Lifetime="ManagementPackElement"/><ComponentType ID="Microsoft.Windows.Server.10.0.Components.GetPortMetricDataSource" Accessibility="Internal" Base="CommonDataSourceInterface" Lifetime="ManagementPackElement"><Property Name="CriteriaString" Type="xsd://string" BindingDirection="In"/><Property Name="BaseTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="MaxEntities" Type="xsd://int" BindingDirection="In"/><Property Name="TargetEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="In"/><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="SortProperties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]" BindingDirection="In"/><Property Name="TargetServers" Type="BaseDataType[]" BindingDirection="In"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.GetProcessMetricDataSource" Accessibility="Internal" Base="CommonDataSourceInterface" Lifetime="ManagementPackElement"><Property Name="CriteriaString" Type="xsd://string" BindingDirection="In"/><Property Name="BaseTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="MaxEntities" Type="xsd://int" BindingDirection="In"/><Property Name="TargetEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="In"/><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="SortProperties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]" BindingDirection="In"/><Property Name="TargetServers" Type="BaseDataType[]" BindingDirection="In"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Components.GetTopNDataSource" Accessibility="Internal" Base="CommonDataSourceInterface" Lifetime="ManagementPackElement"><Property Name="CriteriaString" Type="xsd://string" BindingDirection="In"/><Property Name="BaseTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="MaxEntities" Type="xsd://int" BindingDirection="In"/><Property Name="TargetEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="In"/><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="SortProperties" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]" BindingDirection="In"/><Property Name="TargetServers" Type="BaseDataType[]" BindingDirection="In"/></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget" Accessibility="Internal" Base="Microsoft.Windows.Server.10.0.Presentation.Components.StandartStateWidget" Lifetime="ManagementPackElement"/><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.StandartStateWidget" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="SelectedEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="Both"/><Property Name="AutoRefreshTickInterval" Type="xsd://int" BindingDirection="In"><SimpleValue Type="xsd://int" Value="180"/></Property><Property Name="Columns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.HealthState/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="Path"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.Path/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='Path']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="GroupedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"/><Property Name="SortedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Ascending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="Criteria" Type="xsd://string" BindingDirection="In"/><Property Name="TargetIds" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel[]" BindingDirection="In"/><Property Name="BaseManagementPackTypes" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="ShowSearchBar" Type="xsd://boolean" BindingDirection="In"><SimpleValue Type="xsd://boolean" Value="True"/></Property><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType"><Binding PropertyId="FullyQualifiedName"><SimpleValue Type="xsd://string" Value="System.Library!System.Group"/></Binding></ComplexValue></ComplexValueCollection></Property></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget.TopN" Accessibility="Internal" Lifetime="ManagementPackElement"><Property Name="TargetServers" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="Both"/><Property Name="SelectedEntities" Type="mpinstance://System.Library!System.Entity[]" BindingDirection="Both"/><Property Name="AutoRefreshTickInterval" Type="xsd://int" BindingDirection="In"/><Property Name="Columns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.HealthState/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="Path"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.Path/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='Path']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="GroupedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"/><Property Name="SortedColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]" BindingDirection="Both"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Ascending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/PropertyCollection[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Property><Property Name="Criteria" Type="xsd://string" BindingDirection="In"/><Property Name="TargetIds" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel[]" BindingDirection="In"/><Property Name="BaseManagementPackTypes" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"/><Property Name="ShowSearchBar" Type="xsd://boolean" BindingDirection="In"><SimpleValue Type="xsd://boolean" Value="True"/></Property><Property Name="RecursionTypeNames" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]" BindingDirection="In"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.OperationalDataTypes/BaseManagementPackType"><Binding PropertyId="FullyQualifiedName"><SimpleValue Type="xsd://string" Value="System.Library!System.Group"/></Binding></ComplexValue></ComplexValueCollection></Property></ComponentType><ComponentType ID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessTopN.Widget" Accessibility="Internal" Base="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget.TopN" Lifetime="ManagementPackElement"/></ComponentTypes><ComponentReferences><ComponentReference ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Port.Ref" Accessibility="Public" TypeID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Port" Parent="Microsoft.Windows.Server.10.0.ProcessMonitoring.Folder.Root"/><ComponentReference ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Process.Ref" Accessibility="Public" TypeID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Process" Parent="Microsoft.Windows.Server.10.0.ProcessMonitoring.Folder.Root"/></ComponentReferences><ComponentImplementations><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.DataGridColumnsToPropertyNamesImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.DataGridColumnsToPropertyNames" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.CommonComponents.DataGridColumnsToPropertyNames</ContractFactory></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Components.Common.OrEmptyItemImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.Common.OrEmptyItem" Platform="Wpf, Silverlight"><Composite><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.ComponentContainer"><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.Common.EmptyItemConsolidator"><Binding PropertyId="Dummy"><ComplexValueCollection Type="mpinstance://System.Library!System.Entity[]"><ComplexValue Type="mpinstance://System.Library!System.Entity"><Binding PropertyId="Id"><SimpleValue Type="xsd://string" Value="00000000-0000-0000-0000-000000000000"/></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="Input"><Reference>$Property/Input$</Reference></Binding><Binding PropertyId="Output"><Reference>$Property/Output$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Components.Common.EmptyItemConsolidatorImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.Common.EmptyItemConsolidator" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.Windows.Server._10._0.Components.WPF.Queries.EmptyItemConsolidator</ContractFactory></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Visualization.Components.FilterImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.Filter" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.CommonControls.Filter</ContractFactory></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Visualization.Components.FilterControlImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.FilterControl" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.CommonControls.FilterControl</ContractFactory></Unit></ComponentImplementation><ComponentImplementation ID="AlertCriteriaXMLToQueryStringImplementation" Accessibility="Internal" TypeId="AlertCriteriaXMLToQueryString" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.AlertComponents.Criteria.AlertCriteriaXMLToQueryString</ContractFactory><Property Name="QueryString" Direction="Out"><Reference>$Property/QueryString$</Reference></Property><Property Name="ConfigurationXMLString" Direction="Both"><Reference>$Property/ConfigurationXMLString$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="GetManagedEntitiesDataSourceImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.GetManagedEntitiesDataSource" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Monitoring.UnitComponents.Data.GetManagedEntitiesDataSource</ContractFactory><Property Name="ConnectionSessionTicket" Direction="In"><Reference>$Service/ConnectionSessionTicket$</Reference></Property><Property Name="IsBusy" Direction="Out"><Reference>$Service/IsBusy$</Reference></Property><Property Name="LastError" Direction="Out"><Reference>$Service/LastError$</Reference></Property><Property Name="Refresh" Direction="In"><Reference>$Property/Refresh$</Reference></Property><Property Name="Properties" Direction="In"><Reference>$Property/Properties$</Reference></Property><Property Name="DataSourceIncludeProperties" Direction="In"><Reference>$Property/DataSourceIncludeProperties$</Reference></Property><Property Name="Output" Direction="Out"><Reference>$Property/Output$</Reference></Property><Property Name="OutputItem" Direction="Out"><Reference>$Property/OutputItem$</Reference></Property><Property Name="DisplayStrings" Direction="Out"><Reference>$Property/DisplayStrings$</Reference></Property><Property Name="CriteriaString" Direction="In"><Reference>$Property/CriteriaString$</Reference></Property><Property Name="BaseTypeNames" Direction="In"><Reference>$Property/BaseTypeNames$</Reference></Property><Property Name="MaxEntities" Direction="In"><Reference>$Property/MaxEntities$</Reference></Property><Property Name="TargetEntities" Direction="In"><Reference>$Property/TargetEntities$</Reference></Property><Property Name="RecursionTypeNames" Direction="In"><Reference>$Property/RecursionTypeNames$</Reference></Property><Property Name="SortProperties" Direction="In"><Reference>$Property/SortProperties$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="StateCriteriaXMLToQueryStringImplementation" Accessibility="Internal" TypeId="StateCriteriaXMLToQueryString" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.StateWidgetComponents.Criteria.StateCriteriaXMLToQueryString</ContractFactory></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Components.ActionsHostImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.ActionsHost" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.CommonControls.Actions.ActionsHost</ContractFactory><Property Name="CompositionEngineDataContext" Direction="In"><Reference>$DataContext$</Reference></Property><Property Name="ContentElement" Direction="In"><Reference>$Property/ContentElement$</Reference></Property><Property Name="Action" Direction="Out"><Reference>$Property/Action$</Reference></Property><Property Name="ActionTypes" Direction="Out"><Reference>$Property/ActionTypes$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Components.TriggeredComponentHostImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.TriggeredComponentHost" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.CommonControls.TriggeredComponentHost</ContractFactory><Property Name="EngineDataContext" Direction="In"><Reference>$DataContext$</Reference></Property><Property Name="ComponentType" Direction="In"><Reference>$Property/ComponentType$</Reference></Property><Property Name="ComponentTarget" Direction="In"><Reference>$Property/ComponentTarget$</Reference></Property><Property Name="TriggerInstance" Direction="In"><Reference>$Property/TriggerInstance$</Reference></Property><Property Name="TriggerTypes" Direction="In"><Reference>$Property/TriggerTypes$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Components.DataGridSortColumnsToSortColumnBaseCollectionImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.DataGridSortColumnsToSortColumnBaseCollection" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Presentation.Controls.CommonComponents.DataGridSortColumnsToSortColumnBaseCollection</ContractFactory></Unit></ComponentImplementation><ComponentImplementation ID="ColumnsToQueryConfigurationMapperImplementation" Accessibility="Internal" TypeId="ColumnsToQueryConfigurationMapper" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Monitoring.UnitComponents.Data.ColumnsToQueryConfigurationMapper</ContractFactory><Property Name="PropertyList" Direction="In"><Reference>$Property/PropertyList$</Reference></Property><Property Name="SortPropertyList" Direction="In"><Reference>$Property/SortPropertyList$</Reference></Property><Property Name="PropertyCollections" Direction="Out"><Reference>$Property/PropertyCollections$</Reference></Property><Property Name="SortPropertyCollections" Direction="Out"><Reference>$Property/SortPropertyCollections$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="GetAlertsForEntitiesQueryImplementation" Accessibility="Internal" TypeId="GetAlertsForEntitiesQuery" Platform="Wpf, Silverlight"><Composite><Variable Id="DataSourceIncludeProperties" Type="xsd://string"><SimpleValue Type="xsd://string" Value="Id,MonitoringObjectId,Age,TimeInState"/></Variable><Component TypeId="ComponentCollection"><Binding PropertyId="Items"><Component TypeId="GetAlertsForEntitiesDataSource"><Binding PropertyId="Refresh"><Reference>$Property/Refresh$</Reference></Binding><Binding PropertyId="ManagedEntities"><Reference>$Property/ManagedEntities$</Reference></Binding><Binding PropertyId="CriteriaString"><Reference>$Property/CriteriaString$</Reference></Binding><Binding PropertyId="SortProperties"><Reference>$Property/SortProperties$</Reference></Binding><Binding PropertyId="Properties"><Reference>$Property/AlertProperties$</Reference></Binding><Binding PropertyId="DataSourceIncludeProperties"><Reference>$Variable/DataSourceIncludeProperties$</Reference></Binding><Binding PropertyId="Output"><Reference>$Property/Output$</Reference></Binding><Binding PropertyId="DisplayStrings"><Reference>$Property/DisplayStrings$</Reference></Binding></Component></Binding><Binding PropertyId="Items"><Component TypeId="ChunkingAlertDetailsQuery"><Binding PropertyId="Refresh"><Reference>$Property/Refresh$</Reference></Binding><Binding PropertyId="InitialChunkSize"><SimpleValue Type="xsd://string" Value="50"/></Binding><Binding PropertyId="ChunkSize"><SimpleValue Type="xsd://string" Value="500"/></Binding><Binding PropertyId="KeyPropertyName"><SimpleValue Type="xsd://string" Value="Id"/></Binding><Binding PropertyId="Properties"><Reference>$Property/AlertProperties$</Reference></Binding><Binding PropertyId="DataSourceIncludeProperties"><Reference>$Variable/DataSourceIncludeProperties$</Reference></Binding><Binding PropertyId="Data"><Reference>$Property/Output$</Reference></Binding><Binding PropertyId="SingleObject"><SimpleValue Type="xsd://string" Value="False"/></Binding><Binding PropertyId="DisplayStrings"><Reference>$Property/DisplayStrings$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="ComponentCollectionImplementation" Accessibility="Internal" TypeId="ComponentCollection" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Monitoring.UnitComponents.Containers.ComponentCollection</ContractFactory></Unit></ComponentImplementation><ComponentImplementation ID="ChunkingAlertDetailsQueryImplementation" Accessibility="Internal" TypeId="ChunkingAlertDetailsQuery" Platform="Wpf, Silverlight"><Composite><Variable Id="DetailInput" Type="BaseDataType[]"/><Variable Id="DetailOutput" Type="BaseDataType[]"/><Component TypeId="ComponentCollection"><Binding PropertyId="Items"><Component TypeId="ChunkingQuery"><Binding PropertyId="Refresh"><Reference>$Property/Refresh$</Reference></Binding><Binding PropertyId="DetailInputKeyPropertyName"><Reference>$Property/KeyPropertyName$</Reference></Binding><Binding PropertyId="DetailOutputKeyPropertyName"><SimpleValue Type="xsd://string" Value="Id"/></Binding><Binding PropertyId="DetailInput"><Reference>$Variable/DetailInput$</Reference></Binding><Binding PropertyId="DetailOutput"><Reference>$Variable/DetailOutput$</Reference></Binding><Binding PropertyId="InitialChunkSize"><Reference>$Property/InitialChunkSize$</Reference></Binding><Binding PropertyId="ChunkSize"><Reference>$Property/ChunkSize$</Reference></Binding><Binding PropertyId="RefreshStrategy"><SimpleValue Type="xsd://string" Value="OnChangeNotify"/></Binding><Binding PropertyId="Data"><Reference>$Property/Data$</Reference></Binding></Component></Binding><Binding PropertyId="Items"><Component TypeId="GetAlertDetails"><Binding PropertyId="Properties"><Reference>$Property/Properties$</Reference></Binding><Binding PropertyId="DataSourceIncludeProperties"><Reference>$Property/DataSourceIncludeProperties$</Reference></Binding><Binding PropertyId="Input"><Reference>$Variable/DetailInput$</Reference></Binding><Binding PropertyId="Output"><Reference>$Variable/DetailOutput$</Reference></Binding><Binding PropertyId="SingleObject"><Reference>$Property/SingleObject$</Reference></Binding><Binding PropertyId="DisplayStrings"><Reference>$Property/DisplayStrings$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="ChunkingQueryImplementation" Accessibility="Internal" TypeId="ChunkingQuery" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Monitoring.UnitComponents.Data.ChunkingQuery</ContractFactory><Property Name="IsBusy" Direction="Out"><Reference>$Service/IsBusy$</Reference></Property><Property Name="LastError" Direction="Out"><Reference>$Service/LastError$</Reference></Property><Property Name="Refresh" Direction="In"><Reference>$Property/Refresh$</Reference></Property><Property Name="DetailInputKeyPropertyName" Direction="In"><Reference>$Property/DetailInputKeyPropertyName$</Reference></Property><Property Name="DetailOutputKeyPropertyName" Direction="In"><Reference>$Property/DetailOutputKeyPropertyName$</Reference></Property><Property Name="DetailInput" Direction="Out"><Reference>$Property/DetailInput$</Reference></Property><Property Name="DetailOutput" Direction="In"><Reference>$Property/DetailOutput$</Reference></Property><Property Name="InitialChunkSize" Direction="In"><Reference>$Property/InitialChunkSize$</Reference></Property><Property Name="ChunkSize" Direction="In"><Reference>$Property/ChunkSize$</Reference></Property><Property Name="Data" Direction="In"><Reference>$Property/Data$</Reference></Property><Property Name="RefreshStrategy" Direction="In"><Reference>$Property/RefreshStrategy$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="GetAlertDetailsImplementation" Accessibility="Internal" TypeId="GetAlertDetails" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.EnterpriseManagement.Monitoring.UnitComponents.Data.GetAlertDetails</ContractFactory><Property Name="ConnectionSessionTicket" Direction="In"><Reference>$Service/ConnectionSessionTicket$</Reference></Property><Property Name="IsBusy" Direction="Out"><Reference>$Service/IsBusy$</Reference></Property><Property Name="LastError" Direction="Out"><Reference>$Service/LastError$</Reference></Property><Property Name="Refresh" Direction="In"><Reference>$Property/Refresh$</Reference></Property><Property Name="Properties" Direction="In"><Reference>$Property/Properties$</Reference></Property><Property Name="DataSourceIncludeProperties" Direction="In"><Reference>$Property/DataSourceIncludeProperties$</Reference></Property><Property Name="Output" Direction="Out"><Reference>$Property/Output$</Reference></Property><Property Name="Input" Direction="In"><Reference>$Property/Input$</Reference></Property><Property Name="DisplayStrings" Direction="In"><Reference>$Property/DisplayStrings$</Reference></Property><Property Name="SingleObject" Direction="In"><Reference>$Property/SingleObject$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Visualization.Components.WidgetFilterControlImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.WidgetFilterControl" Platform="Wpf, Silverlight"><Composite><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGrid"><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="ColumnCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridColumn"><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="IsVisible"><Reference>$Property/ControlIsVisible$</Reference></Binding><Binding PropertyId="Content"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGrid"><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="ColumnCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridColumn"><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.FilterControl"><Binding PropertyId="Criteria"><Reference>$Property/Criteria$</Reference></Binding><Binding PropertyId="FilterActions"><Reference>$Property/FilterActions$</Reference></Binding><Binding PropertyId="ControlIsVisible"><Reference>$Property/ControlIsVisible$</Reference></Binding></Component></Binding></Component></Binding><Binding PropertyId="Padding"><SimpleValue Type="xsd://int" Value="2"/></Binding></Component></Binding></Component></Binding><Binding PropertyId="Padding"><SimpleValue Type="xsd://int" Value="0"/></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.PortImplementation" Accessibility="Public" TypeId="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Port" Platform="Wpf"><Composite><Variable Id="SelectedServers" Type="BaseDataType[]"/><Variable Id="HostForServers" Type="BaseDataType[]"/><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.ComponentContainer"><Binding PropertyId="Visual"><Component TypeId="Microsoft.Windows.Server.10.0.Presentation.Dashboard.GridLayoutType"><Binding PropertyId="ConfigType"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.2016.ProcessPortMonitoring!GridLayout02CellSplitVerticalConfig"/></Binding><Binding PropertyId="CellRegionMappings"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellRegionMapping[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellRegionMapping"><Binding PropertyId="RegionContent"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.2016.ProcessPortMonitoring!Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget"/></Binding><Binding PropertyId="RegionId"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget"/></Binding><Binding PropertyId="RegionParameters"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter"><Binding PropertyId="Name"><SimpleValue Type="xsd://string" Value="SelectedEntities"/></Binding><Binding PropertyId="Value"><Reference>$Variable/SelectedServers$</Reference></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter"><Binding PropertyId="Name"><SimpleValue Type="xsd://string" Value="TargetIds"/></Binding><Binding PropertyId="Value"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel"><Binding PropertyId="MPInstance"><ComplexValue Type="mpinstance://System.Library!System.Entity"><Binding PropertyId="Id"><SimpleValue Type="xsd://string" Value="8d16bfac-5710-f559-22c8-bf2d977601d5"/></Binding></ComplexValue></Binding><Binding PropertyId="RecursionLevel"><SimpleValue Type="xsd://int" Value="-1"/></Binding></ComplexValue></ComplexValueCollection></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="CellIndex"><SimpleValue Type="xsd://int" Value="0"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellRegionMapping"><Binding PropertyId="RegionContent"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.2016.ProcessPortMonitoring!Microsoft.Windows.Server.10.0.Presentation.Components.PortList.Widget"/></Binding><Binding PropertyId="RegionId"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.10.0.Presentation.Components.PortList.Widget"/></Binding><Binding PropertyId="RegionParameters"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter"><Binding PropertyId="Name"><SimpleValue Type="xsd://string" Value="TargetServers"/></Binding><Binding PropertyId="Value"><Reference>$Variable/SelectedServers$</Reference></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="CellIndex"><SimpleValue Type="xsd://int" Value="1"/></Binding></ComplexValue></ComplexValueCollection></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.Common.OrEmptyItem"><Binding PropertyId="Input"><Reference>$Variable/SelectedServers$</Reference></Binding><Binding PropertyId="Output"><Reference>$Variable/HostForServers$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.GridLayoutImplementation" Accessibility="Public" TypeId="Microsoft.Windows.Server.10.0.Presentation.Dashboard.GridLayoutType" Platform="Wpf"><Composite><Base/></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.ProcessImplementation" Accessibility="Public" TypeId="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Process" Platform="Wpf"><Composite><Variable Id="SelectedServers" Type="BaseDataType[]"/><Variable Id="HostForServers" Type="BaseDataType[]"/><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.ComponentContainer"><Binding PropertyId="Visual"><Component TypeId="Microsoft.Windows.Server.10.0.Presentation.Dashboard.GridLayoutType"><Binding PropertyId="ConfigType"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.2016.ProcessPortMonitoring!GridLayout02CellSplitVerticalConfig"/></Binding><Binding PropertyId="CellRegionMappings"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellRegionMapping[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellRegionMapping"><Binding PropertyId="RegionContent"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.2016.ProcessPortMonitoring!Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget"/></Binding><Binding PropertyId="RegionId"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget"/></Binding><Binding PropertyId="RegionParameters"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter"><Binding PropertyId="Name"><SimpleValue Type="xsd://string" Value="SelectedEntities"/></Binding><Binding PropertyId="Value"><Reference>$Variable/SelectedServers$</Reference></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter"><Binding PropertyId="Name"><SimpleValue Type="xsd://string" Value="TargetIds"/></Binding><Binding PropertyId="Value"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataProvider/MPInstanceWithRecursionLevel"><Binding PropertyId="MPInstance"><ComplexValue Type="mpinstance://System.Library!System.Entity"><Binding PropertyId="Id"><SimpleValue Type="xsd://string" Value="349cf469-24fb-9f6d-dee5-74d3b6b2a5c7"/></Binding></ComplexValue></Binding><Binding PropertyId="RecursionLevel"><SimpleValue Type="xsd://int" Value="-1"/></Binding></ComplexValue></ComplexValueCollection></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="CellIndex"><SimpleValue Type="xsd://int" Value="0"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellRegionMapping"><Binding PropertyId="RegionContent"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.2016.ProcessPortMonitoring!Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.Widget"/></Binding><Binding PropertyId="RegionId"><SimpleValue Type="xsd://string" Value="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.Widget"/></Binding><Binding PropertyId="RegionParameters"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/HostedRequestParameter"><Binding PropertyId="Name"><SimpleValue Type="xsd://string" Value="TargetServers"/></Binding><Binding PropertyId="Value"><Reference>$Variable/SelectedServers$</Reference></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="CellIndex"><SimpleValue Type="xsd://int" Value="1"/></Binding></ComplexValue></ComplexValueCollection></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.Common.OrEmptyItem"><Binding PropertyId="Input"><Reference>$Variable/SelectedServers$</Reference></Binding><Binding PropertyId="Output"><Reference>$Variable/HostForServers$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="GridLayout02CellSplitVerticalConfigImplementation" Accessibility="Internal" TypeId="GridLayout02CellSplitVerticalConfig" Platform="All"><Composite><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.GridLayoutGenericConfig"><Binding PropertyId="CellDefinitions"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellDefinition[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellDefinition"><Binding PropertyId="Row"><SimpleValue Type="xsd://int" Value="0"/></Binding><Binding PropertyId="RowSpan"><SimpleValue Type="xsd://int" Value="1"/></Binding><Binding PropertyId="Column"><SimpleValue Type="xsd://int" Value="0"/></Binding><Binding PropertyId="ColumnSpan"><SimpleValue Type="xsd://int" Value="1"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellDefinition"><Binding PropertyId="Row"><SimpleValue Type="xsd://int" Value="0"/></Binding><Binding PropertyId="RowSpan"><SimpleValue Type="xsd://int" Value="1"/></Binding><Binding PropertyId="Column"><SimpleValue Type="xsd://int" Value="1"/></Binding><Binding PropertyId="ColumnSpan"><SimpleValue Type="xsd://int" Value="4"/></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="RowMinHeight"><SimpleValue Type="xsd://int" Value="100"/></Binding><Binding PropertyId="ColumnMinWidth"><SimpleValue Type="xsd://int" Value="300"/></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="GridLayout03CellBigLeftConfigImplementation" Accessibility="Internal" TypeId="GridLayout03CellBigLeftConfig" Platform="All"><Composite><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.GridLayoutGenericConfig"><Binding PropertyId="CellDefinitions"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellDefinition[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellDefinition"><Binding PropertyId="Row"><SimpleValue Type="xsd://int" Value="0"/></Binding><Binding PropertyId="RowSpan"><SimpleValue Type="xsd://int" Value="3"/></Binding><Binding PropertyId="Column"><SimpleValue Type="xsd://int" Value="0"/></Binding><Binding PropertyId="ColumnSpan"><SimpleValue Type="xsd://int" Value="1"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellDefinition"><Binding PropertyId="Row"><SimpleValue Type="xsd://int" Value="0"/></Binding><Binding PropertyId="RowSpan"><SimpleValue Type="xsd://int" Value="1"/></Binding><Binding PropertyId="Column"><SimpleValue Type="xsd://int" Value="1"/></Binding><Binding PropertyId="ColumnSpan"><SimpleValue Type="xsd://int" Value="3"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.LayoutConfig/CellDefinition"><Binding PropertyId="Row"><SimpleValue Type="xsd://int" Value="1"/></Binding><Binding PropertyId="RowSpan"><SimpleValue Type="xsd://int" Value="2"/></Binding><Binding PropertyId="Column"><SimpleValue Type="xsd://int" Value="1"/></Binding><Binding PropertyId="ColumnSpan"><SimpleValue Type="xsd://int" Value="3"/></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="RowMinHeight"><SimpleValue Type="xsd://int" Value="50"/></Binding><Binding PropertyId="ColumnMinWidth"><SimpleValue Type="xsd://int" Value="300"/></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidgetImplementation.Port" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget.Port" Platform="All"><Composite><Variable Id="AutoRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/AutoRefreshAction"/><Variable Id="ConsolidatedRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/RefreshAction"/><Variable Id="ActionHostActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="FilterCriteria" Type="BaseDataType"/><Variable Id="ManagedEntities" Type="BaseDataType[]"/><Variable Id="SelectedGridItem" Type="BaseDataType"/><Variable Id="QueryCriteria" Type="xsd://string"/><Variable Id="DataGridActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="SortColumnBaseCollection" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/SortColumnBase[]"/><Variable Id="ProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]"/><Variable Id="SortProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]"/><Variable Id="VisualizedDataCount" Type="xsd://int"/><Variable Id="FilterPropertyNames" Type="xsd://string[]"/><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.ComponentContainer"><Binding PropertyId="Visual"><Component TypeId="Microsoft.Windows.Server.10.0.Components.ActionsHost"><Binding PropertyId="ActionTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ShowFilterAction"/></Binding><Binding PropertyId="Action"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ContentElement"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGrid"><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="Auto"/></Binding></Component></Binding><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="ColumnCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridColumn"><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.WidgetFilterControl"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="FilterActions"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ControlIsVisible"><Reference>$Property/ShowSearchBar$</Reference></Binding></Component></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="1"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.DataGrid"><Binding PropertyId="KeyPropertyName"><SimpleValue Type="xsd://string" Value="Id"/></Binding><Binding PropertyId="Data"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Filter"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.Filter"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="CellComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridGenericCell"/></Binding><Binding PropertyId="ColumnHeaderComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridColumnHeaderCell"/></Binding><Binding PropertyId="SelectionMode"><SimpleValue Type="xsd://string" Value="SingleRowSelect"/></Binding><Binding PropertyId="Action"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="SelectedRow"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="SelectedRows"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="ColumnHeaderVisible"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="CanReorderColumns"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="ItemsCount"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="AutoSelect"><SimpleValue Type="xsd://boolean" Value="True"/></Binding></Component></Binding></Component></Binding></Component></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.DataGridColumnsToPropertyNames"><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.TriggeredComponentHost"><Binding PropertyId="ComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ManagedEntityPropertyTask"/></Binding><Binding PropertyId="ComponentTarget"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="TriggerInstance"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ItemPropertiesAction"/></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/DoubleClickedAction"/></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/SelectedItems$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/Subtitle$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.DataGridSortColumnsToSortColumnBaseCollection"><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortColumnBaseCollection"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="ColumnsToQueryConfigurationMapper"><Binding PropertyId="PropertyList"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="SortPropertyList"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding><Binding PropertyId="PropertyCollections"><Reference>$Variable/ProjectionColumns$</Reference></Binding><Binding PropertyId="SortPropertyCollections"><Reference>$Variable/SortProjectionColumns$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.AutoRefreshTimer"><Binding PropertyId="TickInterval"><Reference>$Property/AutoRefreshTickInterval$</Reference></Binding><Binding PropertyId="AutoRefreshAction"><Reference>$Variable/AutoRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.Consolidator"><Binding PropertyId="From1"><Reference>$Variable/AutoRefreshAction$</Reference></Binding><Binding PropertyId="From2"><Reference>$Service/RefreshAction$</Reference></Binding><Binding PropertyId="To"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="StateCriteriaXMLToQueryString"><Binding PropertyId="ConfigurationXMLString"><Reference>$Property/Criteria$</Reference></Binding><Binding PropertyId="QueryString"><Reference>$Variable/QueryCriteria$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.GetPortMetricDataSource"><Binding PropertyId="CriteriaString"><Reference>$Variable/QueryCriteria$</Reference></Binding><Binding PropertyId="Output"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="TargetEntities"><Reference>$Property/TargetIds$</Reference></Binding><Binding PropertyId="BaseTypeNames"><Reference>$Property/BaseManagementPackTypes$</Reference></Binding><Binding PropertyId="RecursionTypeNames"><Reference>$Property/RecursionTypeNames$</Reference></Binding><Binding PropertyId="Properties"><Reference>$Variable/ProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="SortProperties"><Reference>$Variable/SortProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="Refresh"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding><Binding PropertyId="TargetServers"><Reference>$Property/TargetServers$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.PortList.Widget.Implementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.PortList.Widget" Platform="Wpf, Silverlight"><Composite><Base><Binding PropertyId="ShowSearchBar"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Columns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="ServiceName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Process Name"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="150"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='ServiceName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="PID"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="PID"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='PID']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="Protocol"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Protocol"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='Protocol']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="LocalAddress"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Local Address"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='LocalAddress']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="LocalPort"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Local Port"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='LocalPort']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="RemoteAddress"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Remote Address"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='RemoteAddress']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="RemotePort"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Remote Port"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='RemotePort']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="State"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="State"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='State']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="OldState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Old State"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='OldState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="SortedColumns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="ServiceName"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Ascending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='ServiceName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Binding></Base></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidgetImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget" Platform="All"><Composite><Variable Id="AutoRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/AutoRefreshAction"/><Variable Id="ConsolidatedRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/RefreshAction"/><Variable Id="ActionHostActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="FilterCriteria" Type="BaseDataType"/><Variable Id="ManagedEntities" Type="BaseDataType[]"/><Variable Id="SelectedGridItem" Type="BaseDataType"/><Variable Id="QueryCriteria" Type="xsd://string"/><Variable Id="DataGridActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="SortColumnBaseCollection" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/SortColumnBase[]"/><Variable Id="ProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]"/><Variable Id="SortProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]"/><Variable Id="VisualizedDataCount" Type="xsd://int"/><Variable Id="FilterPropertyNames" Type="xsd://string[]"/><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.ComponentContainer"><Binding PropertyId="Visual"><Component TypeId="Microsoft.Windows.Server.10.0.Components.ActionsHost"><Binding PropertyId="ActionTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ShowFilterAction"/></Binding><Binding PropertyId="Action"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ContentElement"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGrid"><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="Auto"/></Binding></Component></Binding><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="ColumnCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridColumn"><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.WidgetFilterControl"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="FilterActions"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ControlIsVisible"><Reference>$Property/ShowSearchBar$</Reference></Binding></Component></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="1"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.DataGrid"><Binding PropertyId="KeyPropertyName"><SimpleValue Type="xsd://string" Value="Id"/></Binding><Binding PropertyId="Data"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Filter"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.Filter"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="CellComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridGenericCell"/></Binding><Binding PropertyId="ColumnHeaderComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridColumnHeaderCell"/></Binding><Binding PropertyId="SelectionMode"><SimpleValue Type="xsd://string" Value="SingleRowSelect"/></Binding><Binding PropertyId="Action"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="SelectedRow"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="SelectedRows"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="ColumnHeaderVisible"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="CanReorderColumns"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="ItemsCount"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="AutoSelect"><SimpleValue Type="xsd://boolean" Value="True"/></Binding></Component></Binding></Component></Binding></Component></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.DataGridColumnsToPropertyNames"><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.TriggeredComponentHost"><Binding PropertyId="ComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ManagedEntityPropertyTask"/></Binding><Binding PropertyId="ComponentTarget"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="TriggerInstance"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ItemPropertiesAction"/></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/DoubleClickedAction"/></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/SelectedItems$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/Subtitle$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.DataGridSortColumnsToSortColumnBaseCollection"><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortColumnBaseCollection"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="ColumnsToQueryConfigurationMapper"><Binding PropertyId="PropertyList"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="SortPropertyList"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding><Binding PropertyId="PropertyCollections"><Reference>$Variable/ProjectionColumns$</Reference></Binding><Binding PropertyId="SortPropertyCollections"><Reference>$Variable/SortProjectionColumns$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.AutoRefreshTimer"><Binding PropertyId="TickInterval"><Reference>$Property/AutoRefreshTickInterval$</Reference></Binding><Binding PropertyId="AutoRefreshAction"><Reference>$Variable/AutoRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.Consolidator"><Binding PropertyId="From1"><Reference>$Variable/AutoRefreshAction$</Reference></Binding><Binding PropertyId="From2"><Reference>$Service/RefreshAction$</Reference></Binding><Binding PropertyId="To"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="StateCriteriaXMLToQueryString"><Binding PropertyId="ConfigurationXMLString"><Reference>$Property/Criteria$</Reference></Binding><Binding PropertyId="QueryString"><Reference>$Variable/QueryCriteria$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.GetProcessMetricDataSource"><Binding PropertyId="CriteriaString"><Reference>$Variable/QueryCriteria$</Reference></Binding><Binding PropertyId="Output"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="TargetEntities"><Reference>$Property/TargetIds$</Reference></Binding><Binding PropertyId="BaseTypeNames"><Reference>$Property/BaseManagementPackTypes$</Reference></Binding><Binding PropertyId="RecursionTypeNames"><Reference>$Property/RecursionTypeNames$</Reference></Binding><Binding PropertyId="Properties"><Reference>$Variable/ProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="SortProperties"><Reference>$Variable/SortProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="Refresh"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding><Binding PropertyId="TargetServers"><Reference>$Property/TargetServers$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.Widget.Implementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.Widget" Platform="Wpf, Silverlight"><Composite><Base><Binding PropertyId="ShowSearchBar"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Columns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="AggregateHealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.HealthState/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='AggregateHealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="PID"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="PID"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='PID']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="ProcessName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Process Name"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="100"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='ProcessName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="CpuHealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="CPU Health"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='CpuHealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="CpuUsage"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="CPU Used (%)"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='CpuUsage']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="CpuTime"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="CPU Time"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='CpuTime']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="TotalProcessTime"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Total Process Time"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='TotalProcessTime']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="MemoryHealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Memory Health"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='MemoryHealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="MemoryUsage"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Memory Used (%)"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='MemoryUsage']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HandleCountHealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Handle Count Health"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HandleCountHealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HandleCount"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Handle Count"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HandleCount']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="ThreadCount"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Thread Count"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='ThreadCount']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="SortedColumns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="AggregateHealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Health State"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Descending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='AggregateHealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Binding></Base></Composite></ComponentImplementation><ComponentImplementation ID="GetPortMetricDataSourceImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.GetPortMetricDataSource" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.Windows.Server._10._0.Components.WPF.Queries.GetPortMetricDataSource</ContractFactory><Property Name="ConnectionSessionTicket" Direction="In"><Reference>$Service/ConnectionSessionTicket$</Reference></Property><Property Name="IsBusy" Direction="Out"><Reference>$Service/IsBusy$</Reference></Property><Property Name="LastError" Direction="Out"><Reference>$Service/LastError$</Reference></Property><Property Name="Refresh" Direction="In"><Reference>$Property/Refresh$</Reference></Property><Property Name="Properties" Direction="In"><Reference>$Property/Properties$</Reference></Property><Property Name="DataSourceIncludeProperties" Direction="In"><Reference>$Property/DataSourceIncludeProperties$</Reference></Property><Property Name="Output" Direction="Out"><Reference>$Property/Output$</Reference></Property><Property Name="OutputItem" Direction="Out"><Reference>$Property/OutputItem$</Reference></Property><Property Name="DisplayStrings" Direction="Out"><Reference>$Property/DisplayStrings$</Reference></Property><Property Name="CriteriaString" Direction="In"><Reference>$Property/CriteriaString$</Reference></Property><Property Name="BaseTypeNames" Direction="In"><Reference>$Property/BaseTypeNames$</Reference></Property><Property Name="MaxEntities" Direction="In"><Reference>$Property/MaxEntities$</Reference></Property><Property Name="TargetEntities" Direction="In"><Reference>$Property/TargetEntities$</Reference></Property><Property Name="RecursionTypeNames" Direction="In"><Reference>$Property/RecursionTypeNames$</Reference></Property><Property Name="SortProperties" Direction="In"><Reference>$Property/SortProperties$</Reference></Property><Property Name="Input" Direction="In"><Reference>$Property/TargetServers$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="GetProcessMetricDataSourceImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.GetProcessMetricDataSource" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.Windows.Server._10._0.Components.WPF.Queries.GetProcessMetricDataSource</ContractFactory><Property Name="ConnectionSessionTicket" Direction="In"><Reference>$Service/ConnectionSessionTicket$</Reference></Property><Property Name="IsBusy" Direction="Out"><Reference>$Service/IsBusy$</Reference></Property><Property Name="LastError" Direction="Out"><Reference>$Service/LastError$</Reference></Property><Property Name="Refresh" Direction="In"><Reference>$Property/Refresh$</Reference></Property><Property Name="Properties" Direction="In"><Reference>$Property/Properties$</Reference></Property><Property Name="DataSourceIncludeProperties" Direction="In"><Reference>$Property/DataSourceIncludeProperties$</Reference></Property><Property Name="Output" Direction="Out"><Reference>$Property/Output$</Reference></Property><Property Name="OutputItem" Direction="Out"><Reference>$Property/OutputItem$</Reference></Property><Property Name="DisplayStrings" Direction="Out"><Reference>$Property/DisplayStrings$</Reference></Property><Property Name="CriteriaString" Direction="In"><Reference>$Property/CriteriaString$</Reference></Property><Property Name="BaseTypeNames" Direction="In"><Reference>$Property/BaseTypeNames$</Reference></Property><Property Name="MaxEntities" Direction="In"><Reference>$Property/MaxEntities$</Reference></Property><Property Name="TargetEntities" Direction="In"><Reference>$Property/TargetEntities$</Reference></Property><Property Name="RecursionTypeNames" Direction="In"><Reference>$Property/RecursionTypeNames$</Reference></Property><Property Name="SortProperties" Direction="In"><Reference>$Property/SortProperties$</Reference></Property><Property Name="Input" Direction="In"><Reference>$Property/TargetServers$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="GetTopNDataSourceImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Components.GetTopNDataSource" Platform="Wpf, Silverlight"><Unit><ContractFactory>Microsoft.Windows.Server._10._0.Components.WPF.Queries.GetTopNDataSource</ContractFactory><Property Name="ConnectionSessionTicket" Direction="In"><Reference>$Service/ConnectionSessionTicket$</Reference></Property><Property Name="IsBusy" Direction="Out"><Reference>$Service/IsBusy$</Reference></Property><Property Name="LastError" Direction="Out"><Reference>$Service/LastError$</Reference></Property><Property Name="Refresh" Direction="In"><Reference>$Property/Refresh$</Reference></Property><Property Name="Properties" Direction="In"><Reference>$Property/Properties$</Reference></Property><Property Name="DataSourceIncludeProperties" Direction="In"><Reference>$Property/DataSourceIncludeProperties$</Reference></Property><Property Name="Output" Direction="Out"><Reference>$Property/Output$</Reference></Property><Property Name="OutputItem" Direction="Out"><Reference>$Property/OutputItem$</Reference></Property><Property Name="DisplayStrings" Direction="Out"><Reference>$Property/DisplayStrings$</Reference></Property><Property Name="CriteriaString" Direction="In"><Reference>$Property/CriteriaString$</Reference></Property><Property Name="BaseTypeNames" Direction="In"><Reference>$Property/BaseTypeNames$</Reference></Property><Property Name="MaxEntities" Direction="In"><Reference>$Property/MaxEntities$</Reference></Property><Property Name="TargetEntities" Direction="In"><Reference>$Property/TargetEntities$</Reference></Property><Property Name="RecursionTypeNames" Direction="In"><Reference>$Property/RecursionTypeNames$</Reference></Property><Property Name="SortProperties" Direction="In"><Reference>$Property/SortProperties$</Reference></Property><Property Name="Input" Direction="In"><Reference>$Property/TargetServers$</Reference></Property></Unit></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget.Implementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget" Platform="Wpf, Silverlight"><Composite><Base><Binding PropertyId="ShowSearchBar"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Columns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.HealthState/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HealthState"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="DisplayName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.DisplayName/DisplayName$"/></Binding><Binding PropertyId="CellComponentType"><SimpleValue Type="xsd://string" Value=""/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='DisplayName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding><Binding PropertyId="HeaderComponentType"><SimpleValue Type="xsd://string" Value=""/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="SortedColumns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Health State"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Descending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='HealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Binding></Base></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.StandartStateWidgetImplementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.StandartStateWidget" Platform="All"><Composite><Variable Id="AutoRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/AutoRefreshAction"/><Variable Id="ConsolidatedRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/RefreshAction"/><Variable Id="ActionHostActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="FilterCriteria" Type="BaseDataType"/><Variable Id="ManagedEntities" Type="BaseDataType[]"/><Variable Id="SelectedGridItem" Type="BaseDataType"/><Variable Id="QueryCriteria" Type="xsd://string"/><Variable Id="DataGridActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="SortColumnBaseCollection" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/SortColumnBase[]"/><Variable Id="ProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]"/><Variable Id="SortProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]"/><Variable Id="VisualizedDataCount" Type="xsd://int"/><Variable Id="FilterPropertyNames" Type="xsd://string[]"/><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.ComponentContainer"><Binding PropertyId="Visual"><Component TypeId="Microsoft.Windows.Server.10.0.Components.ActionsHost"><Binding PropertyId="ActionTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ShowFilterAction"/></Binding><Binding PropertyId="Action"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ContentElement"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGrid"><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="Auto"/></Binding></Component></Binding><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="ColumnCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridColumn"><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.WidgetFilterControl"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="FilterActions"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ControlIsVisible"><Reference>$Property/ShowSearchBar$</Reference></Binding></Component></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="1"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.DataGrid"><Binding PropertyId="KeyPropertyName"><SimpleValue Type="xsd://string" Value="Id"/></Binding><Binding PropertyId="Data"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Filter"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.Filter"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="CellComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridGenericCell"/></Binding><Binding PropertyId="ColumnHeaderComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridColumnHeaderCell"/></Binding><Binding PropertyId="SelectionMode"><SimpleValue Type="xsd://string" Value="SingleRowSelect"/></Binding><Binding PropertyId="Action"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="SelectedRow"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="SelectedRows"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="ColumnHeaderVisible"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="CanReorderColumns"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="ItemsCount"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="AutoSelect"><SimpleValue Type="xsd://boolean" Value="True"/></Binding></Component></Binding></Component></Binding></Component></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.DataGridColumnsToPropertyNames"><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.TriggeredComponentHost"><Binding PropertyId="ComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ManagedEntityPropertyTask"/></Binding><Binding PropertyId="ComponentTarget"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="TriggerInstance"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ItemPropertiesAction"/></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/DoubleClickedAction"/></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/SelectedItems$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/Subtitle$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.DataGridSortColumnsToSortColumnBaseCollection"><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortColumnBaseCollection"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="ColumnsToQueryConfigurationMapper"><Binding PropertyId="PropertyList"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="SortPropertyList"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding><Binding PropertyId="PropertyCollections"><Reference>$Variable/ProjectionColumns$</Reference></Binding><Binding PropertyId="SortPropertyCollections"><Reference>$Variable/SortProjectionColumns$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.AutoRefreshTimer"><Binding PropertyId="TickInterval"><Reference>$Property/AutoRefreshTickInterval$</Reference></Binding><Binding PropertyId="AutoRefreshAction"><Reference>$Variable/AutoRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.Consolidator"><Binding PropertyId="From1"><Reference>$Variable/AutoRefreshAction$</Reference></Binding><Binding PropertyId="From2"><Reference>$Service/RefreshAction$</Reference></Binding><Binding PropertyId="To"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="StateCriteriaXMLToQueryString"><Binding PropertyId="ConfigurationXMLString"><Reference>$Property/Criteria$</Reference></Binding><Binding PropertyId="QueryString"><Reference>$Variable/QueryCriteria$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.GetManagedEntitiesDataSource"><Binding PropertyId="CriteriaString"><Reference>$Variable/QueryCriteria$</Reference></Binding><Binding PropertyId="Output"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="TargetEntities"><Reference>$Property/TargetIds$</Reference></Binding><Binding PropertyId="BaseTypeNames"><Reference>$Property/BaseManagementPackTypes$</Reference></Binding><Binding PropertyId="RecursionTypeNames"><Reference>$Property/RecursionTypeNames$</Reference></Binding><Binding PropertyId="Properties"><Reference>$Variable/ProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="SortProperties"><Reference>$Variable/SortProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="Refresh"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidgetImplementation.TopN" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.CustomStateWidget.TopN" Platform="All"><Composite><Variable Id="AutoRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/AutoRefreshAction"/><Variable Id="ConsolidatedRefreshAction" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/RefreshAction"/><Variable Id="ActionHostActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="FilterCriteria" Type="BaseDataType"/><Variable Id="ManagedEntities" Type="BaseDataType[]"/><Variable Id="SelectedGridItem" Type="BaseDataType"/><Variable Id="QueryCriteria" Type="xsd://string"/><Variable Id="DataGridActions" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/Action"/><Variable Id="SortColumnBaseCollection" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/SortColumnBase[]"/><Variable Id="ProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/ValueDefinition[]"/><Variable Id="SortProjectionColumns" Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataSourceTypes/SortValueDefinition[]"/><Variable Id="VisualizedDataCount" Type="xsd://int"/><Variable Id="FilterPropertyNames" Type="xsd://string[]"/><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.ComponentContainer"><Binding PropertyId="Visual"><Component TypeId="Microsoft.Windows.Server.10.0.Components.ActionsHost"><Binding PropertyId="ActionTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ShowFilterAction"/></Binding><Binding PropertyId="Action"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ContentElement"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGrid"><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="Auto"/></Binding></Component></Binding><Binding PropertyId="RowCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridRow"><Binding PropertyId="Height"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="ColumnCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridColumn"><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="*"/></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.WidgetFilterControl"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="FilterActions"><Reference>$Variable/ActionHostActions$</Reference></Binding><Binding PropertyId="ControlIsVisible"><Reference>$Property/ShowSearchBar$</Reference></Binding></Component></Binding></Component></Binding><Binding PropertyId="CellCollection"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.LayoutGridCell"><Binding PropertyId="RowId"><SimpleValue Type="xsd://string" Value="1"/></Binding><Binding PropertyId="ColumnId"><SimpleValue Type="xsd://string" Value="0"/></Binding><Binding PropertyId="Content"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.DataGrid"><Binding PropertyId="KeyPropertyName"><SimpleValue Type="xsd://string" Value="Id"/></Binding><Binding PropertyId="Data"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Filter"><Component TypeId="Microsoft.Windows.Server.10.0.Visualization.Components.Filter"><Binding PropertyId="Criteria"><Reference>$Variable/FilterCriteria$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="CellComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridGenericCell"/></Binding><Binding PropertyId="ColumnHeaderComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.DataGridColumnHeaderCell"/></Binding><Binding PropertyId="SelectionMode"><SimpleValue Type="xsd://string" Value="SingleRowSelect"/></Binding><Binding PropertyId="Action"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="SelectedRow"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="SelectedRows"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="ColumnHeaderVisible"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="CanReorderColumns"><SimpleValue Type="xsd://string" Value="True"/></Binding><Binding PropertyId="ItemsCount"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="AutoSelect"><SimpleValue Type="xsd://boolean" Value="True"/></Binding></Component></Binding></Component></Binding></Component></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.DataGridColumnsToPropertyNames"><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="Columns"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="PropertyNames"><Reference>$Variable/FilterPropertyNames$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.TriggeredComponentHost"><Binding PropertyId="ComponentType"><SimpleValue Type="xsd://string" Value="Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ManagedEntityPropertyTask"/></Binding><Binding PropertyId="ComponentTarget"><Reference>$Variable/SelectedGridItem$</Reference></Binding><Binding PropertyId="TriggerInstance"><Reference>$Variable/DataGridActions$</Reference></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/ItemPropertiesAction"/></Binding><Binding PropertyId="TriggerTypes"><SimpleValue Type="xsd://string" Value="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ActionTypes/DoubleClickedAction"/></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Property/SelectedEntities$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/SelectedItems$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.OneWaySync"><Binding PropertyId="From"><Reference>$Variable/VisualizedDataCount$</Reference></Binding><Binding PropertyId="To"><Reference>$Service/Subtitle$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.DataGridSortColumnsToSortColumnBaseCollection"><Binding PropertyId="SortedColumns"><Reference>$Property/SortedColumns$</Reference></Binding><Binding PropertyId="GroupedColumns"><Reference>$Property/GroupedColumns$</Reference></Binding><Binding PropertyId="SortColumnBaseCollection"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="ColumnsToQueryConfigurationMapper"><Binding PropertyId="PropertyList"><Reference>$Property/Columns$</Reference></Binding><Binding PropertyId="SortPropertyList"><Reference>$Variable/SortColumnBaseCollection$</Reference></Binding><Binding PropertyId="PropertyCollections"><Reference>$Variable/ProjectionColumns$</Reference></Binding><Binding PropertyId="SortPropertyCollections"><Reference>$Variable/SortProjectionColumns$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.AutoRefreshTimer"><Binding PropertyId="TickInterval"><Reference>$Property/AutoRefreshTickInterval$</Reference></Binding><Binding PropertyId="AutoRefreshAction"><Reference>$Variable/AutoRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Visualization!Microsoft.SystemCenter.Visualization.Consolidator"><Binding PropertyId="From1"><Reference>$Variable/AutoRefreshAction$</Reference></Binding><Binding PropertyId="From2"><Reference>$Service/RefreshAction$</Reference></Binding><Binding PropertyId="To"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="StateCriteriaXMLToQueryString"><Binding PropertyId="ConfigurationXMLString"><Reference>$Property/Criteria$</Reference></Binding><Binding PropertyId="QueryString"><Reference>$Variable/QueryCriteria$</Reference></Binding></Component></Binding><Binding PropertyId="Objects"><Component TypeId="Microsoft.Windows.Server.10.0.Components.GetTopNDataSource"><Binding PropertyId="CriteriaString"><Reference>$Variable/QueryCriteria$</Reference></Binding><Binding PropertyId="Output"><Reference>$Variable/ManagedEntities$</Reference></Binding><Binding PropertyId="TargetEntities"><Reference>$Property/TargetIds$</Reference></Binding><Binding PropertyId="BaseTypeNames"><Reference>$Property/BaseManagementPackTypes$</Reference></Binding><Binding PropertyId="RecursionTypeNames"><Reference>$Property/RecursionTypeNames$</Reference></Binding><Binding PropertyId="Properties"><Reference>$Variable/ProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="SortProperties"><Reference>$Variable/SortProjectionColumns/ManagedEntity$</Reference></Binding><Binding PropertyId="Refresh"><Reference>$Variable/ConsolidatedRefreshAction$</Reference></Binding><Binding PropertyId="TargetServers"><Reference>$Property/TargetServers$</Reference></Binding></Component></Binding></Component></Composite></ComponentImplementation><ComponentImplementation ID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessTopN.Widget.Implementation" Accessibility="Internal" TypeId="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessTopN.Widget" Platform="Wpf, Silverlight"><Composite><Base><Binding PropertyId="ShowSearchBar"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Columns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="AggregateHealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="$MPReference/Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.Library.Entity.HealthState/DisplayName$"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='AggregateHealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="PID"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="PID"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='PID']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="ProcessName"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="ProcessName"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='ProcessName']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="CpuUsage"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="CPU Usage"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='CpuUsage']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="MemoryUsage"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Memory (MB)"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='MemoryUsage']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataGridColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="IOReadPerSecond"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Disk (MB/S) read"/></Binding><Binding PropertyId="SortableGroupable"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="CanResize"><SimpleValue Type="xsd://boolean" Value="True"/></Binding><Binding PropertyId="Width"><SimpleValue Type="xsd://string" Value="Auto"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='IOReadPerSecond']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Binding><Binding PropertyId="SortedColumns"><ComplexValueCollection Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn[]"><ComplexValue Type="xsd://Microsoft.SystemCenter.Visualization.Library!Microsoft.SystemCenter.Visualization.ColumnType/DataCollectionViewColumn"><Binding PropertyId="PropertyName"><SimpleValue Type="xsd://string" Value="HealthState"/></Binding><Binding PropertyId="HeaderDisplayObject"><SimpleValue Type="xsd://string" Value="Health State"/></Binding><Binding PropertyId="SortDirection"><SimpleValue Type="xsd://string" Value="Descending"/></Binding><Binding PropertyId="XPath"><SimpleValue Type="xsd://string" Value="$Object/Property[Name='AggregateHealthState']$"/></Binding><Binding PropertyId="SourceType"><SimpleValue Type="xsd://string" Value="ManagedEntity"/></Binding></ComplexValue></ComplexValueCollection></Binding></Base></Composite></ComponentImplementation></ComponentImplementations><ComponentBehaviors><ComponentBehavior ID="Microsoft.Windows.Server.10.0.Presentation.Components.PortList.WidgetBehavior" Accessibility="Public" BehaviorTypeId="Visualization!Microsoft.SystemCenter.Visualization.PersonalizeBehavior" ComponentTypeId="Microsoft.Windows.Server.10.0.Presentation.Components.PortList.Widget"><Bindings><Binding PropertyId="EnableImplicitConfiguration"><SimpleValue Type="xsd://boolean" Value="False"/></Binding><Binding PropertyId="EnableImplicitPersonalization"><SimpleValue Type="xsd://boolean" Value="False"/></Binding></Bindings></ComponentBehavior><ComponentBehavior ID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.WidgetBehavior" Accessibility="Public" BehaviorTypeId="Visualization!Microsoft.SystemCenter.Visualization.PersonalizeBehavior" ComponentTypeId="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.Widget"><Bindings><Binding PropertyId="EnableImplicitConfiguration"><SimpleValue Type="xsd://boolean" Value="False"/></Binding><Binding PropertyId="EnableImplicitPersonalization"><SimpleValue Type="xsd://boolean" Value="False"/></Binding></Bindings></ComponentBehavior><ComponentBehavior ID="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.WidgetBehavior" Accessibility="Public" BehaviorTypeId="Visualization!Microsoft.SystemCenter.Visualization.PersonalizeBehavior" ComponentTypeId="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget"><Bindings><Binding PropertyId="EnableImplicitConfiguration"><SimpleValue Type="xsd://boolean" Value="False"/></Binding><Binding PropertyId="EnableImplicitPersonalization"><SimpleValue Type="xsd://boolean" Value="False"/></Binding></Bindings></ComponentBehavior><ComponentBehavior ID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessTopN.WidgetBehavior" Accessibility="Public" BehaviorTypeId="Visualization!Microsoft.SystemCenter.Visualization.PersonalizeBehavior" ComponentTypeId="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessTopN.Widget"><Bindings><Binding PropertyId="EnableImplicitConfiguration"><SimpleValue Type="xsd://boolean" Value="False"/></Binding><Binding PropertyId="EnableImplicitPersonalization"><SimpleValue Type="xsd://boolean" Value="False"/></Binding></Bindings></ComponentBehavior></ComponentBehaviors></Presentation><Reporting><DataWarehouseScripts><DataWarehouseScript ID="Microsoft.Window.Server.10.0.Dashboard.DWScript.Microsoft.Window.Server.GetPortState.Procedure" Accessibility="Internal"><InstallScript>ProcessMonitoring.Microsoft.Window.Server.GetPortState.InstallUpdateScript</InstallScript><UninstallScript>ProcessMonitoring.Microsoft.Window.Server.DashboardSP.DropScript</UninstallScript><UpgradeScript>ProcessMonitoring.Microsoft.Window.Server.GetPortState.InstallUpdateScript</UpgradeScript></DataWarehouseScript><DataWarehouseScript ID="Microsoft.Window.Server.10.0.Dashboard.DWScript.Microsoft.Window.Server.GetProcessMetricAndState.Procedure" Accessibility="Internal"><InstallScript>ProcessMonitoring.Microsoft.Window.Server.GetProcessMetricAndState.InstallUpdateScript</InstallScript><UninstallScript>ProcessMonitoring.Microsoft.Window.Server.DashboardSP.DropScript</UninstallScript><UpgradeScript>ProcessMonitoring.Microsoft.Window.Server.GetProcessMetricAndState.InstallUpdateScript</UpgradeScript></DataWarehouseScript><DataWarehouseScript ID="Microsoft.Window.Server.10.0.Dashboard.DWScript.Microsoft.Window.Server.GetTopNProcesses.Procedure" Accessibility="Internal"><InstallScript>ProcessMonitoring.Microsoft.Window.Server.GetTopNProcesses.InstallUpdateScript</InstallScript><UninstallScript>ProcessMonitoring.Microsoft.Window.Server.DashboardSP.DropScript</UninstallScript><UpgradeScript>ProcessMonitoring.Microsoft.Window.Server.GetTopNProcesses.InstallUpdateScript</UpgradeScript></DataWarehouseScript><DataWarehouseScript ID="Microsoft.Window.Server.10.0.Wizard.DWScript.GetAllProcessDimension.Procedure" Accessibility="Internal"><InstallScript>ProcessMonitoring.Microsoft.Window.Server.GetAllProcessDimension.InstallUpdateScript</InstallScript><UninstallScript>ProcessMonitoring.Microsoft.Window.Server.GetAllProcessDimension.DropScript</UninstallScript><UpgradeScript>ProcessMonitoring.Microsoft.Window.Server.GetAllProcessDimension.InstallUpdateScript</UpgradeScript></DataWarehouseScript></DataWarehouseScripts><DataWarehouseDataSets><DataWarehouseDataSet ID="Microsoft.Windows.Server.10.0.HealthStatesCollection.Dataset" Accessibility="Internal"><Dependencies><DataWarehouseScript>SCDW!Microsoft.SystemCenter.DataWarehouse.Script.DatasetDebuggingSupport</DataWarehouseScript><DataWarehouseScript>SCDW!Microsoft.SystemCenter.DataWarehouse.Script.StandardDatasetSupport</DataWarehouseScript></Dependencies><Configuration><IncludeSchemaTypes><SchemaType>SCDW!Microsoft.SystemCenter.DataWarehouse.StandardDatasetSchema</SchemaType></IncludeSchemaTypes><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="Aggregations" type="AggregationsType"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="RawInsertTableCount" type="xsd:positiveInteger"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DefaultAggregationIntervalCount" type="xsd:positiveInteger"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="BlockingMaintenanceDailyStartTime" type="TimeOfDayType"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="BlockingMaintenanceDurationMinutes" type="xsd:positiveInteger"/></Configuration><Install>

GO
---------------------------------------------------------------
-- Initialize Process Health State Dataset
--------------------------------------------------------------
SET NOCOUNT ON

DECLARE 
        @SchemaName sysname
	   ,@ProcessStagingSp sysname
	   ,@ErrorInd   bit
	   ,@DebugLevel tinyint
	   ,@DebugPrefix  nvarchar(max)
       ,@DebugMessage  nvarchar(max)
	   ,@ErrorLevel      int
	   ,@InfoLevel       int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd = 0
SET @DebugLevel = 0
SET @SchemaName  = 'ProcessMonitoring'
SET @ProcessStagingSp = 'HealthStateProcessStaging'

SET @DebugPrefix  =  'Process Monitoring Health State DataSet: '
SET @DebugMessage =  @DebugPrefix + ' Insert new definition.'


EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage



BEGIN TRY

	INSERT StandardDataset (
	   DatasetId 
	  ,SchemaName
	  ,DebugLevel
	  ,DefaultAggregationIntervalCount
	  ,RawInsertTableCount
	  ,StagingProcessorStoredProcedureName
	  ,BlockingMaintenanceDailyStartTime
	  ,BlockingMaintenanceDurationMinutes
	)
	VALUES
	(
	   '$Config/DatasetId$'
	  ,@SchemaName
	  ,@DebugLevel
	  ,$Config/DefaultAggregationIntervalCount$
	  ,$Config/RawInsertTableCount$
	  ,@SchemaName + '.' + @ProcessStagingSp
	  ,'$Config/BlockingMaintenanceDailyStartTime$'
	  ,$Config/BlockingMaintenanceDurationMinutes$
	)

	END TRY
	BEGIN CATCH
	 SET @ErrorInd = 1
	END CATCH

	IF (1 = @ErrorInd)
	BEGIN
	    SET @DebugMessage =  @DebugPrefix + 'Insert new definition failed.'

		EXEC DebugMessageInsert
				@DatasetId = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessage

	END
	ELSE
	BEGIN
	    SET @DebugMessage =  @DebugPrefix + ' Insert new definition finished successfully.'

		EXEC DebugMessageInsert
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @InfoLevel
				,@MessageText  = @DebugMessage


	END 
GO


---------------------------------------------------------------------------------------
-- Create the StandardDatasetAggregation for Process Monitoring HealthState Fact Tables
----------------------------------------------------------------------------------------

GO
SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugPrefix  nvarchar(max)
  ,@DebugMessage  nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int

SET @ErrorInd     = 0
SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @DebugPrefix  = 'Process Monitoring HealthState DataSet: '
SET @DebugMessage = @DebugPrefix  + 'Starting aggregation setting deployment.'

DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText varchar(max)
  ,@BuildAggregationStoredProcedureName  sysname
  ,@DeleteAggregationStoredProcedureName sysname
  ,@GroomStoredProcedureName             sysname
  ,@SchemaName                           sysname

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
  
BEGIN TRY
  SELECT @SchemaName = SchemaName
  FROM
  dbo.StandardDataSet
  WHERE DatasetId = '$Config/DatasetId$'

  IF @SchemaName IS NULL
  BEGIN
    
   SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was failed. Process Monitoring Health State Dataset does not exist.'
  
   EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage


   RAISERROR( @DebugMessage, 16,1)
  END
  
  
  SET @BuildAggregationStoredProcedureName  = NULL
  SET @DeleteAggregationStoredProcedureName = NULL
  SET @GroomStoredProcedureName             = @SchemaName + '.' + 'HealthStateFactsGroom'
 
  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'

  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0 RAISERROR(777971000, 16, 1, 'Process Monitoring: Health State Aggregation', @ExecResult)

  IF NOT EXISTS (SELECT 1 FROM dbo.StandardDatasetAggregation WHERE  DatasetId = '$Config/DatasetId$' )
  BEGIN
	  INSERT StandardDatasetAggregation
	  (                               
		 DatasetId
		,AggregationTypeId
		,AggregationIntervalDurationMinutes
		,AggregationStartDelayMinutes
		,BuildAggregationStoredProcedureName
		,DeleteAggregationStoredProcedureName
		,GroomStoredProcedureName
		,IndexOptimizationIntervalMinutes
		,MaxDataAgeDays
		,GroomingIntervalMinutes
		,MaxRowsToGroom
		,LastGroomingDateTime
		,DataFileGroupName
		,IndexFileGroupName
	  )
	  SELECT
		 '$Config/DatasetId$'
		,CASE AggregationType
		   WHEN 'Raw' THEN 0
		   WHEN 'Subhourly' THEN 10
		   WHEN 'Hourly' THEN 20
		   WHEN 'Daily' THEN 30
		 END
		,CASE AggregationType
		   WHEN 'Raw' THEN NULL
		   WHEN 'Subhourly' THEN AggregationIntervalDurationMinutes
		   WHEN 'Hourly' THEN 60
		   WHEN 'Daily' THEN 24*60
		 END
		,AggregationStartDelayMinutes
		,@BuildAggregationStoredProcedureName
		,CASE AggregationType
		   WHEN 'Raw' THEN NULL
		   ELSE @DeleteAggregationStoredProcedureName
		 END
		,@GroomStoredProcedureName
		,IndexOptimizationIntervalMinutes
		,MaxDataAgeDays
		,GroomingIntervalMinutes
		,MaxRowsToGroom
		,GETUTCDATE()
		,DataFileGroupName
		,IndexFileGroupName
	  FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
		   AggregationType                    varchar(50)   '@mp:localname'
		  ,MaxTableRowCount                   int
		  ,MaxTableSizeKb                     int
		  ,AggregationStartDelayMinutes       int
		  ,MaxDataAgeDays                     int
		  ,GroomingIntervalMinutes            int
		  ,MaxRowsToGroom                     int
		  ,IndexOptimizationIntervalMinutes   int
		  ,DataFileGroupName                  nvarchar(256)
		  ,IndexFileGroupName                 nvarchar(256)
		  ,AggregationIntervalDurationMinutes int
	  )
  END
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int


  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

 SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was failed. Error: ' + @ErrorMessageText
  
 EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
  
  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was finished successfully.'
  
 EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

END

GO
 
------------------------------------------------------------------------------------------------------------
-- Create the StandardDataset Aggregation Tables definitions for Process Monitoring HealthState Fact Tables
------------------------------------------------------------------------------------------------------------

GO

SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage    nvarchar(max)
  ,@DebugPrefix     nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugPrefix  =  'Process Monitoring Health State DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting dataset table definitions deployment.'


DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText nvarchar(max)
  ,@TableCompressionClause nvarchar(max) 

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
  
BEGIN TRY
  SET @TableCompressionClause = ''
  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'

  -----------------------------------------------------------------------
  -- ENBALE PAGE COMPRESSION ON FACT Tables IF AVILABLE
  -----------------------------------------------------------------------
	IF ( 3 = SERVERPROPERTY('EngineEdition') 
		 OR
		 ('SP1' = SERVERPROPERTY('ProductLevel') AND CAST(SERVERPROPERTY('ProductVersion') AS VARCHAR(50)) like '13.0%')
	   )
	BEGIN
	  SET @TableCompressionClause = ' WITH (DATA_COMPRESSION = PAGE)'
	END



  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0 
  BEGIN

	  SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was failed. Cannot parse dataset definition. Xml definition: ' + @XmlDocText
  
	  EXEC DebugMessageInsert
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel 
				,@MessageText  = @DebugMessage

     RAISERROR(777971000, 16, 1, @DebugMessage, @ExecResult)

  END

  IF NOT EXISTS (SELECT 1 FROM dbo.StandardDatasetAggregationStorage WHERE  DatasetId = '$Config/DatasetId$' )
  BEGIN
	  INSERT StandardDatasetAggregationStorage
	  (                               
		 DatasetId
		,AggregationTypeId
		,BaseTableName
		,DependentTableInd
		,TableTemplate
		,CoverViewSelectClause
		,MaxTableRowCount
		,MaxTableSizeKb 
	  )
	  SELECT
		 '$Config/DatasetId$'
		,CASE AggregationType
		   WHEN 'Raw' THEN 0
		   WHEN 'Subhourly' THEN 10
		   WHEN 'Hourly' THEN 20
		   WHEN 'Daily' THEN 30
		 END
		,BaseTableName
		,0
		,CASE AggregationType
		   WHEN 'Raw' THEN '
					CREATE TABLE ' + QUOTENAME(d.SchemaName) + '.' + QUOTENAME(BaseTableName + '_$Guid$') + '
					(
						 ' + QUOTENAME(BaseTableName + 'RowId') + ' bigint  NOT NULL  IDENTITY(1, 1)
						,DateKey                        int  NOT NULL
						,TimeKey                        int  NOT NULL
						,ComputerRowId                  int  NOT NULL
						,ProcessRowId                   int  NOT NULL
						,ProcessCmdRowId                int  NOT NULL
						,UserRowId                      int  NOT NULL
						,PID                            int  NOT NULL
						,CpuHealthState                 tinyint   NOT NULL
						,MemoryHealthState              tinyint   NOT NULL
						,HandleCountHealthState         tinyint   NOT NULL
						,AggregateHealthState           tinyint   NOT NULL
					    ,CpuThreshold                   float     NULL
						,MemoryThreshold                float     NULL
						,HandleThreshold                float     NULL
						,DateTime                       datetime  NOT NULL
						,CONSTRAINT ' + QUOTENAME('PK_' + BaseTableName + '_$Guid$') + ' PRIMARY KEY CLUSTERED ('
						   + QUOTENAME(BaseTableName + 'RowId') + ') ON $DataFileGroupName$
					) ON $DataFileGroupName$
		   ' + @TableCompressionClause
		 END
		,CASE AggregationType
		   WHEN 'Raw' THEN '
			  SELECT
				   DateKey
				  ,TimeKey
				  ,ComputerRowId         
				  ,ProcessRowId         
				  ,ProcessCmdRowId
				  ,UserRowId            
				  ,PID                   
				  ,CpuHealthState        
				  ,MemoryHealthState     
				 ,HandleCountHealthState       
				 ,AggregateHealthState
				 ,CpuThreshold   
				 ,MemoryThreshold
				 ,HandleThreshold             
				 ,DateTime
		   '
		 END
		,MaxTableRowCount
		,MaxTableSizeKb 
	  FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
		   AggregationType      varchar(50)   '@mp:localname'
		  ,BaseTableName        varchar(256)
		  ,MaxTableRowCount     int
		  ,MaxTableSizeKb       int
		  ,DataFileGroupName    varchar(256)
		  ,IndexFileGroupName    varchar(256)
	  )
		  CROSS JOIN StandardDataset d
	  WHERE (d.DatasetId = '$Config/DatasetId$' AND AggregationType = 'Raw')
  END
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END
  
  SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was failed. Error: ' + @ErrorMessageText
  
  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel 
			,@MessageText  = @DebugMessage

  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )
END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was finished successfully.'
 EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 
END
GO
  ------------------------------------------------------------------------------------------------------------
-- Create Indexes for the StandardDataset Aggregation Tables  for Process Monitoring HealthState Fact Tables
------------------------------------------------------------------------------------------------------------

GO
	SET NOCOUNT ON


-- create [DateTime] field indexes for all aggregation levels
DECLARE 
   @AggregationTypeId int
  ,@Statement         nvarchar(max)
  ,@IndeGuid          uniqueidentifier
  ,@ErrorInd          bit
  ,@ErrorMessageText  nvarchar(4000)
  ,@ErrorNumber       int
  ,@ErrorSeverity     int
  ,@ErrorState        int
  ,@ErrorLine         int
  ,@ErrorProcedure    nvarchar(256)
  ,@DebugMessage      nvarchar(max)
  ,@DebugPrefix       nvarchar(max)
  ,@ErrorLevel        int
  ,@InfoLevel         int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugPrefix  =  'Process Monitoring Health State DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting dataset indexes deployment.'
SET @AggregationTypeId = -1

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 



BEGIN TRY
	WHILE EXISTS (SELECT *
				  FROM StandardDatasetAggregation
				  WHERE (DatasetId = '$Config/DatasetId$')
					AND (AggregationTypeId &gt; @AggregationTypeId)
				 )
	BEGIN
	  SELECT @IndeGuid = NEWID()
  
	  SELECT TOP 1 
		 @AggregationTypeId = AggregationTypeId
		,@Statement = 
		  ' EXEC StandardDatasetIndexDelete'
		+ '    @DatasetId = ''$Config/DatasetId$'''
		+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
		  + '   ,@DeleteIndexOnExistingTablesInd = 0'
		+ ' EXEC StandardDatasetIndexInsert'
		+ '    @DatasetId = ''$Config/DatasetId$'''
		+ '   ,@AggregationTypeId = ' + CAST(AggregationTypeId AS varchar(10))
		+ '   ,@DependentTableInd = 0'
		+ '   ,@TableTag = NULL'
		+ '   ,@UniqueInd = 0'
		+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
		+ '   ,@IndexDefinition = ''([DateTime])'''
		+ '   ,@CreateIndexOnExistingTablesInd = 0'
	  FROM StandardDatasetAggregation
	  WHERE (DatasetId = '$Config/DatasetId$')
		AND (AggregationTypeId &gt; @AggregationTypeId)
	  ORDER BY AggregationTypeId
  
	  EXECUTE (@Statement)
	END


/* raw indexes for UI*/

	EXEC StandardDatasetIndexDelete
	   @DatasetId = '$Config/DatasetId$'
	  ,@IndexGuid = 'F986F345-9191-4B36-845C-606731706848'
		,@DeleteIndexOnExistingTablesInd = 0

	EXEC StandardDatasetIndexInsert
	   @DatasetId = '$Config/DatasetId$'
	  ,@AggregationTypeId = 0
	  ,@DependentTableInd = 0
	  ,@TableTag = NULL
	  ,@UniqueInd = 0
	  ,@IndexGuid = 'F986F345-9191-4B36-845C-606731706848'
	  ,@IndexDefinition = '(
		 ComputerRowId     
		,ProcessRowId      
		,ProcessCmdRowId   
		,UserRowId         
		,PID 
		,DateTime
		)
		INCLUDE
		(
			 CpuHealthState          
			,MemoryHealthState       
			,HandleCountHealthState  
			,AggregateHealthState    		
		)
		'
	  ,@CreateIndexOnExistingTablesInd = 0

END TRY
BEGIN CATCH
  SET @ErrorInd = 1

     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

END CATCH

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END
  
  
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was failed. Error: ' + @ErrorMessageText

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage 

  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was finished successfully.'
  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 
END

GO



------------------------------------------------------------------
--- Create SCHEMA for new Process Monitoring Health State DataSet
-------------------------------------------------------------------

GO
DECLARE 
@SchemaName sysname

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF NOT EXISTS (SELECT * FROM sys.schemas WHERE [name] = @SchemaName)
BEGIN
  EXECUTE('CREATE SCHEMA ' + @SchemaName)
END

 DECLARE @Statement  nvarchar(max)

 -- change schema ownership to allow index rebuild and reorganize

 SET  @Statement = 'ALTER AUTHORIZATION ON SCHEMA::' + @SchemaName + ' TO OpsMgrWriter'
 EXECUTE(@Statement)

 SET  @Statement = 'GRANT ALTER ON SCHEMA::' + @SchemaName + ' TO OpsMgrWriter'
 EXECUTE(@Statement)
 
 -- grant create table permissions
 GRANT CREATE TABLE TO OpsMgrWriter

GO

-----------------------------------------------------------------------
--- Start standard Process Monitoring Health State dataset  deployment
-----------------------------------------------------------------------

SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage    nvarchar(max)
  ,@DebugPrefix     nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int
  
SET @ErrorInd     = 0
SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText nvarchar(max)
 
SET @DebugPrefix  =  'Process Monitoring HealthState DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting storage deployment.'


EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
			  
BEGIN TRY

  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'
  SET @DebugMessage = @DebugPrefix + 'Cannot parse configuration. Text: ' + @XmlDocText

  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0
  BEGIN
          EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText = @DebugMessage
 
   RAISERROR(777971000, 16, 1,@DebugMessage , @ExecResult)
  END

  DECLARE
     @AggregationType varchar(50)
    ,@Statement nvarchar(max)
     
  SET @AggregationType = ''

  WHILE EXISTS (SELECT *
                FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
                      AggregationType      varchar(50)   '@mp:localname')
                WHERE AggregationType &gt; @AggregationType
               )
  BEGIN
    SELECT TOP 1 @AggregationType = AggregationType
    FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
          AggregationType      varchar(50)   '@mp:localname')
    WHERE AggregationType &gt; @AggregationType
    ORDER BY AggregationType
    
    SET @Statement = 'EXEC StandardDatasetAllocateStorage @DatasetId = ''$Config/DatasetId$'', @AggregationTypeId='
                    + CASE @AggregationType
                        WHEN 'Raw' THEN '0'
                        WHEN 'Subhourly' THEN '10'
                        WHEN 'Hourly' THEN '20'
                        WHEN 'Daily' THEN '30'
                      END
    EXECUTE (@Statement)
  END
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

  SET @DebugMessage = @DebugPrefix + 'Storage deployment was failed. Error: ' + @ErrorMessageText
  
  EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText = @DebugMessage
  
  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )
END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix + 'Storage deployment was finished successfully.' 
 
 EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText = @DebugMessage
END

GO

--------------------------------------------------------------------------------------
--- Start standard Process Monitoring Health State dataset staging tables  deployment
--------------------------------------------------------------------------------------
GO

SET NOCOUNT ON

DECLARE 
   @ErrorInd         bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber      int
  ,@ErrorSeverity    int
  ,@ErrorState       int
  ,@ErrorLine        int
  ,@ErrorProcedure   nvarchar(256)
  ,@Statement        nvarchar(max)
  ,@DebugMessage     nvarchar(max)
  ,@DebugLevel       tinyint
  ,@DebugPrefix      nvarchar(max)
  ,@ErrorLevel       int
  ,@InfoLevel        int


  SET @ErrorInd     = 0
  SET @ErrorLevel   = 3 
  SET @InfoLevel    = 1
  SET @DebugPrefix  =  'Process Monitoring Health State DataSet: '
  SET @DebugMessage =  @DebugPrefix + ' Create staging table.'


  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

-- insert staging definition into StandardDatasetStagingArea
BEGIN TRY

	BEGIN TRAN

		IF EXISTS (SELECT * FROM StandardDatasetStagingArea WHERE DatasetId = '$Config/DatasetId$')
		BEGIN
		  DELETE StandardDatasetStagingArea
		  WHERE DatasetId = '$Config/DatasetId$'
		END

		INSERT StandardDatasetStagingArea
		(
		   DatasetId
		  ,StagingTableColumnDefinition
		  ,BatchedProcessingSupportedInd
		  ,MaxRowsToProcessPerTransactionCount
		)
		VALUES
		(
		   '$Config/DatasetId$'
		  ,'
		   DatasetId                      uniqueidentifier  NOT NULL
		  ,ManagementGroupGuid            uniqueidentifier  NOT NULL
		  ,ManagedEntityGuid              uniqueidentifier  NOT NULL
		  ,CollectedDate                  datetime          NOT NULL
		  ,DateKey                        int               NOT NULL
		  ,TimeKey                        int               NOT NULL
		  ,ProcessId                      int               NOT NULL
		  ,CpuHealthState                 tinyint           NOT NULL
		  ,MemoryHealthState              tinyint           NOT NULL
		  ,HandleCountHealthState         tinyint           NOT NULL
		  ,AggregateHealthState           tinyint           NOT NULL
		  ,CpuThreshold                   float             NULL
		  ,MemoryThreshold                float             NULL
		  ,HandleThreshold                float             NULL
		  ,ProcessName                    nvarchar(256)     NOT NULL
		  ,Description                    nvarchar(2000)    NULL
		  ,CommandLine                    nvarchar(max)     NULL
		  ,CommandLineHash                varchar(64)       NULL
		  ,UserName                       varchar(256)      NULL   
		  ,ManagedEntityRowId	          int               NULL DEFAULT(0)
		  ,ComputerRowId                  int               NULL DEFAULT(0)
		  ,ProcessRowId                   int               NULL DEFAULT(0)
		  ,ProcessCmdRowId                int               NULL DEFAULT(0)
		  ,UserRowId                      int               NULL DEFAULT(0)
		  ,DWCreatedDateTime              datetime NULL    DEFAULT (GETUTCDATE())
		  ,ProcessStateStageRowId         bigint            NOT NULL    IDENTITY(1, 1)  PRIMARY KEY
		  '
		  ,1
		  ,100000
		)
	COMMIT

END TRY
BEGIN CATCH

    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN

	SELECT
		@ErrorNumber = ERROR_NUMBER()
		,@ErrorSeverity = ERROR_SEVERITY()
		,@ErrorState = ERROR_STATE()
		,@ErrorLine = ERROR_LINE()
		,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
		,@ErrorMessageText = ERROR_MESSAGE()

	SET @ErrorInd = 1

END CATCH

IF (@ErrorInd = 1)
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
									WHEN @ErrorSeverity &gt; 18 THEN 18
									ELSE @ErrorSeverity
								END

  SET @DebugMessage =  @DebugPrefix + 'staging table creation was failed. Error: ' + @ErrorMessageText
  
  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage


	RAISERROR (777971002, @AdjustedErrorSeverity, 1
		,@ErrorNumber
		,@ErrorSeverity
		,@ErrorState
		,@ErrorProcedure
		,@ErrorLine
		,@ErrorMessageText
		)
END
ELSE
BEGIN
    DECLARE 
	@SchemaName sysname
	,@TableName  sysname

	SET @TableName = 'ProcesStateStaging'

	SELECT @SchemaName = SchemaName
	FROM
	dbo.StandardDataSet
	WHERE DatasetId = '$Config/DatasetId$'

  BEGIN TRY	
	IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
	BEGIN
        
		SELECT @Statement = StagingTableColumnDefinition
		FROM StandardDatasetStagingArea
		WHERE DatasetId = '$Config/DatasetId$'

	    IF @Statement IS NOT NULL
		BEGIN
		  SELECT @Statement = 'CREATE TABLE ' + @SchemaName + '.' + @TableName +  '(' + @Statement + ')'
		  EXECUTE (@Statement)
		END
		ELSE
		BEGIN
			SET @DebugMessage =  @DebugPrefix + 'Staging Data definition does not exist.'
  
			EXEC DebugMessageInsert 
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText  = @DebugMessage

		END

	END
 END TRY
 BEGIN CATCH
  	SELECT
		@ErrorNumber = ERROR_NUMBER()
		,@ErrorSeverity = ERROR_SEVERITY()
		,@ErrorState = ERROR_STATE()
		,@ErrorLine = ERROR_LINE()
		,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
		,@ErrorMessageText = ERROR_MESSAGE()

	SET @ErrorInd = 1

	SET @DebugMessage =  @DebugPrefix + 'staging table creation was failed. Error: ' + @ErrorMessageText
  
    EXEC DebugMessageInsert 
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage

 END CATCH

 IF (0 = @ErrorInd)
 BEGIN
  SET @DebugMessage =  @DebugPrefix + 'staging table created successfully. '

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

 END 
END


GO



GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@Statement nvarchar(max)

SET @TableName = 'ComputerDim'

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension tables.', 16,1)
  GOTO Endproc
END

IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  SET @Statement =
	'CREATE TABLE ' + @SchemaName + '.' + @TableName + 
	'(                               
		  ComputerRowId                 int           NOT NULL IDENTITY(1,1)
		 ,ManagementEntityRowId          int           NOT NULL
		 ,Name                          nvarchar(256) NOT NULL
		 ,NetbiosName                   nvarchar(256) NULL
		 ,PrincipalName                 nvarchar(256) NULL
		 ,DWCreatedDateTime            datetime NOT NULL    DEFAULT (GETUTCDATE())
 
		 ,CONSTRAINT PK_' + @TableName +' PRIMARY KEY CLUSTERED (ComputerRowId)
	)'

	EXECUTE(@Statement)

	SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_LastReceivedDateTime ON ' + @SchemaName + '.' + @TableName + ' (DWCreatedDateTime)'

    EXECUTE(@Statement)

    SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_MeId ON ' + @SchemaName + '.' + @TableName + ' (ManagementEntityRowId)'

    EXECUTE(@Statement)

	EXEC DomainTableRegisterIndexOptimization
		   @TableName = @TableName
		  ,@SchemaName = @SchemaName
		  ,@DatasetId = '$Config/DatasetId$'

END

Endproc:
GO



GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@Statement nvarchar(max)

SET @TableName = 'DateDim'

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension tables.', 16,1)
  GOTO Endproc
END


IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  SET @Statement =
	'CREATE TABLE ' + @SchemaName + '.' + @TableName + 
	'(   
		   DateKey                         int      NOT NULL 
		  ,DateValue 		               datetime NOT NULL
		  ,[Day]                           tinyint  NOT NULL
		  ,[DayOfWeek]                     tinyint  NOT NULL
		  ,[DayOfMonth]                    tinyint  NOT NULL
		  ,[WeekOfYear]                    tinyint  NOT NULL
		  ,[Month]                         tinyint  NOT NULL
		  ,[Quarter]                       tinyint  NOT NULL
		  ,[Year]                          smallint NOT NULL
 
		 ,CONSTRAINT PK_' + @TableName +' PRIMARY KEY CLUSTERED (DateKey)
	)'

	EXECUTE(@Statement)

	SET @Statement =
	'INSERT INTO ' + @SchemaName + '.' + @TableName + 
     '(DateKey,DateValue,Day,DayOfWeek,DayOfMonth,WeekOfYear,Month,Quarter,Year)
	 SELECT  [Year]*10000 + [Month]*100 + Day(DateValue),DateValue,Day(DateValue),[DayOfWeek],[DayOfMonth],[WeekOfYear],[Month],[Quarter],[Year]
	 FROM
	 dbo.Date dt
	 WHERE 
	 dt.Year &gt; 2015
	 '

	EXECUTE(@Statement)

	EXEC DomainTableRegisterIndexOptimization
		   @TableName  = @TableName
		  ,@SchemaName = @SchemaName
		  ,@DatasetId  = '$Config/DatasetId$'

END


Endproc:
GO
GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@Statement nvarchar(max)

SET @TableName = 'TimeDim'

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension tables.', 16,1)
  GOTO Endproc
END


IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  SET @Statement =
	'CREATE TABLE ' + @SchemaName + '.' + @TableName + 
	'(   
		  TimeKey                       int      NOT NULL 
		  ,[Hour]                          tinyint  NOT NULL
		  ,[Minute]                        tinyint  NOT NULL
		  ,[Second]                        tinyint  NOT NULL
 
		 ,CONSTRAINT PK_' + @TableName +' PRIMARY KEY CLUSTERED (TimeKey)
	)'

	EXECUTE(@Statement)

	SET @Statement =
	'INSERT INTO ' + @SchemaName + '.' + @TableName + 
     '(TimeKey,[Hour],[Minute],[Second]) 
	 SELECT 
		(tHour.n -1)* 10000 + (tMinute.n-1) * 100 + tSecond.n -1 AS TimeKey
		,tHour.n -1 as [Hour]
		,tMinute.n-1 As [Minute]
		,tSecond.n -1 AS [Second] 
	 FROM
	 (SELECT ROW_NUMBER() OVER(ORDER BY L0.C) AS n FROM
		(SELECT 1 AS c UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1) L0,
		(SELECT 1 AS c UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 ) L1
	 )tHour
	 CROSS JOIN
	 (SELECT ROW_NUMBER() OVER(ORDER BY L0.C) AS n FROM
		(SELECT 1 AS c UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1) L0,
		(SELECT 1 AS c UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 ) L1,
		(SELECT 1 AS c UNION ALL SELECT 1  ) L2
	 )tMinute
	 CROSS JOIN
	 (SELECT ROW_NUMBER() OVER(ORDER BY L0.C) AS n FROM
		(SELECT 1 AS c UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1) L0,
		(SELECT 1 AS c UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 ) L1,
		(SELECT 1 AS c UNION ALL SELECT 1  ) L2
	 )tSecond
	 '

	EXECUTE(@Statement)

	EXEC DomainTableRegisterIndexOptimization
		   @TableName  = @TableName
		  ,@SchemaName = @SchemaName
		  ,@DatasetId  = '$Config/DatasetId$'

END


Endproc:
GO


GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@Statement nvarchar(max)

SET @TableName = 'ProcessCmdDim'

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension tables.', 16,1)
  GOTO Endproc
END


IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  SET @Statement =
	'CREATE TABLE ' + @SchemaName + '.' + @TableName + 
	'(                               
			  ProcessCmdRowId              int           NOT NULL IDENTITY(1,1)
			 ,CommandLine                  nvarchar(max) NULL 
			 ,CommandLineHash              varchar(64)   NOT NULL
			 ,DWCreatedDateTime            datetime NOT NULL    DEFAULT (GETUTCDATE())
 
			 ,CONSTRAINT PK_' + @TableName +' PRIMARY KEY CLUSTERED (ProcessCmdRowId)
	)'

	EXECUTE(@Statement)

	SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_LastReceivedDateTime ON ' + @SchemaName + '.' + @TableName + ' (DWCreatedDateTime)'

    EXECUTE(@Statement)


	SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_CommandLineHash ON ' + @SchemaName + '.' + @TableName + ' (CommandLineHash)'

    EXECUTE(@Statement)

    SET @Statement =
	'INSERT INTO ' + @SchemaName + '.' + @TableName + 
     '(CommandLine,CommandLineHash)
		SELECT '''',''E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855''	
     '

	EXECUTE(@Statement)



	EXEC DomainTableRegisterIndexOptimization
		   @TableName = @TableName
		  ,@SchemaName = @SchemaName
		  ,@DatasetId = '$Config/DatasetId$'

END


Endproc:
GO



GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@Statement nvarchar(max)

SET @TableName = 'ProcessDim'

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension tables.', 16,1)
  GOTO Endproc
END


IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  SET @Statement =
	'CREATE TABLE ' + @SchemaName + '.' + @TableName + 
	'(                               
		  ProcessRowId                 int           NOT NULL IDENTITY(1,1)
		 ,ProcessName                  nvarchar(256) NOT NULL
		 ,[Description]                nvarchar(2000) NULL
		 ,UserDescription              nvarchar(512) NULL
		 ,DWCreatedDateTime            datetime NOT NULL    DEFAULT (GETUTCDATE())
 
		 ,CONSTRAINT PK_' + @TableName +' PRIMARY KEY CLUSTERED (ProcessRowId)
 
	)'

	EXECUTE(@Statement)

	SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_LastReceivedDateTime ON ' + @SchemaName + '.' + @TableName + ' (DWCreatedDateTime)'

    EXECUTE(@Statement)

    SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_ProcessName ON ' + @SchemaName + '.' + @TableName + ' (ProcessName)'

    EXECUTE(@Statement)

    SET @Statement =
	'INSERT INTO ' + @SchemaName + '.' + @TableName + 
     '(ProcessName,[Description])
		Values (N''System'',N''NT Kernel and System'')
		,(N''System Idle'',N''Percentage of time the processor is Idle'')
		,(N''svchost.exe'',N''Host Process for Windows Service'')
		,(N''smss.exe'',N''Windows Session Manager'')
		,(N''services.exe'',N''Services and Controller app'')
		,(N''csrss.exe'',N''Client Server Runtime Process'')
		,(N''conhost.exe'',N''Console Windows Host'')
		,(N''cmd.exe'',N''Windows Command Processor'')
		,(N''HealthService.exe'',N''Microsoft Monitoring Agent Service'')
		,(N''LogonUI.exe'',N''Windows Logon User Interface Host'')
		,(N''lsass.exe'',N''Local Security Authority Process'')
		,(N''MonitoringHost.exe'',N''System Center Management Service Host Process'')
		,(N''wininit.exe'',N''Windows Start-Up Application'')
		,(N''winlogon.exe'',N''Windows Logon Application'')
		,(N''WmiPrvSE.exe'',N''WMI Provider Host'')
		                                                     

     '

	EXECUTE(@Statement)



	EXEC DomainTableRegisterIndexOptimization
		   @TableName = @TableName
		  ,@SchemaName = @SchemaName
		  ,@DatasetId = '$Config/DatasetId$'

END


Endproc:
GO





GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@Statement nvarchar(max)

SET @TableName = 'UserDim'

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension tables.', 16,1)
  GOTO Endproc
END


IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  SET @Statement =
	'CREATE TABLE ' + @SchemaName + '.' + @TableName + 
	'(                               
			UserRowId                    int           NOT NULL IDENTITY(1,1)
			,LogonName                    nvarchar(256) NOT NULL
			,Domain                       nvarchar(256) NULL
			,UserName                     nvarchar(256) NULL
			,DWCreatedDateTime            datetime NOT NULL    DEFAULT (GETUTCDATE())
 
			 ,CONSTRAINT PK_' + @TableName +' PRIMARY KEY CLUSTERED (UserRowId)
	)'

	EXECUTE(@Statement)

	SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_LastReceivedDateTime ON ' + @SchemaName + '.' + @TableName + ' (DWCreatedDateTime)'

    EXECUTE(@Statement)

	SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_LogonName ON ' + @SchemaName + '.' + @TableName + ' (LogonName)'

    EXECUTE(@Statement)

    SET @Statement =
	'INSERT INTO ' + @SchemaName + '.' + @TableName + 
     '(LogonName,Domain,UserName)
		SELECT N'''',N'''',''''	 
		UNION ALL
		SELECT N''SYSTEM'',N'''',''SYSTEM''	 
	'

	EXECUTE(@Statement)

	EXEC DomainTableRegisterIndexOptimization
		   @TableName = @TableName
		  ,@SchemaName = @SchemaName
		  ,@DatasetId = '$Config/DatasetId$'

END


Endproc:
GO



GO
DECLARE 
@SchemaName sysname
,@TableName sysname
,@ViewName  sysname
,@Statement nvarchar(max)

SET @TableName = 'ComputerDim'
SET @ViewName  = 'v' + @TableName

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'


IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension views.', 16,1)
  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @ViewName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  EXECUTE ('CREATE VIEW ' + @SchemaName + '.' + @ViewName + ' AS SELECT A = 1')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN

	SET @Statement = ' ALTER VIEW '  + @SchemaName + '.' + @ViewName + 
	'
	AS
	  SELECT 
		  ComputerRowId          
		 ,ManagementEntityRowId   
		 ,Name                   
		 ,NetbiosName            
		 ,PrincipalName          
		 ,DWCreatedDateTime      
  	  FROM ' + @SchemaName + '.' + @TableName + ' (NOLOCK)'

	EXECUTE(@Statement)
	EXECUTE('GRANT SELECT ON ' + @SchemaName + '.' + @ViewName + '  TO OpsMgrReader')
END

Endproc:
GO



GO
DECLARE 
@SchemaName sysname
,@TableName sysname
,@ViewName  sysname
,@Statement nvarchar(max)

SET @TableName = 'DateDim'
SET @ViewName  = 'v' + @TableName

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension views.', 16,1)
  GOTO Endproc
END



IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @ViewName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  EXECUTE ('CREATE VIEW ' + @SchemaName + '.' + @ViewName + ' AS SELECT A = 1')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN

	SET @Statement = ' ALTER VIEW '  + @SchemaName + '.' + @ViewName + 
	'
	AS
	  SELECT 
		  DateKey     
		 ,DateValue 	
		 ,[Day]       
		 ,[DayOfWeek] 
		 ,[DayOfMonth]
		 ,[WeekOfYear]
		 ,[Month]     
		 ,[Quarter]   
		 ,[Year]   

  	  FROM ' + @SchemaName + '.' + @TableName + ' (NOLOCK)'

	EXECUTE(@Statement)
	EXECUTE('GRANT SELECT ON ' + @SchemaName + '.' + @ViewName + '  TO OpsMgrReader')
END

Endproc:
GO

GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@ViewName  sysname
,@Statement nvarchar(max)

SET @TableName = 'TimeDim'
SET @ViewName  = 'v' + @TableName

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension views.', 16,1)
  GOTO Endproc
END

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @ViewName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  EXECUTE ('CREATE VIEW ' + @SchemaName + '.' + @ViewName + ' AS SELECT A = 1')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN

	SET @Statement = ' ALTER VIEW '  + @SchemaName + '.' + @ViewName + 
	'
	AS
	  SELECT 
	    TimeKey    
		,[Hour]    
		,[Minute]  
		,[Second]
	  FROM ' + @SchemaName + '.' + @TableName + ' (NOLOCK)'

	EXECUTE(@Statement)
	EXECUTE('GRANT SELECT ON ' + @SchemaName + '.' + @ViewName + '  TO OpsMgrReader')
END

Endproc:
GO



GO
DECLARE 
@SchemaName sysname
,@TableName sysname
,@ViewName  sysname
,@Statement nvarchar(max)

SET @TableName = 'ProcessCmdDim'
SET @ViewName  = 'v' + @TableName

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension views.', 16,1)
  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @ViewName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  EXECUTE ('CREATE VIEW ' + @SchemaName + '.' + @ViewName + ' AS SELECT A = 1')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN

	SET @Statement = ' ALTER VIEW '  + @SchemaName + '.' + @ViewName + 
	'
	AS
	  SELECT 
	    ProcessCmdRowId  
	   ,CommandLine      
	   ,CommandLineHash  
	   ,DWCreatedDateTime  
  	  FROM ' + @SchemaName + '.' + @TableName + ' (NOLOCK)'

	EXECUTE(@Statement)
	EXECUTE('GRANT SELECT ON ' + @SchemaName + '.' + @ViewName + '  TO OpsMgrReader')
END

Endproc:
GO


GO
DECLARE 
@SchemaName sysname
,@TableName sysname
,@ViewName  sysname
,@Statement nvarchar(max)

SET @TableName = 'ProcessDim'
SET @ViewName  = 'v' + @TableName

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension views.', 16,1)
  GOTO Endproc
END

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @ViewName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  EXECUTE ('CREATE VIEW ' + @SchemaName + '.' + @ViewName + ' AS SELECT A = 1')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN

	SET @Statement = ' ALTER VIEW '  + @SchemaName + '.' + @ViewName + 
	'
	AS
	  SELECT 
	   ProcessRowId      
	  ,ProcessName       
	  ,Description       
	  ,UserDescription   
	  ,DWCreatedDateTime 
  	  FROM ' + @SchemaName + '.' + @TableName + ' (NOLOCK)'

	EXECUTE(@Statement)
	EXECUTE('GRANT SELECT ON ' + @SchemaName + '.' + @ViewName + '  TO OpsMgrReader')
END

Endproc:
GO




GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@ViewName  sysname
,@Statement nvarchar(max)

SET @TableName = 'UserDim'
SET @ViewName  = 'v' + @TableName

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Health State Dataset SCHEMA  is not defined. Cannot create dimension views.', 16,1)
  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @ViewName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  EXECUTE ('CREATE VIEW ' + @SchemaName + '.' + @ViewName + ' AS SELECT A = 1')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN

	SET @Statement = ' ALTER VIEW '  + @SchemaName + '.' + @ViewName + 
	'
	AS
	  SELECT 
	  UserRowId          
	  ,LogonName         
	  ,Domain            
	  ,UserName          
	  ,DWCreatedDateTime 
	  FROM ' + @SchemaName + '.' + @TableName + ' (NOLOCK)'

	EXECUTE(@Statement)
	EXECUTE('GRANT SELECT ON ' + @SchemaName + '.' + @ViewName + '  TO OpsMgrReader')
END

Endproc:
GO
 
GO
--------------------------------------------------------------------------------
-- Create Grooming procedure for Process Monitoring Health State DataSet
--------------------------------------------------------------------------------


DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int
  

SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

SET @DataSetMessage = 'Process Monitoring: Process HealthState DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0
----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------


SET @DebugPrefix  =  'Process Monitoring HealthState DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create grooming stored procedure.'

EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

SELECT 
	@fullSpName = GroomStoredProcedureName
FROM
dbo.StandardDatasetAggregation
WHERE DatasetId = '$Config/DatasetId$'




------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create grooming stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END


SET @Statement = 'ALTER PROCEDURE ' + @fullSpName + 
'
	   @DatasetId   uniqueidentifier
	  ,@AggregationTypeId tinyint
	  ,@TableGuid uniqueidentifier
	  ,@CutoffDateTime datetime
	  ,@MaxRowsToGroom int
	  ,@RowsDeleted int OUTPUT
	AS
	BEGIN
	  SET NOCOUNT ON

	  DECLARE 
		 @ErrorInd        bit
		,@ErrorMessage    nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)
		,@ErrorMessageText nvarchar(4000)
		,@ErrorLevel      int
		,@InfoLevel       int
  

      SET @ErrorLevel   = 3 
      SET @InfoLevel    = 1
	  SET @ErrorInd = 0
  
	  DECLARE
		 @TableName sysname
		,@Statement nvarchar(max)
		,@DebugLevel tinyint
		,@SchemaName sysname
  
	  BEGIN TRY
		SELECT
		   @DebugLevel = DebugLevel
		  ,@SchemaName = SchemaName
		FROM StandardDataset
		WHERE DatasetId = @DatasetId

		-- there are no dependent tables in HealthState data set
		SELECT @TableName = BaseTableName + ''_'' + REPLACE(CAST(@TableGuid AS varchar(50)), ''-'', '''')
		FROM StandardDatasetAggregationStorage
		WHERE (DatasetId = @DatasetId)
		  AND (AggregationTypeId = @AggregationTypeId)
		  AND (DependentTableInd = 0)
    
		SET @Statement = ''DELETE TOP ('' + CAST(@MaxRowsToGroom AS varchar(15)) + '')''
					   + '' FROM '' + QUOTENAME(@SchemaName) + ''.'' + QUOTENAME(@TableName)
					   + '' WHERE ([DateTime] &lt; CONVERT(datetime, '''''' + CONVERT(varchar(50), @CutoffDateTime, 120) + '''''', 120))''

		EXECUTE (@Statement)
		SET @RowsDeleted = @@ROWCOUNT
    
	  END TRY
	  BEGIN CATCH
		IF (@@TRANCOUNT &gt; 0)
		  ROLLBACK TRAN

		SELECT 
		   @ErrorNumber = ERROR_NUMBER()
		  ,@ErrorSeverity = ERROR_SEVERITY()
		  ,@ErrorState = ERROR_STATE()
		  ,@ErrorLine = ERROR_LINE()
		  ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
		  ,@ErrorMessageText = ERROR_MESSAGE()

		SET @ErrorInd = 1
	  END CATCH
    
	  -- report error if any
	  IF (@ErrorInd = 1)
	  BEGIN
		IF (@DebugLevel &gt; 0)
		BEGIN
		  DECLARE @DebugMessageText nvarchar(max)

		  SET @DebugMessageText = N''Failed to groom data for Process Monitoring HealthState  data set. Error '' + CAST(@ErrorNumber AS varchar(15))
						  + '', Procedure '' + @ErrorProcedure
						  + '', Line '' + CAST(@ErrorLine AS varchar(15))
						  + '', Message: ''+ @ErrorMessageText

		  EXEC DebugMessageInsert
			 @DatasetId = @DatasetId
			,@MessageLevel = @ErrorLevel
			,@MessageText = @DebugMessageText
		END
      
		DECLARE @AdjustedErrorSeverity int

		SET @AdjustedErrorSeverity = CASE
									   WHEN @ErrorSeverity &gt; 18 THEN 18
									   ELSE @ErrorSeverity
									 END

		RAISERROR (777971002, @AdjustedErrorSeverity, 1
		  ,@ErrorNumber
		  ,@ErrorSeverity
		  ,@ErrorState
		  ,@ErrorProcedure
		  ,@ErrorLine
		  ,@ErrorMessageText
		)
	  END
  
	  RETURN @RowsDeleted
	END
'

DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create grooming stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId = '$Config/DatasetId$'
		,@MessageLevel = @ErrorLevel
		,@MessageText = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Grooming stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	 @DatasetId    = '$Config/DatasetId$'
	,@MessageLevel = @InfoLevel
	,@MessageText  = @DebugMessage

 END
END

Endproc:
GO
   
--------------------------------------------------------------------------
-- Create Staging procedure for Process Monitoring Health State DataSet
--------------------------------------------------------------------------

GO

DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int

  

SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @DataSetMessage = 'Process Monitoring: Process Health State DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0

----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------


SET @DebugPrefix  =  'Process Monitoring HealthState DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure.'

EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@fullSpName = StagingProcessorStoredProcedureName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'





------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END

SET @Statement = 'ALTER PROCEDURE ' +@fullSpName + 
'
   @DatasetId           uniqueidentifier
AS
BEGIN
  SET NOCOUNT ON
  
  DECLARE 
     @ErrorInd        bit
    ,@ErrorMessage    nvarchar(max)
    ,@ErrorNumber     int
    ,@ErrorSeverity   int
    ,@ErrorState      int
    ,@ErrorLine       int
    ,@ErrorProcedure  nvarchar(256)
    ,@ErrorMessageText nvarchar(max)

  SET @ErrorInd = 0

 
    DECLARE
       @DebugLevel int
	  ,@StagingTableName sysname
      ,@ExecResult int
	  ,@SchemaName sysname
      ,@LockResourceName sysname
      ,@InsertTableName sysname
      ,@InsertTableGuid uniqueidentifier
      ,@InsertStartedDateTime datetime
      ,@Statement nvarchar(max)
      ,@MessageText varchar(max)
      ,@OperationDurationMs bigint
      ,@RawDataMaxAgeDays int
      ,@MaxStagingRowsToProcess int
	  ,@ErrorLevel        int
      ,@InfoLevel         int
	  ,@DebugMessageText nvarchar(max)
	  ,@StageSp nvarchar(max)
	  ,@ExecResultDim int
      ,@LockResourceNameDim sysname

  
	  SET @ErrorLevel   = 3 
      SET @InfoLevel    = 1

	DECLARE 
		@defaultHash nvarchar(64) = ''E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855'';
 
  BEGIN TRY   
    SELECT
       @DebugLevel = DebugLevel
	  ,@SchemaName = SchemaName
	  ,@StageSp    = StagingProcessorStoredProcedureName
    FROM StandardDataset
    WHERE (DatasetId = @DatasetId)

	----------------------------------
	-- Sanity check for datasetId
	----------------------------------
	IF (@StageSp &lt;&gt; '''
	
	SET @Statement = @Statement + @fullSpName + ''')
	BEGIN
	  Goto EndProc
	END


    -- get the minimum data retention period
    -- to make sure we do not re-aggregate something
    -- that is too old and all raw data is gone
    
    SELECT @RawDataMaxAgeDays = MaxDataAgeDays
    FROM StandardDatasetAggregation
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = 0)

	  ----------------------------
	  -- get max rows to process
	  -----------------------------

	  SELECT
	     @Statement = StagingTableColumnDefinition
        ,@MaxStagingRowsToProcess = ISNULL(MaxRowsToProcessPerTransactionCount,10000)
      FROM StandardDatasetStagingArea
      WHERE DatasetId = @DatasetId

  	  IF (@Statement IS NULL)
	  BEGIN
	    Goto Endproc
	  END


	--------------------------------------------------------------------------
	-- Delete old records from staging
	--------------------------------------------------------------------------
	DELETE ' + @SchemaName + '.ProcesStateStaging
    WHERE (DatasetId = @DatasetId)
      AND ([CollectedDate] &lt; DATEADD(day, -@RawDataMaxAgeDays, GETUTCDATE()) )

	
    '

     SET @Statement = @Statement + 
'

-------------------------------------------------------
-- Tables Sanity Check
--------------------------------------------------------
			IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ComputerDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ComputerDim table exiting..''
							Goto SanityCheck
				
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''UserDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find UserDim table exiting..''
							Goto SanityCheck
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ProcessDim table exiting..''
							Goto SanityCheck
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessCmdDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ProcessCMdDim table exiting..''
							Goto SanityCheck
			END

			  EXEC dbo.StandardDatasetGetInsertTableGuid @DatasetId, 0, @InsertTableGuid OUTPUT
    
				SELECT @InsertTableName = BaseTableName + ''_'' + REPLACE(CAST(@InsertTableGuid AS varchar(50)), ''-'', '''')
				FROM StandardDatasetAggregationStorage
				WHERE (DatasetId = @DatasetId)
				  AND (AggregationTypeId = 0)
				  AND (DependentTableInd = 0)


			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @InsertTableName AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find '' + @InsertTableName + '' table exiting..''
							Goto SanityCheck
			END

			Goto Staging

SanityCheck:
				EXEC DebugMessageInsert
					@DatasetId = @DatasetId
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessageText

                Goto DeleteWrongDataSet
				 
'
		
	    SET @Statement = @Statement +
	    '

Staging:

    IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessStateStaging2Process'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
    BEGIN
      BEGIN TRAN
        -- need to process subset of rows
        -- create extra column to store original row id
		 SELECT @Statement =
              ''CREATE TABLE '' + @SchemaName + ''.ProcessStateStaging2Process ('' 
            + @Statement
            + '',OriginalProcessStateStageRowId  bigint  NOT NULL''
            + '')''

			EXECUTE (@Statement)
			
	  COMMIT

			'
	   

                                                 	
	    SET @Statement = @Statement +
	    '

		IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessStateStaging2Process'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
        BEGIN
		 Goto Endproc
		END

      BEGIN TRAN

		INSERT INTO ' + @SchemaName + '.ProcessStateStaging2Process
		(
			 DatasetId                      
			,ManagementGroupGuid           
			,ManagedEntityGuid             
			,CollectedDate              
			,DateKey                       
			,TimeKey                       
			,ManagedEntityRowId	          
			,ComputerRowId                 
			,ProcessRowId                  
			,ProcessCmdRowId               
			,UserRowId                     
			,ProcessId                     
			,CpuHealthState                
			,MemoryHealthState             
			,HandleCountHealthState        
			,AggregateHealthState
			,CpuThreshold    
			,MemoryThreshold 
			,HandleThreshold 
			,ProcessName                   
			,[Description]
			,CommandLine                   
			,CommandLineHash               
			,UserName                      
			,DWCreatedDateTime             
			,OriginalProcessStateStageRowId
		)
        SELECT TOP (@MaxStagingRowsToProcess)
			 DatasetId                      
			,ManagementGroupGuid           
			,ManagedEntityGuid             
			,CollectedDate
			,DateKey                       
			,TimeKey                       
			,ManagedEntityRowId
			,ComputerRowId                 
			,ProcessRowId                  
			,ProcessCmdRowId               
			,UserRowId                     
			,ProcessId                     
			,CpuHealthState                
			,MemoryHealthState             
			,HandleCountHealthState        
			,AggregateHealthState          
			,CpuThreshold    
			,MemoryThreshold 
			,HandleThreshold 
			,ProcessName                   
			,Description                  
			,CommandLine                   
			,CommandLineHash               
			,UserName                      
			,DWCreatedDateTime             
			,ProcessStateStageRowId
			FROM
			' + @SchemaName + '.ProcesStateStaging
			WHERE DatasetId = @DatasetId
			ORDER BY CollectedDate

      
      COMMIT
    END -- IF NOT EXISTS ProcessMonitoring.ProcessStateStaging2Process
    
    -- create index on datetime field
    IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = ''IX_ProcessStateStaging2Process_DateTime'')
    BEGIN
      CREATE INDEX IX_ProcessStateStaging2Process_DateTime ON ' + @SchemaName + '.ProcessStateStaging2Process(CollectedDate)
    END

    BEGIN TRAN
    -- lock dimension tables  to ensure we insert into dimensions opened for insertion
					SET @LockResourceNameDim = ''ProcessMonitoringDimensions_TableMap''
  
					EXEC @ExecResultDim = sp_getapplock
						   @Resource = @LockResourceNameDim
						  ,@LockMode = ''Exclusive''
						  ,@LockOwner = ''Transaction''

				 IF (@ExecResultDim &lt; 0) 
				 BEGIN
				   RETURN
				 END 
   

	-------------------------------------------------------------
	-- Updating Dimensions
	--------------------------------------------------------------

			--------------------------------------------------------------
			--Update Computer Dimension
			--------------------------------------------------------------
			--- 2.1 Update Staging Table with ManagedEntityRowId from Microsoft Windows Computer

					UPDATE stage
					 SET 
						ManagedEntityRowid     = me.ManagedEntityRowid
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
							  JOIN vManagementGroup mg ON (stage.ManagementGroupGuid = mg.ManagementGroupGuid)
							  JOIN vManagedEntity me ON ((me.ManagedEntityGuid = stage.ManagedEntityGuid) AND (mg.ManagementGroupRowId = me.ManagementGroupRowId))
 						      JOIN vManagedEntityType met ON (met.ManagedEntityTypeRowId = me.ManagedEntityTypeRowId)
 					 WHERE (stage.DatasetId = @DatasetId) AND ( met.ManagedEntityTypeGuid = ''EA99500D-8D52-FC52-B5A5-10DCD1E9D2BD'')






			---2.2 Insert new Computers in Computer Dimension 

					INSERT INTO ' + @SchemaName + '.ComputerDim
					(
						ManagementEntityRowId
					   ,Name
					   ,NetbiosName
					   ,PrincipalName
					)
					SELECT DISTINCT
						 me.ManagedEntityRowid
						 ,UPPER(me.Name)
						 , CASE CHARINDEX(''.'',me.Name)
						   WHEN 0  THEN UPPER(me.Name)
						   ELSE
							UPPER(LEFT(me.Name,CHARINDEX(''.'',me.Name) - 1))
						   END
						 ,LOWER(me.Name)
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
					JOIN vManagedEntity me ON me.ManagedEntityRowId = stage.ManagedEntityRowId
					WHERE 
					 NOT EXISTS (SELECT *
                      FROM ' + @SchemaName + '.ComputerDim 
                      WHERE (ManagementEntityRowId = me.ManagedEntityRowId)
                     )
					 AND
					 stage.ManagedEntityRowid  &lt;&gt; 0
					 AND
					 me.Name IS NOT NULL


			---2.3 Update Staging with Computer Dimension Key

					UPDATE stage
					 SET 
						ComputerRowId     = pc.ComputerRowid
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
					JOIN ' + @SchemaName + '.ComputerDim pc ON (stage.ManagedEntityRowId = pc.ManagementEntityRowId)	    


			--------------------------------------------------------------
			--Update User Dimension
			--------------------------------------------------------------

			---3.1 Insert new Users in User Dimension 

					INSERT INTO ' + @SchemaName + '.UserDim
					(
						LogonName
					   ,Domain
					   ,UserName
					)
					SELECT DISTINCT
						 UPPER(stage.UserName) 
						 ,UPPER(
								  CASE CHARINDEX(''\'',stage.UserName)
								   WHEN 0  THEN ''''
								   ELSE
									LEFT(stage.UserName,CHARINDEX(''\'',stage.UserName) - 1)
								  END
								)
						 ,UPPER(
								  CASE CHARINDEX(''\'',stage.UserName)
								   WHEN 0  THEN stage.UserName
								   ELSE
									RIGHT(stage.UserName,LEN(stage.UserName)- CHARINDEX(''\'',stage.UserName))
								  END
								)
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.UserDim u ON (ISNULL(stage.UserName,'''') = u.LogonName)
					WHERE 
					u.UserRowid IS NULL
					AND
					stage.ManagedEntityRowid  &lt;&gt; 0

			---3.3 Update Staging with new User Dimension Key
					UPDATE stage
					 SET 
						UserRowId     = u.UserRowid
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
					JOIN ' + @SchemaName + '.UserDim u ON (ISNULL(stage.UserName,'''') = u.LogonName)
					WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0

			--------------------------------------------------------------
			--Update Process Dimension
			--------------------------------------------------------------
			---4.1. Insert new Processes in Process Dimension 

			        ;WITH ProcessByName AS
					(
					  SELECT ProcessName,ISNULL([Description],'''') AS [Description], ROW_NUMBER() OVER(PARTITION BY ProcessName ORDER BY [Description]) as Id
					  FROM 
					  ' + @SchemaName + '.ProcessStateStaging2Process
					  WHERE
					  ManagedEntityRowid  &lt;&gt; 0
					),
					Processes AS
					(
					  SELECT ProcessName, [Description]
					  FROM ProcessByName
					  WHERE 
					  Id = 1
					)


					INSERT INTO ' + @SchemaName + '.ProcessDim
					(
						 ProcessName
						,[Description]
					)
					SELECT 
						   stage.ProcessName
						  ,stage.[Description] 
					FROM
					Processes stage
					LEFT OUTER JOIN ' + @SchemaName + '.ProcessDim p ON (stage.ProcessName = p.ProcessName)
					WHERE 
					p.ProcessRowId IS NULL

			---4.2. Update Staging with new Process Dimension Key
					UPDATE stage
					 SET 
						ProcessRowId     = p.ProcessRowid
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
					JOIN ' + @SchemaName + '.ProcessDim p ON (stage.ProcessName = p.ProcessName)
                    WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0


			--------------------------------------------------------------
			--Update Process Command Line Dimension
			--------------------------------------------------------------

			---5.1. Insert new Process Command Lines in ProcessCmd Dimension 

					INSERT INTO ' + @SchemaName + '.ProcessCmdDim
					(
						CommandLine
						,CommandLineHash
					)
					SELECT DISTINCT
						  stage.CommandLine
						 ,ISNULL(stage.CommandLineHash, @defaultHash)
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.ProcessCmdDim p ON (ISNULL(stage.CommandLineHash,@defaultHash)  = p.CommandLineHash)
					WHERE 
					p.ProcessCmdRowId IS NULL
					AND
					 stage.ManagedEntityRowid  &lt;&gt; 0

			---5.2. Update Staging with new Process Command Line Dimension Key
					UPDATE stage
					 SET 
						ProcessCmdRowId     = p.ProcessCmdRowid
					FROM
					' + @SchemaName + '.ProcessStateStaging2Process stage
					JOIN ' + @SchemaName + '.ProcessCmdDim p ON (ISNULL(stage.CommandLineHash,@defaultHash)  = p.CommandLineHash)
					WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0

	    EXEC sp_releaseapplock  @Resource = @LockResourceNameDim 
	  COMMIT

    BEGIN TRAN
	   -- lock table map to ensure we insert into table opened for insertion
    SET @LockResourceName = CAST(@DatasetId AS varchar(50)) + ''_TableMap''
  
    EXEC @ExecResult = sp_getapplock
           @Resource = @LockResourceName
          ,@LockMode = ''Shared''
          ,@LockOwner = ''Transaction''

    IF (@ExecResult &lt; 0)
    BEGIN
      RAISERROR(777971001, 16, 1, ''Shared:StandardDatasetTableMap'', @ExecResult)
    END
	-------------------------------------------------------------------------------------------------
	-- Updating Fact Process HealthState Table
	--------------------------------------------------------------------------------------------------

				SET @Statement = 
				''INSERT INTO '' + QUOTENAME(@SchemaName)  + ''.'' + QUOTENAME(@InsertTableName) +''
				(
						 DateKey                        
						,TimeKey                        
						,ComputerRowId                  
						,ProcessRowId                   
						,ProcessCmdRowId 
						,UserRowId                 
						,Pid                            
						,CpuHealthState                 
						,MemoryHealthState              
						,HandleCountHealthState         
						,AggregateHealthState 
						,CpuThreshold    
						,MemoryThreshold 
					    ,HandleThreshold 
						,DateTime                  
				)
				SELECT
						 DateKey                        
						,TimeKey                        
						,ComputerRowId                  
						,ProcessRowId                   
						,ProcessCmdRowId
						,UserRowId                  
						,ProcessId                         
						,CpuHealthState                 
						,MemoryHealthState              
						,HandleCountHealthState         
						,AggregateHealthState           
						,CpuThreshold    
						,MemoryThreshold 
						,HandleThreshold 
						,CollectedDate                   
				FROM 
					' + @SchemaName + '.ProcessStateStaging2Process
				WHERE
			    ManagedEntityRowId &lt;&gt; 0
				''

				IF (@DebugLevel &gt; 0)
				BEGIN
				  SELECT @MessageText = ''Starting to insert '' + CAST(COUNT(*) AS varchar(30)) + '' process Health State samples into '' + @InsertTableName
                  FROM ' + @SchemaName + '.ProcessStateStaging2Process

				  SET @InsertStartedDateTime = GETUTCDATE()
      
				  EXEC DebugMessageInsert
					 @DatasetId = @DatasetId
					,@MessageLevel = @InfoLevel
					,@MessageText = @MessageText
				END
			
				EXEC(@Statement)

			 -- mark existing affected aggregations as dirty
				UPDATE ah
				SET DirtyInd = 1
				   ,DataLastReceivedDateTime = GETUTCDATE()
				FROM StandardDatasetAggregationHistory ah
					  JOIN StandardDatasetAggregation a ON (ah.DatasetId = a.DatasetId AND ah.AggregationTypeId = a.AggregationTypeId)
					  CROSS JOIN ' + @SchemaName + '.ProcessStateStaging2Process p
				WHERE (ah.DatasetId = @DatasetId)
				  AND (ah.AggregationDateTime &gt; DATEADD(day, -@RawDataMaxAgeDays, GETUTCDATE()))
				  AND (p.[CollectedDate ] &gt;= ah.AggregationDateTime)
				  AND (p.[CollectedDate] &lt; DATEADD(minute, a.AggregationIntervalDurationMinutes, ah.AggregationDateTime))

			   -- delete processed rows from staging
               DELETE ps
               FROM ' + @SchemaName + '.ProcesStateStaging ps
               JOIN ' + @SchemaName + '.ProcessStateStaging2Process psp ON (ps.ProcessStateStageRowId  = psp.OriginalProcessStateStageRowId )
    
				-- delete all inserted data from staging
				DROP TABLE ' + @SchemaName + '.ProcessStateStaging2Process

                EXEC sp_releaseapplock  @Resource = @LockResourceName 
	COMMIT
    
	IF (@DebugLevel &gt; 0)
    BEGIN
      SET @MessageText = ''Process Monitroing Health State DataSet: Finished inserting health state samples  into '' + @InsertTableName
      SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @InsertStartedDateTime))
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @MessageText
        ,@OperationDurationMs = @OperationDurationMs
    END
    
  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN
  
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
  END CATCH

  -- report error if any
  IF (@ErrorInd = 1)
  BEGIN
    IF (@DebugLevel &gt; 0)
    BEGIN
      
      SET @DebugMessageText = N''Failed to process data in the Process Monitroing Health State DataSet staging area. Error '' + CAST(@ErrorNumber AS varchar(15))
                      + '', Procedure '' + @ErrorProcedure
                      + '', Line '' + CAST(@ErrorLine AS varchar(15))
                      + '', Message: ''+ @ErrorMessageText

      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @ErrorLevel
        ,@MessageText = @DebugMessageText
    END
      
    DECLARE @AdjustedErrorSeverity int

    SET @AdjustedErrorSeverity = CASE
                                   WHEN @ErrorSeverity &gt; 18 THEN 18
                                   ELSE @ErrorSeverity
                                 END
    
    RAISERROR (777971002, @AdjustedErrorSeverity, 1
      ,@ErrorNumber
      ,@ErrorSeverity
      ,@ErrorState
      ,@ErrorProcedure
      ,@ErrorLine
      ,@ErrorMessageText
    )

  END

DeleteWrongDataSet:
	--------------------------------------------------------------------------
	-- Delete wrong  datasets from staging
	--------------------------------------------------------------------------
	DECLARE
	  @delBatchSize int
	 ,@ErrorIndDel int
	 
	 SET @ErrorIndDel  = 0
	 SET @delBatchSize = @MaxStagingRowsToProcess

	IF (@DebugLevel &gt; 0)
    BEGIN
      SET @MessageText = ''Process Monitroing Health State DataSet: Starting deletion of wrong DataSets records from staging ''
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @MessageText
    END

   SET @InsertStartedDateTime = GETUTCDATE()

	WHILE(1=1)
	BEGIN
	 BEGIN TRY
	     BEGIN TRAN
			DELETE TOP(@delBatchSize) FROM ' + @SchemaName + '.ProcesStateStaging
			WHERE (DatasetId != @DatasetId)

			IF (@@rowcount &lt; @delBatchSize)
			BEGIN
				COMMIT
				BREAK;
			END
 	     COMMIT

	 END TRY
     BEGIN CATCH
		IF (@@TRANCOUNT &gt; 0)
		  ROLLBACK TRAN
  
		SELECT 
		   @ErrorNumber = ERROR_NUMBER()
		  ,@ErrorSeverity = ERROR_SEVERITY()
		  ,@ErrorState = ERROR_STATE()
		  ,@ErrorLine = ERROR_LINE()
		  ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
		  ,@ErrorMessageText = ERROR_MESSAGE()

		SET @ErrorIndDel = 1
	 END CATCH

	 IF (@ErrorIndDel = 1)
	 BEGIN

			BREAK;
     END --IF
    END --WHILE

	 IF (@ErrorIndDel = 1)
	 BEGIN
			IF (@DebugLevel &gt; 0)
			BEGIN

      
				SET @DebugMessageText = N''Failed to delete  data from wromg dataset in the Process Monitroing Health State DataSet staging area. Error '' + CAST(@ErrorNumber AS varchar(15))
								+ '', Procedure '' + @ErrorProcedure
								+ '', Line '' + CAST(@ErrorLine AS varchar(15))
								+ '', Message: ''+ @ErrorMessageText

				EXEC DebugMessageInsert
					@DatasetId = @DatasetId
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessageText
			END
      
			SET @AdjustedErrorSeverity = CASE
											WHEN @ErrorSeverity &gt; 18 THEN 18
											ELSE @ErrorSeverity
											END
    
			RAISERROR (777971002, @AdjustedErrorSeverity, 1
				,@ErrorNumber
				,@ErrorSeverity
				,@ErrorState
				,@ErrorProcedure
				,@ErrorLine
				,@ErrorMessageText
			)

     END
	 ELSE
	 BEGIN
		IF (@DebugLevel &gt; 0)
		BEGIN
		  SET @MessageText = ''Process Monitroing Health State DataSet: Finished deleting wrong dataset records from staging ''
          SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @InsertStartedDateTime))
      
		  EXEC DebugMessageInsert
			 @DatasetId = @DatasetId
			,@MessageLevel = @InfoLevel
			,@MessageText = @MessageText
            ,@OperationDurationMs = @OperationDurationMs

		END

     END --IF

 Endproc:  
END  --Procedure [ProcessMonitoring].[HealthStateProcessStaging]
'

DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create stage processing stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId = '$Config/DatasetId$'
		,@MessageLevel = @ErrorLevel
		,@MessageText = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Stage processing stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	 @DatasetId    = '$Config/DatasetId$'
	,@MessageLevel = @InfoLevel
	,@MessageText  = @DebugMessage

 END                                
END

Endproc:
GO
</Install><Uninstall>

GO

DECLARE
 @TableSchemaName sysname


SELECT 
	@TableSchemaName  = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

-- drop SPs
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME =  'HealthStateFactsGroom')
	BEGIN
		EXECUTE ('DROP PROCEDURE ' + @TableSchemaName +'.HealthStateFactsGroom')
	END


IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME = 'HealthStateProcessStaging')
	BEGIN
		EXECUTE ('DROP PROCEDURE ' + @TableSchemaName +'.HealthStateProcessStaging ')
	END


--drop views
IF  EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'vComputerDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.vComputerDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'vUserDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.vUserDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'vTimeDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.vTimeDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'vDateDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.vDateDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'vProcessDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.vProcessDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'vProcessCmdDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.vProcessCmdDim')
END

IF  EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'ComputerDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.ComputerDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'UserDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.UserDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'TimeDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.TimeDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'DateDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.DateDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'ProcessDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.ProcessDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'ProcessCmdDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.ProcessCmdDim')
END

-- delete std dataset related data
EXEC StandardDatasetDelete '$Config/DatasetId$'

GO

</Uninstall><Upgrade/></DataWarehouseDataSet><DataWarehouseDataSet ID="Microsoft.Windows.Server.10.0.MetricsCollection.Dataset" Accessibility="Internal"><Dependencies><DataWarehouseScript>SCDW!Microsoft.SystemCenter.DataWarehouse.Script.DatasetDebuggingSupport</DataWarehouseScript><DataWarehouseScript>SCDW!Microsoft.SystemCenter.DataWarehouse.Script.StandardDatasetSupport</DataWarehouseScript></Dependencies><Configuration><IncludeSchemaTypes><SchemaType>SCDW!Microsoft.SystemCenter.DataWarehouse.StandardDatasetSchema</SchemaType></IncludeSchemaTypes><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="Aggregations" type="AggregationsType"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="RawInsertTableCount" type="xsd:positiveInteger"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DefaultAggregationIntervalCount" type="xsd:positiveInteger"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="BlockingMaintenanceDailyStartTime" type="TimeOfDayType"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="BlockingMaintenanceDurationMinutes" type="xsd:positiveInteger"/></Configuration><Install>

GO
---------------------------------------------------------------
-- Initialize Process Performance Dataset
--------------------------------------------------------------
SET NOCOUNT ON

DECLARE 
        @SchemaName sysname
	   ,@ProcessStagingSp sysname
	   ,@ErrorInd   bit
	   ,@DebugLevel tinyint
	   ,@DebugPrefix  nvarchar(max)
       ,@DebugMessage  nvarchar(max)
	   ,@ErrorLevel      int
	   ,@InfoLevel       int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugLevel   = 0
SET @SchemaName  = 'ProcessMonitoring'
SET @ProcessStagingSp = 'PerformanceProcessStaging'

SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + ' Insert new definition.'


EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage



BEGIN TRY

	INSERT StandardDataset (
	   DatasetId 
	  ,SchemaName
	  ,DebugLevel
	  ,DefaultAggregationIntervalCount
	  ,RawInsertTableCount
	  ,StagingProcessorStoredProcedureName
	  ,BlockingMaintenanceDailyStartTime
	  ,BlockingMaintenanceDurationMinutes
	)
	VALUES
	(
	   '$Config/DatasetId$'
	  ,@SchemaName
	  ,@DebugLevel
	  ,$Config/DefaultAggregationIntervalCount$
	  ,$Config/RawInsertTableCount$
	  ,@SchemaName + '.' + @ProcessStagingSp
	  ,'$Config/BlockingMaintenanceDailyStartTime$'
	  ,$Config/BlockingMaintenanceDurationMinutes$
	)

	END TRY
	BEGIN CATCH
	 SET @ErrorInd = 1
	END CATCH

	IF (1 = @ErrorInd)
	BEGIN
	    SET @DebugMessage =  @DebugPrefix + 'Insert new definition failed.'

		EXEC DebugMessageInsert
				@DatasetId = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessage

	END
	ELSE
	BEGIN
	    SET @DebugMessage =  @DebugPrefix + ' Insert new definition finished successfully.'

		EXEC DebugMessageInsert
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @InfoLevel
				,@MessageText  = @DebugMessage


	END 
GO


---------------------------------------------------------------------------------------
-- Create the StandardDatasetAggregation for Process Monitoring Performance  Fact Tables
----------------------------------------------------------------------------------------

GO
SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugPrefix  nvarchar(max)
  ,@DebugMessage  nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int

SET @ErrorInd     = 0
SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @DebugPrefix  = 'Process Monitoring Performance DataSet: '
SET @DebugMessage = @DebugPrefix  + 'Starting aggregation setting deployment.'

DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText varchar(max)
  ,@BuildAggregationStoredProcedureName  sysname
  ,@DeleteAggregationStoredProcedureName sysname
  ,@GroomStoredProcedureName             sysname
  ,@SchemaName                           sysname

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
  
BEGIN TRY
  SELECT @SchemaName = SchemaName
  FROM
  dbo.StandardDataSet
  WHERE DatasetId = '$Config/DatasetId$'

  IF @SchemaName IS NULL
  BEGIN
    
   SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was failed. Process Monitoring Health State Dataset does not exist.'
  
   EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage


   RAISERROR( @DebugMessage, 16,1)
  END
  
  
  SET @BuildAggregationStoredProcedureName  = @SchemaName + '.' + 'PerformanceFactsAggregate'
  SET @DeleteAggregationStoredProcedureName = @SchemaName + '.' + 'PerformanceFactsAggregateDelete'
  SET @GroomStoredProcedureName             = @SchemaName + '.' + 'PerformanceFactsGroom'
 
  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'

  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0 RAISERROR(777971000, 16, 1, 'Process Monitoring: Health State Aggregation', @ExecResult)

  IF NOT EXISTS (SELECT 1 FROM dbo.StandardDatasetAggregation WHERE  DatasetId = '$Config/DatasetId$' )
  BEGIN
	  INSERT StandardDatasetAggregation
	  (                               
		 DatasetId
		,AggregationTypeId
		,AggregationIntervalDurationMinutes
		,AggregationStartDelayMinutes
		,BuildAggregationStoredProcedureName
		,DeleteAggregationStoredProcedureName
		,GroomStoredProcedureName
		,IndexOptimizationIntervalMinutes
		,MaxDataAgeDays
		,GroomingIntervalMinutes
		,MaxRowsToGroom
		,LastGroomingDateTime
		,DataFileGroupName
		,IndexFileGroupName
	  )
	  SELECT
     '$Config/DatasetId$'
    ,CASE AggregationType
       WHEN 'Raw' THEN 0
       WHEN 'Subhourly' THEN 10
       WHEN 'Hourly' THEN 20
       WHEN 'Daily' THEN 30
     END
    ,CASE AggregationType
       WHEN 'Raw' THEN NULL
       WHEN 'Subhourly' THEN AggregationIntervalDurationMinutes
       WHEN 'Hourly' THEN 60
       WHEN 'Daily' THEN 24*60
     END
    ,AggregationStartDelayMinutes
    ,@BuildAggregationStoredProcedureName
    ,CASE AggregationType
       WHEN 'Raw' THEN NULL
       ELSE @DeleteAggregationStoredProcedureName
     END
    ,@GroomStoredProcedureName
    ,IndexOptimizationIntervalMinutes
    ,MaxDataAgeDays
    ,GroomingIntervalMinutes
    ,MaxRowsToGroom
    ,GETUTCDATE()
    ,DataFileGroupName
    ,IndexFileGroupName
     FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
		   AggregationType                    varchar(50)   '@mp:localname'
		  ,MaxTableRowCount                   int
		  ,MaxTableSizeKb                     int
		  ,AggregationStartDelayMinutes       int
		  ,MaxDataAgeDays                     int
		  ,GroomingIntervalMinutes            int
		  ,MaxRowsToGroom                     int
		  ,IndexOptimizationIntervalMinutes   int
		  ,DataFileGroupName                  nvarchar(256)
		  ,IndexFileGroupName                 nvarchar(256)
		  ,AggregationIntervalDurationMinutes int
	  )
  END
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int


  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

 SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was failed. Error: ' + @ErrorMessageText
  
 EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
  
  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was finished successfully.'
  
 EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

END

GO
 

 
------------------------------------------------------------------------------------------------------------
-- Create the StandardDataset Aggregation Tables definitions for Process Monitoring Performance Fact Tables
------------------------------------------------------------------------------------------------------------
GO
SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage    nvarchar(max)
  ,@DebugPrefix     nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugPrefix  =  'Process Monitoring Perfromance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting dataset table definitions deployment.'

DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText nvarchar(max)
  ,@TableCompressionClause nvarchar(max) 

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
  
BEGIN TRY
  SET @TableCompressionClause = ''
  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'

  -----------------------------------------------------------------------
  -- ENBALE PAGE COMPRESSION ON FACT Tables IF AVILABLE
  -----------------------------------------------------------------------
	IF ( 3 = SERVERPROPERTY('EngineEdition') 
		 OR
		 ('SP1' = SERVERPROPERTY('ProductLevel') AND CAST(SERVERPROPERTY('ProductVersion') AS VARCHAR(50)) like '13.0%')
	   )
	BEGIN
	  SET @TableCompressionClause = ' WITH (DATA_COMPRESSION = PAGE)'
	END



  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText

  IF @ExecResult &lt;&gt; 0 
  BEGIN

	  SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was failed. Cannot parse dataset definition. Xml definition: ' + @XmlDocText
  
	  EXEC DebugMessageInsert
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel 
				,@MessageText  = @DebugMessage

     RAISERROR(777971000, 16, 1, @DebugMessage, @ExecResult)

  END

  INSERT StandardDatasetAggregationStorage
  (                               
     DatasetId
    ,AggregationTypeId
    ,BaseTableName
    ,DependentTableInd
    ,TableTemplate
    ,CoverViewSelectClause
    ,MaxTableRowCount
    ,MaxTableSizeKb 
  )
  SELECT
     '$Config/DatasetId$'
     ,CASE AggregationType
			WHEN 'Raw' THEN 0
			WHEN 'Hourly' THEN 20
			WHEN 'Daily' THEN 30
		END
    ,BaseTableName
    ,0
    ,CASE AggregationType
       WHEN 'Raw' THEN '
                CREATE TABLE ' + QUOTENAME(d.SchemaName) + '.' + QUOTENAME(BaseTableName + '_$Guid$') + '
                (
                     ' + QUOTENAME(BaseTableName + 'RowId') + ' bigint  NOT NULL  IDENTITY(1, 1)
                    ,DateKey                        int  NOT NULL
                    ,TimeKey                        int  NOT NULL
                    ,ComputerRowId                  int  NOT NULL
                    ,ProcessRowId                   int  NOT NULL
                    ,ProcessCmdRowId                int  NOT NULL
					,UserRowId                      int  NOT NULL
                    ,PID                            int  NOT NULL
 				    ,CpuUsage                       float             NOT NULL
					,MemoryUsage                    float             NOT NULL
					,HandleCount                    int               NOT NULL 
					,ThreadCount                    int               NOT NULL 
					,PageFaultCount                 int               NOT NULL 
					,CpuTime                        bigint            NOT NULL 
					,TotalProcessTime               bigint            NOT NULL 
					,IOReadPerSecond                float             NOT NULL
					,IOWritePerSecond               float             NOT NULL 
                    ,[DateTime]                       datetime          NOT NULL
                    ,CONSTRAINT ' + QUOTENAME('PK_' + BaseTableName + '_$Guid$') + ' PRIMARY KEY CLUSTERED ('
                       + QUOTENAME(BaseTableName + 'RowId') + ') ON $DataFileGroupName$
                ) ON $DataFileGroupName$
       ' + @TableCompressionClause
	   ELSE
	   '
                CREATE TABLE ' + QUOTENAME(d.SchemaName) + '.' + QUOTENAME(BaseTableName + '_$Guid$') + '
                (
                     ' + QUOTENAME(BaseTableName + 'RowId') + ' bigint  NOT NULL  IDENTITY(1, 1)
                    ,DateKey                           int  NOT NULL
                    ,TimeKey                           int  NOT NULL
                    ,ComputerRowId                     int  NOT NULL
                    ,ProcessRowId                      int  NOT NULL
                    ,ProcessCmdRowId                   int  NOT NULL
					,UserRowId                         int  NOT NULL
                    ,PID                               int  NOT NULL
                    ,CpuUsageSampleCount               int  NOT NULL
                    ,CpuUsageAverageValue              float(53) NOT NULL
                    ,CpuUsageMinValue                  float(53) NOT NULL
                    ,CpuUsageMaxValue                  float(53) NOT NULL
                    ,CpuUsageStandardDeviation         float(53) NOT NULL
                    ,MemoryUsageSampleCount            int       NOT NULL
                    ,MemoryUsageAverageValue           float(53) NOT NULL
                    ,MemoryUsageMinValue               float(53) NOT NULL
                    ,MemoryUsageMaxValue               float(53) NOT NULL
                    ,MemoryUsageStandardDeviation      float(53) NOT NULL
                    ,HandleCountSampleCount            int       NOT NULL
                    ,HandleCountAverageValue           float(53) NOT NULL
                    ,HandleCountMinValue               int       NOT NULL
                    ,HandleCountMaxValue               int       NOT NULL
                    ,HandleCountStandardDeviation      float(53) NOT NULL
                    ,ThreadCountSampleCount            int       NOT NULL
                    ,ThreadCountAverageValue           float(53) NOT NULL
                    ,ThreadCountMinValue               int       NOT NULL
                    ,ThreadCountMaxValue               int       NOT NULL
                    ,ThreadCountStandardDeviation      float(53) NOT NULL
                    ,PageFaultCountSampleCount         int       NOT NULL
                    ,PageFaultCountAverageValue        float(53) NOT NULL
                    ,PageFaultCountMinValue            int       NOT NULL
                    ,PageFaultMaxValue                 int       NOT NULL
                    ,PageFaultCountStandardDeviation   float(53) NOT NULL
					,IOReadPerSecondSampleCount        int       NOT NULL
                    ,IOReadPerSecondAverageValue       float(53) NOT NULL
                    ,IOReadPerSecondMinValue           float(53) NOT NULL
                    ,IOReadPerSecondMaxValue           float(53) NOT NULL
                    ,IOReadPerSecondStandardDeviation  float(53) NOT NULL
					,IOWritePerSecondSampleCount       int       NOT NULL
                    ,IOWritePerSecondAverageValue      float(53) NOT NULL
                    ,IOWritePerSecondMinValue          float(53) NOT NULL
                    ,IOWritePerSecondMaxValue          float(53) NOT NULL
                    ,IOWritePerSecondStandardDeviation float(53) NOT NULL
					,CpuTimeSampleCount                int       NOT NULL
                    ,CpuTimeAverageValue               float(53) NOT NULL
					,CpuTimeMaxValue                   bigint    NOT NULL 
					,CpuTimeMinValue                   bigint    NOT NULL 
					,CpuTimeStandardDeviation          float(53) NOT NULL  
					,TotalProcessTimeMaxValue          bigint     NOT NULL 
                    ,[DateTime]                         datetime          NOT NULL
                    ,CONSTRAINT ' + QUOTENAME('PK_' + BaseTableName + '_$Guid$') + ' PRIMARY KEY CLUSTERED ('
                       + QUOTENAME(BaseTableName + 'RowId') + ') ON $DataFileGroupName$
                ) ON $DataFileGroupName$
       ' + @TableCompressionClause	   
     END
    ,CASE AggregationType
       WHEN 'Raw' THEN '
          SELECT
               DateKey
			  ,TimeKey
	          ,ComputerRowId         
              ,ProcessRowID          
              ,ProcessCmdRowID  
			  ,UserRowId 
              ,PID                   
              ,CpuUsage         
              ,MemoryUsage      
              ,HandleCount      
              ,ThreadCount         
			  ,PageFaultCount   
			  ,CpuTime          
			  ,TotalProcessTime 
			  ,IOReadPerSecond  
			  ,IOWritePerSecond 
			  ,[DateTime]
       '
	 ELSE
     '
          SELECT
				 DateKey                          
				,TimeKey                          
				,ComputerRowId                    
				,ProcessRowId                     
				,ProcessCmdRowId                  
				,UserRowId                        
				,PID                              
				,CpuUsageSampleCount              
				,CpuUsageAverageValue             
				,CpuUsageMinValue                 
				,CpuUsageMaxValue                 
				,CpuUsageStandardDeviation        
				,MemoryUsageSampleCount           
				,MemoryUsageAverageValue          
				,MemoryUsageMinValue              
				,MemoryUsageMaxValue              
				,MemoryUsageStandardDeviation     
				,HandleCountSampleCount           
				,HandleCountAverageValue          
				,HandleCountMinValue              
				,HandleCountMaxValue              
				,HandleCountStandardDeviation     
				,ThreadCountSampleCount           
				,ThreadCountAverageValue          
				,ThreadCountMinValue              
				,ThreadCountMaxValue              
				,ThreadCountStandardDeviation     
				,PageFaultCountSampleCount        
				,PageFaultCountAverageValue       
				,PageFaultCountMinValue           
				,PageFaultMaxValue                
				,PageFaultCountStandardDeviation  
				,IOReadPerSecondSampleCount       
				,IOReadPerSecondAverageValue      
				,IOReadPerSecondMinValue          
				,IOReadPerSecondMaxValue          
				,IOReadPerSecondStandardDeviation 
				,IOWritePerSecondSampleCount      
				,IOWritePerSecondAverageValue     
				,IOWritePerSecondMinValue         
				,IOWritePerSecondMaxValue         
				,IOWritePerSecondStandardDeviation
				,CpuTimeSampleCount               
				,CpuTimeAverageValue              
				,CpuTimeMaxValue                  
				,CpuTimeMinValue                  
				,CpuTimeStandardDeviation         
				,TotalProcessTimeMaxValue         
				,[DateTime]
	 
	 '
	 END
    ,MaxTableRowCount
    ,MaxTableSizeKb 
  FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
       AggregationType      varchar(50)   '@mp:localname'
      ,BaseTableName        varchar(256)
      ,MaxTableRowCount     int
      ,MaxTableSizeKb       int
      ,DataFileGroupName    varchar(256)
      ,IndexFileGroupName    varchar(256)
  )
      CROSS JOIN StandardDataset d
  WHERE (d.DatasetId = '$Config/DatasetId$')
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int


  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

  SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was failed. Error: ' + @ErrorMessageText
  
  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel 
			,@MessageText  = @DebugMessage

  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )
END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was finished successfully.'
 EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 
END

GO


  ------------------------------------------------------------------------------------------------------------
-- Create Indexes for the StandardDataset Aggregation Tables  for Process Monitoring Performance Fact Tables
------------------------------------------------------------------------------------------------------------

GO
SET NOCOUNT ON


-- create [DateTime] field indexes for all aggregation levels
DECLARE 
   @AggregationTypeId int
  ,@Statement         nvarchar(max)
  ,@IndeGuid          uniqueidentifier
  ,@ErrorInd          bit
  ,@ErrorMessageText  nvarchar(4000)
  ,@ErrorNumber       int
  ,@ErrorSeverity     int
  ,@ErrorState        int
  ,@ErrorLine         int
  ,@ErrorProcedure    nvarchar(256)
  ,@DebugMessage      nvarchar(max)
  ,@DebugPrefix       nvarchar(max)
  ,@ErrorLevel        int
  ,@InfoLevel         int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting dataset indexes deployment.'
SET @AggregationTypeId = -1

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 


BEGIN TRY

		WHILE EXISTS (SELECT *
					  FROM StandardDatasetAggregation
					  WHERE (DatasetId = '$Config/DatasetId$')
						AND (AggregationTypeId &gt; @AggregationTypeId)
					 )
		BEGIN
		  SELECT @IndeGuid = NEWID()
  
		  SELECT TOP 1 
			 @AggregationTypeId = AggregationTypeId
			,@Statement = 
			  ' EXEC StandardDatasetIndexDelete'
			+ '    @DatasetId = ''$Config/DatasetId$'''
			+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
			  + '   ,@DeleteIndexOnExistingTablesInd = 0'
			+ ' EXEC StandardDatasetIndexInsert'
			+ '    @DatasetId = ''$Config/DatasetId$'''
			+ '   ,@AggregationTypeId = ' + CAST(AggregationTypeId AS varchar(10))
			+ '   ,@DependentTableInd = 0'
			+ '   ,@TableTag = NULL'
			+ '   ,@UniqueInd = 0'
			+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
			+ '   ,@IndexDefinition = ''([DateTime])'''
			+ '   ,@CreateIndexOnExistingTablesInd = 0'
		  FROM StandardDatasetAggregation
		  WHERE (DatasetId = '$Config/DatasetId$')
			AND (AggregationTypeId &gt; @AggregationTypeId)
		  ORDER BY AggregationTypeId
  
		  EXECUTE (@Statement)
		END


		/* raw indexes for UI widget */

		EXEC StandardDatasetIndexDelete
		   @DatasetId = '$Config/DatasetId$'
		  ,@IndexGuid = '29F829DC-FD4D-49CF-8F27-1200EFA53316'
			,@DeleteIndexOnExistingTablesInd = 0


		EXEC StandardDatasetIndexInsert
		   @DatasetId = '$Config/DatasetId$'
		  ,@AggregationTypeId = 0
		  ,@DependentTableInd = 0
		  ,@TableTag = NULL
		  ,@UniqueInd = 0
		  ,@IndexGuid = '29F829DC-FD4D-49CF-8F27-1200EFA53316'
		  ,@IndexDefinition = '(
				 ComputerRowId     
				,ProcessRowId      
				,ProcessCmdRowId   
				,UserRowId         
				,PID               
				,DateTime
			)
			INCLUDE
			(
				 CpuUsage         
				,MemoryUsage      
				,HandleCount      
				,ThreadCount      
				,PageFaultCount   
				,CpuTime          
				,TotalProcessTime 
				,IOReadPerSecond  
				,IOWritePerSecond 
			)
		'
		  ,@CreateIndexOnExistingTablesInd = 0

END TRY
BEGIN CATCH
  SET @ErrorInd = 1

     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

END CATCH

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END
  
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was failed. Error: ' + @ErrorMessageText

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage 

  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was finished successfully.'
  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 
END

GO

------------------------------------------------------------------
--- Create SCHEMA for new Process Monitoring Performance DataSet
-------------------------------------------------------------------

GO
DECLARE 
@SchemaName sysname

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF NOT EXISTS (SELECT * FROM sys.schemas WHERE [name] = @SchemaName)
BEGIN
  EXECUTE('CREATE SCHEMA ' + @SchemaName)
END

 DECLARE @Statement  nvarchar(max)

 -- change schema ownership to allow index rebuild and reorganize

 SET  @Statement = 'ALTER AUTHORIZATION ON SCHEMA::' + @SchemaName + ' TO OpsMgrWriter'
 EXECUTE(@Statement)

 SET  @Statement = 'GRANT ALTER ON SCHEMA::' + @SchemaName + ' TO OpsMgrWriter'
 EXECUTE(@Statement)
 
 -- grant create table permissions
 GRANT CREATE TABLE TO OpsMgrWriter

GO

-----------------------------------------------------------------------
--- Start standard Process Monitoring Performance dataset  deployment
-----------------------------------------------------------------------

SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage    nvarchar(max)
  ,@DebugPrefix     nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int
  
SET @ErrorInd     = 0
SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText nvarchar(max)
 
SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting storage deployment.'


EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
			  
BEGIN TRY

  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'
  SET @DebugMessage = @DebugPrefix + 'Cannot parse configuration. Text: ' + @XmlDocText

  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0
  BEGIN
          EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText = @DebugMessage
 
   RAISERROR(777971000, 16, 1,@DebugMessage , @ExecResult)
  END

  DECLARE
     @AggregationType varchar(50)
    ,@Statement nvarchar(max)
     
  SET @AggregationType = ''

  WHILE EXISTS (SELECT *
                FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
                      AggregationType      varchar(50)   '@mp:localname')
                WHERE AggregationType &gt; @AggregationType
               )
  BEGIN
    SELECT TOP 1 @AggregationType = AggregationType
    FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
          AggregationType      varchar(50)   '@mp:localname')
    WHERE AggregationType &gt; @AggregationType
    ORDER BY AggregationType
    
    SET @Statement = 'EXEC StandardDatasetAllocateStorage @DatasetId = ''$Config/DatasetId$'', @AggregationTypeId='
                    + CASE @AggregationType
                        WHEN 'Raw' THEN '0'
                        WHEN 'Subhourly' THEN '10'
                        WHEN 'Hourly' THEN '20'
                        WHEN 'Daily' THEN '30'
                      END
    EXECUTE (@Statement)
  END
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

  SET @DebugMessage = @DebugPrefix + 'Storage deployment was failed. Error: ' + @ErrorMessageText
  
  EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText = @DebugMessage
  
  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )
END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix + 'Storage deployment was finished successfully.' 
 
 EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText = @DebugMessage
END

GO

--------------------------------------------------------------------------------------
--- Start standard Process Monitoring Performance dataset staging tables  deployment
--------------------------------------------------------------------------------------
GO

SET NOCOUNT ON

DECLARE 
   @ErrorInd         bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber      int
  ,@ErrorSeverity    int
  ,@ErrorState       int
  ,@ErrorLine        int
  ,@ErrorProcedure   nvarchar(256)
  ,@Statement        nvarchar(max)
  ,@DebugMessage     nvarchar(max)
  ,@DebugLevel       tinyint
  ,@DebugPrefix      nvarchar(max)
  ,@ErrorLevel       int
  ,@InfoLevel        int

  SET @ErrorInd     = 0
  SET @ErrorLevel   = 3 
  SET @InfoLevel    = 1
  SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
  SET @DebugMessage =  @DebugPrefix + ' Create staging table.'


  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage


-- insert staging definition into StandardDatasetStagingArea
BEGIN TRY

	BEGIN TRAN

	IF EXISTS (SELECT * FROM StandardDatasetStagingArea WHERE DatasetId = '$Config/DatasetId$')
	BEGIN
	  DELETE StandardDatasetStagingArea
	  WHERE DatasetId = '$Config/DatasetId$'
	END

	INSERT StandardDatasetStagingArea
	(
	   DatasetId
	  ,StagingTableColumnDefinition
	  ,BatchedProcessingSupportedInd
	  ,MaxRowsToProcessPerTransactionCount
	)
	VALUES
	(
	   '$Config/DatasetId$'
	  ,'
	   DatasetId                      uniqueidentifier  NOT NULL
	  ,ManagementGroupGuid            uniqueidentifier  NOT NULL
	  ,ManagedEntityGuid              uniqueidentifier  NOT NULL
	  ,CollectedDate                  datetime          NOT NULL
	  ,DateKey                        int               NOT NULL
	  ,TimeKey                        int               NOT NULL
	  ,ProcessId                      int               NOT NULL
	  ,CpuUsage                       float             NOT NULL
	  ,MemoryUsage                    float             NOT NULL
	  ,HandleCount                    int               NOT NULL 
	  ,ThreadCount                    int               NOT NULL 
	  ,PageFaultCount                 int               NOT NULL 
	  ,CpuTime                        bigint            NOT NULL 
	  ,TotalProcessTime               bigint            NOT NULL 
	  ,IOReadPerSecond                float             NOT NULL
	  ,IOWritePerSecond               float             NOT NULL 
	  ,ProcessName                    nvarchar(256)     NOT NULL
	  ,Description                    nvarchar(2000)    NULL
	  ,CommandLine                    nvarchar(max)     NULL
	  ,CommandLineHash                varchar(64)       NULL
	  ,UserName                       varchar(256)      NULL  
	  ,ManagedEntityRowId	          int               NULL DEFAULT(0)
	  ,ComputerRowId                  int               NULL DEFAULT(0)
	  ,ProcessRowId                   int               NULL DEFAULT(0)
	  ,ProcessCmdRowId                int               NULL DEFAULT(0)
	  ,UserRowId                      int               NULL DEFAULT(0)
	  ,DWCreatedDateTime              datetime          NULL DEFAULT (GETUTCDATE())
	  ,ProcessStageRowId         bigint            NOT NULL    IDENTITY(1, 1)  PRIMARY KEY
	  '
	  ,1
	  ,100000
	)

	COMMIT 

END TRY
BEGIN CATCH

    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN

	SELECT
		@ErrorNumber = ERROR_NUMBER()
		,@ErrorSeverity = ERROR_SEVERITY()
		,@ErrorState = ERROR_STATE()
		,@ErrorLine = ERROR_LINE()
		,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
		,@ErrorMessageText = ERROR_MESSAGE()

	SET @ErrorInd = 1

END CATCH

IF (@ErrorInd = 1)
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
									WHEN @ErrorSeverity &gt; 18 THEN 18
									ELSE @ErrorSeverity
								END

  
			SET @DebugMessage =  @DebugPrefix + 'staging table creation was failed. Error: ' + @ErrorMessageText
  
			EXEC DebugMessageInsert 
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText  = @DebugMessage


	RAISERROR (777971002, @AdjustedErrorSeverity, 1
		,@ErrorNumber
		,@ErrorSeverity
		,@ErrorState
		,@ErrorProcedure
		,@ErrorLine
		,@ErrorMessageText
		)
END
ELSE
BEGIN
   DECLARE 
	@SchemaName sysname
	,@TableName  sysname

	SET @TableName = 'ProcesStaging'
	
	SELECT @SchemaName = SchemaName
	FROM
	dbo.StandardDataSet
	WHERE DatasetId = '$Config/DatasetId$'

  BEGIN TRY	
	IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
	BEGIN
        
		SELECT @Statement = StagingTableColumnDefinition
		FROM StandardDatasetStagingArea
		WHERE DatasetId = '$Config/DatasetId$'

	    IF @Statement IS NOT NULL
		BEGIN
		  SELECT @Statement = 'CREATE TABLE ' + @SchemaName + '.' + @TableName +  '(' + @Statement + ')'
		  EXECUTE (@Statement)
		END
		ELSE
		BEGIN
			SET @DebugMessage =  @DebugPrefix + 'Staging Data definition does not exist.'
  
			EXEC DebugMessageInsert 
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText  = @DebugMessage
		END

	END
 END TRY
 BEGIN CATCH
  	SELECT
		@ErrorNumber = ERROR_NUMBER()
		,@ErrorSeverity = ERROR_SEVERITY()
		,@ErrorState = ERROR_STATE()
		,@ErrorLine = ERROR_LINE()
		,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
		,@ErrorMessageText = ERROR_MESSAGE()

	SET @ErrorInd = 1

	SET @DebugMessage =  @DebugPrefix + 'staging table creation was failed. Error: ' + @ErrorMessageText
  
    EXEC DebugMessageInsert 
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage

 END CATCH

 IF (0 = @ErrorInd)
 BEGIN
  SET @DebugMessage =  @DebugPrefix + 'staging table created successfully. '

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

 END 
END


GO





GO
-------------------------------------------------------------------------
-- Create aggregation procedure for Process Monitoring Performance DataSet
-------------------------------------------------------------------------


DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int
  

SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

SET @DataSetMessage = 'Process Monitoring: Process Performance DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0
----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------


SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create Aggregation processing stored procedure.'

EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

SELECT 
	@fullSpName = BuildAggregationStoredProcedureName
FROM
dbo.StandardDatasetAggregation
WHERE DatasetId = '$Config/DatasetId$'



------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Aggregation processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Aggregation processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create Aggregation processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create Aggregation processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Aggregation processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END

SET @Statement = 'ALTER PROCEDURE ' + @fullSpName + 
'
   @DatasetId   uniqueidentifier
  ,@AggregationTypeId int
  ,@InsertTableGuid varchar(256)
  ,@IntervalStartDateTime datetime
  ,@IntervalEndDateTime datetime
AS
BEGIN
  SET NOCOUNT ON

  DECLARE 
     @ErrorInd        bit
    ,@ErrorMessage    nvarchar(4000)
    ,@ErrorNumber     int
    ,@ErrorSeverity   int
    ,@ErrorState      int
    ,@ErrorLine       int
    ,@ErrorProcedure  nvarchar(256)
    ,@ErrorMessageText nvarchar(4000)
	,@ErrorLevel        int
	,@InfoLevel         int


	SET @ErrorLevel   = 3 
	SET @InfoLevel    = 1
    SET @ErrorInd     = 0
	
  
  BEGIN TRY
    DECLARE
       @Statement nvarchar(max)
      ,@DebugLevel tinyint
      ,@InsertTableName sysname
      ,@DebugMessage nvarchar(max)
      ,@AggregationStartDateTime datetime
      ,@CoverViewName sysname
      ,@SchemaName sysname
      ,@DebugMessageSmall nvarchar(max)
	  ,@DATEKEY int
	  ,@TIMEKEY int
	  ,@FullViewName nvarchar(max)
	  ,@FullInsertTableName nvarchar(max)
	  ,@InsertEndDateTimeStr  nvarchar(200)
      ,@InsertStartDateTimeStr  nvarchar(200)
	  ,@DebugPrefix nvarchar(200)

	  SET @DebugPrefix  = ''Process Monitoring Performance DataSet: Aggregation procedure: ''
---------------------------------------------------------------
-- Parameter block sanity check
---------------------------------------------------------------
   IF @DatasetId IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Aggregation dataset id is empty. Exiting procedure without calculation.''
      RAISERROR (@DebugMessage, 16, 1)
	END

    IF @InsertTableGuid IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Aggregation table postfix is empty. Exiting procedure without calculation.''
      RAISERROR (@DebugMessage, 16, 1)
	END

    IF @IntervalStartDateTime IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Interval Start Time is empty. Exiting procedure without calculation.''
      RAISERROR (@DebugMessage, 16, 1)
	END

    IF @IntervalEndDateTime IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Interval End Time is empty. Exiting procedure without calculation.''
      RAISERROR (@DebugMessage, 16, 1)
	END

    IF @AggregationTypeId IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Aggregation type is empty. Exiting procedure without calculation.''
	  RAISERROR (@DebugMessage, 16, 1)
    END


---------------------------------------------------------------
-- End of Parameter block sanity check
---------------------------------------------------------------


    SELECT
       @DebugLevel = DebugLevel
      ,@SchemaName = SchemaName
    FROM StandardDataset
    WHERE DatasetId = @DatasetId
    
    SELECT @CoverViewName = ''v'' + BaseTableName
    FROM StandardDatasetAggregationStorage
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = 0)
      AND (DependentTableInd = 0)
      
    SELECT @InsertTableName = BaseTableName + ''_'' + REPLACE(CAST(@InsertTableGuid AS varchar(50)), ''-'', '''')
    FROM StandardDatasetAggregationStorage
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = @AggregationTypeId)
      AND (DependentTableInd = 0)

	SET @FullViewName =  QUOTENAME(@SchemaName) + ''.'' +  QUOTENAME(@CoverViewName)
	SET @FullInsertTableName = QUOTENAME(@SchemaName) + ''.'' + QUOTENAME(@InsertTableName)

--------------------------------------------------------------------------------------------------
-- Sanity check for table and view 
--------------------------------------------------------------------------------------------------
    IF @InsertTableName IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Aggregation table does not  exist for provided aggegation type '' + CONVERT(nvarchar(50),@AggregationTypeId) + '' .''
      RAISERROR (@DebugMessage, 16, 1)
	END

    IF @SchemaName IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Schema name is not defined for DataSet Id: '' + CONVERT(nvarchar(50),@DatasetId)  +'' .''
      RAISERROR (@DebugMessage, 16, 1)
	END

    IF @CoverViewName IS NULL
	BEGIN
	  SET @DebugMessage = @DebugPrefix + ''Source view does not exist for  DataSet Id: '' + CONVERT(nvarchar(50),@DatasetId)  +'' .''
      RAISERROR (@DebugMessage, 16, 1)
	END

	IF NOT EXISTS (SELECT * FROM sys.schemas WHERE [name] = @SchemaName)
	BEGIN
	  	  SET @DebugMessage = @DebugPrefix + ''Schema '' + @SchemaName + '' does not exist in the datawarehouse.''
          RAISERROR (@DebugMessage, 16, 1)
	END

	IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @CoverViewName AND TABLE_SCHEMA = @SchemaName)
	BEGIN
	  	  SET @DebugMessage = @DebugPrefix + ''Source view '' + @FullViewName + '' does not exist in the datawarehouse.''
          RAISERROR (@DebugMessage, 16, 1)
	END

	IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @InsertTableName AND TABLE_SCHEMA = @SchemaName)
	BEGIN
	  	  SET @DebugMessage = @DebugPrefix + ''Target table '' + @InsertTableName + '' does not exist in the schema '' + @SchemaName + ''.''
          RAISERROR (@DebugMessage, 16, 1)
	END
-------------------------------------------------------------------------------------------------
-- End of Sanity check for table and view 
--------------------------------------------------------------------------------------------------    
    IF (@DebugLevel &gt; 0)
    BEGIN
      SET @DebugMessage = ''Starting aggregation of type '' + CAST(@AggregationTypeId AS varchar(10)) + '' for interval from ''
                         + CONVERT(varchar(20), @IntervalStartDateTime, 120) + ''UTC to ''
                         + CONVERT(varchar(20), @IntervalEndDateTime, 120) + ''UTC''
      SET @AggregationStartDateTime = GETUTCDATE()
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @DebugMessage
    END
    
	SET @DATEKEY = Year(@IntervalStartDateTime) *10000 + Month(@IntervalStartDateTime)*100 + Day(@IntervalStartDateTime)
	SET @TimeKEY = DATEPART(hour,@IntervalStartDateTime) *10000 + DATEPART(minute,@IntervalStartDateTime)*100 + DATEPART(second,@IntervalStartDateTime)
	SET @InsertStartDateTimeStr = '' CONVERT(datetime, '''''' + CONVERT(varchar(50), @IntervalStartDateTime, 120) + '''''', 120)''
	SET @InsertEndDateTimeStr = '' CONVERT(datetime, '''''' + CONVERT(varchar(50), @IntervalEndDateTime, 120) + '''''', 120)''

	SET @Statement =
        ''INSERT '' + @FullInsertTableName + '' (''
		+ ''  DateKey''                           
		+ ''  ,TimeKey''                           
		+ ''  ,ComputerRowId''                     
		+ ''  ,ProcessRowId''                      
		+ ''  ,ProcessCmdRowId''                   
		+ ''  ,UserRowId''                         
		+ ''  ,PID''                               
		+ ''  ,CpuUsageSampleCount''               
		+ ''  ,CpuUsageAverageValue''              
		+ ''  ,CpuUsageMinValue''                  
		+ ''  ,CpuUsageMaxValue''                 
		+ ''  ,CpuUsageStandardDeviation''         
		+ ''  ,MemoryUsageSampleCount''            
		+ ''  ,MemoryUsageAverageValue''           
		+ ''  ,MemoryUsageMinValue''               
		+ ''  ,MemoryUsageMaxValue''               
		+ ''  ,MemoryUsageStandardDeviation''      
		+ ''  ,HandleCountSampleCount''            
		+ ''  ,HandleCountAverageValue''           
		+ ''  ,HandleCountMinValue''               
		+ ''  ,HandleCountMaxValue''               
		+ ''  ,HandleCountStandardDeviation''      
		+ ''  ,ThreadCountSampleCount''            
		+ ''  ,ThreadCountAverageValue''           
		+ ''  ,ThreadCountMinValue''               
		+ ''  ,ThreadCountMaxValue''               
		+ ''  ,ThreadCountStandardDeviation''      
		+ ''  ,PageFaultCountSampleCount''         
		+ ''  ,PageFaultCountAverageValue''        
		+ ''  ,PageFaultCountMinValue''            
		+ ''  ,PageFaultMaxValue''                 
		+ ''  ,PageFaultCountStandardDeviation''   
		+ ''  ,IOReadPerSecondSampleCount''        
		+ ''  ,IOReadPerSecondAverageValue''       
		+ ''  ,IOReadPerSecondMinValue''           
		+ ''  ,IOReadPerSecondMaxValue''           
		+ ''  ,IOReadPerSecondStandardDeviation''  
		+ ''  ,IOWritePerSecondSampleCount''       
		+ ''  ,IOWritePerSecondAverageValue''      
		+ ''  ,IOWritePerSecondMinValue''          
		+ ''  ,IOWritePerSecondMaxValue''          
		+ ''  ,IOWritePerSecondStandardDeviation'' 
		+ ''  ,CpuTimeSampleCount''                
		+ ''  ,CpuTimeAverageValue''               
		+ ''  ,CpuTimeMaxValue''                   
		+ ''  ,CpuTimeMinValue''                   
		+ ''  ,CpuTimeStandardDeviation''          
		+ ''  ,TotalProcessTimeMaxValue''          
		+ ''  ,DateTime'' 
      + '')''
      + '' SELECT''
      + ''    '' + CONVERT(varchar(50), @DATEKEY)
      + ''    ,'' + CONVERT(varchar(50), @TimeKEY)
	  + ''   ,ComputerRowId''
	  + ''   ,ProcessRowId''
	  + ''   ,ProcessCmdRowId''
	  + ''   ,UserRowId''  
	  + ''   ,PID''        
	  + ''   ,COUNT(*)''
      + ''   ,AVG(CpuUsage)''
      + ''   ,MIN(CpuUsage)''
      + ''   ,MAX(CpuUsage)''
	  + ''   ,ISNULL(STDEV(CpuUsage), 0)''
	  + ''   ,COUNT(*)''
      + ''   ,AVG(MemoryUsage)''
      + ''   ,MIN(MemoryUsage)''
      + ''   ,MAX(MemoryUsage)''
	  + ''   ,ISNULL(STDEV(MemoryUsage), 0)''
	  + ''   ,COUNT(*)''
      + ''   ,AVG(CAST(HandleCount AS float))''
      + ''   ,MIN(HandleCount)''
      + ''   ,MAX(HandleCount)''
	  + ''   ,ISNULL(STDEV(HandleCount), 0)''
	  + ''   ,COUNT(*)''
      + ''   ,AVG(CAST(ThreadCount AS float))''
      + ''   ,MIN(ThreadCount)''
      + ''   ,MAX(ThreadCount)''
	  + ''   ,ISNULL(STDEV(ThreadCount), 0)''
	  + ''   ,COUNT(*)''
      + ''   ,AVG(CAST(PageFaultCount AS float))''
      + ''   ,MIN(PageFaultCount)''
      + ''   ,MAX(PageFaultCount)''
	  + ''   ,ISNULL(STDEV(PageFaultCount), 0)''
	  + ''   ,COUNT(*)''
      + ''   ,AVG(IOReadPerSecond)''
      + ''   ,MIN(IOReadPerSecond)''
      + ''   ,MAX(IOReadPerSecond)''
	  + ''   ,ISNULL(STDEV(IOReadPerSecond), 0)''
	  + ''   ,COUNT(*)''
      + ''   ,AVG(IOWritePerSecond)''
      + ''   ,MIN(IOWritePerSecond)''
      + ''   ,MAX(IOWritePerSecond)''
	  + ''   ,ISNULL(STDEV(IOWritePerSecond), 0)''
	  + ''   ,COUNT(*)''
      + ''   ,AVG(CAST(CpuTime AS float))''
      + ''   ,MIN(CpuTime)''
      + ''   ,MAX(CpuTime)''
	  + ''   ,ISNULL(STDEV(CpuTime), 0)''
	  + ''   ,MAX(TotalProcessTime)''
	  + ''   ,'' + @InsertStartDateTimeStr
      + '' FROM '' + @FullViewName
      + '' WHERE ([DateTime] &gt;= '' + @InsertStartDateTimeStr + '') ''
      + ''   AND ([DateTime] &lt; '' + @InsertEndDateTimeStr  + '') ''
       + '' GROUP BY ComputerRowId, ProcessRowId,ProcessCmdRowId,UserRowId,PID''
      
    EXECUTE (@Statement)

    IF (@DebugLevel &gt; 2)
    BEGIN
      SET @DebugMessage = ''Finished aggregation of type '' + CAST(@AggregationTypeId AS varchar(10)) + '' for interval from ''
                         + CONVERT(varchar(20), @IntervalStartDateTime, 120) + ''UTC to ''
                         + CONVERT(varchar(20), @IntervalEndDateTime, 120) + ''UTC''
      
      DECLARE @OperationDurationMs bigint
      SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @AggregationStartDateTime))
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @DebugMessage
        ,@OperationDurationMs = @OperationDurationMs
    END
  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN

    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
  END CATCH
  
  -- report error if any
  IF (@ErrorInd = 1)
  BEGIN
    IF (@DebugLevel &gt; 0)
    BEGIN
      DECLARE @DebugMessageText nvarchar(max)

      SET @DebugMessageText = N''Failed to build aggregates for process mmonitoring performance data set. Error '' + CAST(@ErrorNumber AS varchar(15))
                      + '', Procedure '' + @ErrorProcedure
                      + '', Line '' + CAST(@ErrorLine AS varchar(15))
                      + '', Message: ''+ @ErrorMessageText

      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @ErrorLevel
        ,@MessageText = @DebugMessageText
    END
      
    DECLARE @AdjustedErrorSeverity int

    SET @AdjustedErrorSeverity = CASE
                                   WHEN @ErrorSeverity &gt; 18 THEN 18
                                   ELSE @ErrorSeverity
                                 END

    RAISERROR (777971002, @AdjustedErrorSeverity, 1
      ,@ErrorNumber
      ,@ErrorSeverity
      ,@ErrorState
      ,@ErrorProcedure
      ,@ErrorLine
      ,@ErrorMessageText
    )
  END

END
'

DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create Aggregation processing stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId = '$Config/DatasetId$'
		,@MessageLevel = @ErrorLevel
		,@MessageText = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Aggregation processing stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	@DatasetId = '$Config/DatasetId$'
	,@MessageLevel = @InfoLevel
	,@MessageText = @DebugMessage

 END
END

Endproc:
GO


GO
------------------------------------------------------------------------------------
-- Create Aggregation delete procedure for Process Monitoring Performance DataSet
------------------------------------------------------------------------------------


DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int
  
SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

SET @DataSetMessage = 'Process Monitoring: Process Performance DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0
----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------


SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create AggregationDelete processing stored procedure.'

EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

SELECT 
	@fullSpName = DeleteAggregationStoredProcedureName
FROM
dbo.StandardDatasetAggregation
WHERE DatasetId = '$Config/DatasetId$'




------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create AggregationDelete processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create AggregationDelete processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create AggregationDelete processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create AggregationDelete processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create AggregationDelete processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END


SET @Statement = 'ALTER PROCEDURE ' + @fullSpName + 
'
   @DatasetId   uniqueidentifier
  ,@AggregationTypeId tinyint
  ,@TableGuid uniqueidentifier
  ,@AggregationDateTime datetime
  ,@RowsDeleted int OUTPUT
AS
BEGIN
  SET NOCOUNT ON

  DECLARE 
     @ErrorInd        bit
    ,@ErrorMessage    nvarchar(4000)
    ,@ErrorNumber     int
    ,@ErrorSeverity   int
    ,@ErrorState      int
    ,@ErrorLine       int
    ,@ErrorProcedure  nvarchar(256)
    ,@ErrorMessageText nvarchar(4000)
	,@ErrorLevel        int
    ,@InfoLevel         int
  
	SET @ErrorLevel   = 3 
	SET @InfoLevel    = 1

    SET @ErrorInd = 0  
   
  DECLARE
     @TableName sysname
    ,@Statement nvarchar(max)
    ,@DebugMessage nvarchar(max)
    ,@DeleteStartedDateTime datetime
    ,@OperationDurationMs bigint
    ,@DebugLevel tinyint
    ,@SchemaName sysname
  
  BEGIN TRY
    SELECT
       @DebugLevel = DebugLevel
      ,@SchemaName = SchemaName
    FROM StandardDataset
    WHERE DatasetId = @DatasetId

    -- there are no dependent tables in state data set
    SELECT @TableName = BaseTableName + ''_'' + REPLACE(CAST(@TableGuid AS varchar(50)), ''-'', '''')
    FROM StandardDatasetAggregationStorage
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = @AggregationTypeId)
      AND (DependentTableInd = 0)

    -- Index hint in the query below ensures that SQL won''t
    -- consider index on DateTime field to be a good source
    -- to find rows to delete - it may happen periodically
    -- if SQL thinks there''s no rows to delete due to
    -- lack of [recently updated] statistics    
    SET @Statement = ''DELETE t'' + 
				   + '' FROM '' + QUOTENAME(@SchemaName) + ''.'' + QUOTENAME(@TableName) + '' t ''
                   + '' WHERE (t.[DateTime] = CONVERT(datetime, '''''' + CONVERT(varchar(50), @AggregationDateTime, 120) + '''''', 120))''

    IF (@DebugLevel &gt; 2)
    BEGIN
      SELECT @DebugMessage = ''Starting delete of existing process monitoring performance aggregated data. Table: '' + @TableName + '', aggregation date: '' + CONVERT(varchar(20), @AggregationDateTime, 120)
      
      SET @DeleteStartedDateTime = GETUTCDATE()
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @DebugMessage
    END
   
    EXECUTE(@Statement)
    
    SET @RowsDeleted = @@ROWCOUNT
  
    IF (@DebugLevel &gt; 2)
    BEGIN
      SELECT @DebugMessage = ''Finished delete of existing process monitoring performance aggregated data. Table: '' + @TableName + '', aggregation date: '' + CONVERT(varchar(20), @AggregationDateTime, 120)
      SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @DeleteStartedDateTime))
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @DebugMessage
        ,@OperationDurationMs = @OperationDurationMs
    END
  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN

    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
  END CATCH
    
  -- report error if any
  IF (@ErrorInd = 1)
  BEGIN
    IF (@DebugLevel &gt; 0)
    BEGIN
      DECLARE @DebugMessageText nvarchar(max)

      SET @DebugMessageText = N''Failed to delete aggregated data for process monitoring performance data set. Error '' + CAST(@ErrorNumber AS varchar(15))
                      + '', Procedure '' + @ErrorProcedure
                      + '', Line '' + CAST(@ErrorLine AS varchar(15))
                      + '', Message: ''+ @ErrorMessageText

      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @ErrorLevel
        ,@MessageText = @ErrorMessageText
    END
 '
 
  SET @Statement = @Statement +     
   'DECLARE @AdjustedErrorSeverity int

    SET @AdjustedErrorSeverity = CASE
                                   WHEN @ErrorSeverity &gt; 18 THEN 18
                                   ELSE @ErrorSeverity
                                 END

    RAISERROR (777971002, @AdjustedErrorSeverity, 1
      ,@ErrorNumber
      ,@ErrorSeverity
      ,@ErrorState
      ,@ErrorProcedure
      ,@ErrorLine
      ,@ErrorMessageText
    )
  END
  
  RETURN @RowsDeleted
END
'

DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create AggregationDelete processing stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId     = '$Config/DatasetId$'
		,@MessageLevel = @ErrorLevel
		,@MessageText  = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'AggregationDelete processing stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	@DatasetId     = '$Config/DatasetId$'
	,@MessageLevel = @InfoLevel
	,@MessageText  = @DebugMessage

 END
END

Endproc:
GO




GO
-------------------------------------------------------------------------
-- Create Grooming procedure for Process Monitoring Performance DataSet
-------------------------------------------------------------------------


DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int
  

SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

SET @DataSetMessage = 'Process Monitoring: Process Performance DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0
----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------


SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure.'

EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

SELECT 
	@fullSpName = GroomStoredProcedureName
FROM
dbo.StandardDatasetAggregation
WHERE DatasetId = '$Config/DatasetId$'


------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END

SET @Statement = 'ALTER PROCEDURE ' + @fullSpName + 
'
   @DatasetId   uniqueidentifier
  ,@AggregationTypeId tinyint
  ,@TableGuid uniqueidentifier
  ,@CutoffDateTime datetime
  ,@MaxRowsToGroom int
  ,@RowsDeleted int OUTPUT
AS
BEGIN
  SET NOCOUNT ON

  DECLARE 
     @ErrorInd        bit
    ,@ErrorMessage    nvarchar(4000)
    ,@ErrorNumber     int
    ,@ErrorSeverity   int
    ,@ErrorState      int
    ,@ErrorLine       int
    ,@ErrorProcedure  nvarchar(256)
    ,@ErrorMessageText nvarchar(4000)
    ,@ErrorLevel        int
    ,@InfoLevel         int
  

	SET @ErrorLevel   = 3 
	SET @InfoLevel    = 1

    SET @ErrorInd = 0
  
  DECLARE
     @TableName sysname
    ,@Statement nvarchar(max)
    ,@DebugLevel tinyint
    ,@SchemaName sysname
  
  BEGIN TRY
    SELECT
       @DebugLevel = DebugLevel
      ,@SchemaName = SchemaName
    FROM StandardDataset
    WHERE DatasetId = @DatasetId

    -- there are no dependent tables in HealthState data set
    SELECT @TableName = BaseTableName + ''_'' + REPLACE(CAST(@TableGuid AS varchar(50)), ''-'', '''')
    FROM StandardDatasetAggregationStorage
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = @AggregationTypeId)
      AND (DependentTableInd = 0)
    
    SET @Statement = ''DELETE TOP ('' + CAST(@MaxRowsToGroom AS varchar(15)) + '')''
                   + '' FROM '' + QUOTENAME(@SchemaName) + ''.'' + QUOTENAME(@TableName)
                   + '' WHERE ([DateTime] &lt; CONVERT(datetime, '''''' + CONVERT(varchar(50), @CutoffDateTime, 120) + '''''', 120))''

    EXECUTE (@Statement)
    SET @RowsDeleted = @@ROWCOUNT
    

  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN

    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
  END CATCH
    
  -- report error if any
  IF (@ErrorInd = 1)
  BEGIN
    IF (@DebugLevel &gt; 0)
    BEGIN
      DECLARE @DebugMessageText nvarchar(max)

      SET @DebugMessageText = N''Failed to groom data for Process Monitoring Performance  data set. Error '' + CAST(@ErrorNumber AS varchar(15))
                      + '', Procedure '' + @ErrorProcedure
                      + '', Line '' + CAST(@ErrorLine AS varchar(15))
                      + '', Message: ''+ @ErrorMessageText

      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @ErrorLevel
        ,@MessageText = @DebugMessageText
    END
      
    DECLARE @AdjustedErrorSeverity int

    SET @AdjustedErrorSeverity = CASE
                                   WHEN @ErrorSeverity &gt; 18 THEN 18
                                   ELSE @ErrorSeverity
                                 END

    RAISERROR (777971002, @AdjustedErrorSeverity, 1
      ,@ErrorNumber
      ,@ErrorSeverity
      ,@ErrorState
      ,@ErrorProcedure
      ,@ErrorLine
      ,@ErrorMessageText
    )
  END
  
  RETURN @RowsDeleted
END
'


DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create Grooming stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId = '$Config/DatasetId$'
		,@MessageLevel = 1
		,@MessageText = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Grooming stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	@DatasetId     = '$Config/DatasetId$'
	,@MessageLevel = @ErrorLevel
	,@MessageText  = @DebugMessage

 END
END

Endproc:
GO




   
--------------------------------------------------------------------------
-- Create Staging procedure for Process Monitoring Performance DataSet
--------------------------------------------------------------------------

GO

DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int
  

SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

SET @DataSetMessage = 'Process Monitoring: Process Performance DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0
----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------


SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure.'

EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel 
			,@MessageText = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@fullSpName = StagingProcessorStoredProcedureName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'




------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END

SET @Statement = 'ALTER PROCEDURE ' +@fullSpName + 
'
   @DatasetId           uniqueidentifier
AS
BEGIN
  SET NOCOUNT ON
  
  DECLARE 
     @ErrorInd        bit
    ,@ErrorMessage    nvarchar(max)
    ,@ErrorNumber     int
    ,@ErrorSeverity   int
    ,@ErrorState      int
    ,@ErrorLine       int
    ,@ErrorProcedure  nvarchar(256)
    ,@ErrorMessageText nvarchar(max)
	,@ErrorLevel        int
	,@InfoLevel         int
  

	SET @ErrorLevel   = 3 
	SET @InfoLevel    = 1

    SET @ErrorInd = 0

 
    DECLARE
       @DebugLevel int
      ,@SchemaName sysname
	  ,@StagingTableName sysname
      ,@ExecResult int
      ,@LockResourceName sysname
      ,@InsertTableName sysname
      ,@InsertTableGuid uniqueidentifier
      ,@InsertStartedDateTime datetime
      ,@Statement nvarchar(max)
      ,@MessageText varchar(max)
      ,@OperationDurationMs bigint
      ,@RawDataMaxAgeDays int
      ,@MaxStagingRowsToProcess int
	  ,@DebugMessageText nvarchar(max)
	  ,@StageSp nvarchar(max)
	  ,@ExecResultDim int
      ,@LockResourceNameDim sysname


	DECLARE 
		@defaultHash nvarchar(64) = ''E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855'';
 
  BEGIN TRY   
    SELECT
       @DebugLevel = DebugLevel
	  ,@SchemaName = SchemaName
	  ,@StageSp    = StagingProcessorStoredProcedureName
    FROM StandardDataset
    WHERE (DatasetId = @DatasetId)


	----------------------------------
	-- Sanity check for datasetId
	----------------------------------
    IF (@StageSp &lt;&gt; '''
	
	SET @Statement = @Statement + @fullSpName + ''')
	BEGIN
	  Goto EndProc
	END

	------------------------------------
	-- Get dataset staging settings
	----------------------------------
	
      SELECT
         @Statement = StagingTableColumnDefinition
        ,@MaxStagingRowsToProcess = ISNULL(MaxRowsToProcessPerTransactionCount,10000)
      FROM StandardDatasetStagingArea
      WHERE DatasetId = @DatasetId


 	  IF (@Statement IS NULL)
	  BEGIN
	    Goto Endproc
	  END


    -- get the minimum data retention period
    -- to make sure we do not re-aggregate something
    -- that is too old and all raw data is gone
    
    SELECT @RawDataMaxAgeDays = MaxDataAgeDays
    FROM StandardDatasetAggregation
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = 0)


	--------------------------------------------------------------------------
	-- Delete old records from staging
	--------------------------------------------------------------------------
    DELETE ' + @SchemaName + '.ProcesStaging
    WHERE (DatasetId = @DatasetId)
      AND ([CollectedDate] &lt; DATEADD(day, -@RawDataMaxAgeDays, GETUTCDATE()) )
    '

     SET @Statement = @Statement + 
'

-------------------------------------------------------
-- Tables Sanity Check
--------------------------------------------------------
			IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ComputerDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ComputerDim table exiting..''
							Goto SanityCheck
				
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''UserDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find UserDim table exiting..''
							Goto SanityCheck
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ProcessDim table exiting..''
							Goto SanityCheck
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessCmdDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ProcessCMdDim table exiting..''
							Goto SanityCheck
			END

			  EXEC dbo.StandardDatasetGetInsertTableGuid @DatasetId, 0, @InsertTableGuid OUTPUT
    
				SELECT @InsertTableName = BaseTableName + ''_'' + REPLACE(CAST(@InsertTableGuid AS varchar(50)), ''-'', '''')
				FROM StandardDatasetAggregationStorage
				WHERE (DatasetId = @DatasetId)
				  AND (AggregationTypeId = 0)
				  AND (DependentTableInd = 0)


			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @InsertTableName AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find '' + @InsertTableName + '' table exiting..''
							Goto SanityCheck
			END

			Goto Staging

SanityCheck:
				EXEC DebugMessageInsert
					@DatasetId = @DatasetId
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessageText

                Goto DeleteWrongDataSet
				 
'
		
	    SET @Statement = @Statement +
	    '

Staging:

    
    IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessStaging2Process'' AND TABLE_SCHEMA = @SchemaName)
    BEGIN
      BEGIN TRAN
        -- need to process subset of rows
        -- create extra column to store original row id
        SELECT @Statement =
              ''CREATE TABLE '' + @SchemaName + ''.ProcessStaging2Process ('' 
            + @Statement
            + '',OriginalProcessStageRowId  bigint  NOT NULL''
            + '')''
  
        EXECUTE (@Statement)
      COMMIT
		'

        SET @Statement = @Statement +
	    '

		IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessStaging2Process'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
        BEGIN
		 Goto Endproc
		END

      BEGIN TRAN

	   INSERT INTO ' + @SchemaName + '.ProcessStaging2Process
		(
		   DatasetId             
		  ,ManagementGroupGuid   
		  ,ManagedEntityGuid     
		  ,CollectedDate     
		  ,DateKey               
		  ,TimeKey               
		  ,ManagedEntityRowId	 
		  ,ComputerRowId         
		  ,ProcessRowId          
		  ,ProcessCmdRowId       
		  ,UserRowId             
		  ,ProcessId             
		  ,CpuUsage              
		  ,MemoryUsage           
		  ,HandleCount           
		  ,ThreadCount           
		  ,PageFaultCount        
		  ,CpuTime               
		  ,TotalProcessTime      
		  ,IOReadPerSecond       
		  ,IOWritePerSecond      
		  ,ProcessName           
		  ,Description           
		  ,CommandLine           
		  ,CommandLineHash       
		  ,UserName              
		  ,DWCreatedDateTime     
		  ,OriginalProcessStageRowId
		)
        SELECT TOP (@MaxStagingRowsToProcess)
			 DatasetId                      
			,ManagementGroupGuid           
			,ManagedEntityGuid             
			,CollectedDate             
			,DateKey                       
			,TimeKey                       
			,ManagedEntityRowId	       
			,ComputerRowId                 
			,ProcessRowId                  
			,ProcessCmdRowId               
			,UserRowId                     
			,ProcessId   
			,CpuUsage              
			,MemoryUsage           
			,HandleCount           
			,ThreadCount           
			,PageFaultCount        
			,CpuTime               
			,TotalProcessTime      
			,IOReadPerSecond       
			,IOWritePerSecond      
			,ProcessName           
			,Description           
			,CommandLine           
			,CommandLineHash       
			,UserName              
			,DWCreatedDateTime
			,ProcessStageRowId
			FROM
			' + @SchemaName + '.ProcesStaging
			WHERE DatasetId = @DatasetId
			ORDER BY CollectedDate
     
      COMMIT
    END -- IF NOT EXISTS ' + @SchemaName + '.ProcessStaging2Process
    
    -- create index on datetime field
    IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = ''IX_ProcessStaging2Process_DateTime'')
    BEGIN
      CREATE INDEX IX_ProcessStaging2Process_DateTime ON ' + @SchemaName + '.ProcessStaging2Process(CollectedDate)
    END

    BEGIN TRAN
 
 -- lock dimension tables  to ensure we insert into dimensions opened for insertion
					SET @LockResourceNameDim = ''ProcessMonitoringDimensions_TableMap''
  
					EXEC @ExecResultDim = sp_getapplock
						   @Resource = @LockResourceNameDim
						  ,@LockMode = ''Exclusive''
						  ,@LockOwner = ''Transaction''
 
				 IF (@ExecResultDim &lt; 0) 
				 BEGIN
				   RETURN
				 END 

		EXEC dbo.StandardDatasetGetInsertTableGuid @DatasetId, 0, @InsertTableGuid OUTPUT
    
		SELECT @InsertTableName = BaseTableName + ''_'' + REPLACE(CAST(@InsertTableGuid AS varchar(50)), ''-'', '''')
		FROM StandardDatasetAggregationStorage
		WHERE (DatasetId = @DatasetId)
		  AND (AggregationTypeId = 0)
		  AND (DependentTableInd = 0)
      

	-------------------------------------------------------------
	-- Updating Dimensions
	--------------------------------------------------------------
			--------------------------------------------------------------
			--Update Computer Dimension
			--------------------------------------------------------------
			--- 2.1 Update Staging Table with ManagedEntityRowId from Microsoft Windows Computer

					UPDATE stage
					 SET 
						ManagedEntityRowid     = me.ManagedEntityRowid
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
							  JOIN vManagementGroup mg ON (stage.ManagementGroupGuid = mg.ManagementGroupGuid)
							  JOIN vManagedEntity me ON ((me.ManagedEntityGuid = stage.ManagedEntityGuid) AND (mg.ManagementGroupRowId = me.ManagementGroupRowId))
 						      JOIN vManagedEntityType met ON (met.ManagedEntityTypeRowId = me.ManagedEntityTypeRowId)
 					 WHERE (stage.DatasetId = @DatasetId) AND ( met.ManagedEntityTypeGuid = ''EA99500D-8D52-FC52-B5A5-10DCD1E9D2BD'')





			---2.2 Insert new Computers in Computer Dimension 

					INSERT INTO ' + @SchemaName + '.ComputerDim
					(
						ManagementEntityRowId
					   ,Name
					   ,NetbiosName
					   ,PrincipalName
					)
					SELECT DISTINCT
						 me.ManagedEntityRowid
						 ,UPPER(me.Name)
						 , CASE CHARINDEX(''.'',me.Name)
						   WHEN 0  THEN UPPER(me.Name)
						   ELSE
							UPPER(LEFT(me.Name,CHARINDEX(''.'',me.Name) - 1))
						   END
						 ,LOWER(me.Name)
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
					JOIN vManagedEntity me ON me.ManagedEntityRowId = stage.ManagedEntityRowId
					WHERE 
					 NOT EXISTS (SELECT *
                      FROM ' + @SchemaName + '.ComputerDim 
                      WHERE (ManagementEntityRowId = me.ManagedEntityRowId)
                     )
					 AND
					 stage.ManagedEntityRowid  &lt;&gt; 0
					 AND
					 me.Name IS NOT NULL


			---2.3 Update Staging with Computer Dimension Key

					UPDATE stage
					 SET 
						ComputerRowId     = pc.ComputerRowid
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
					JOIN ' + @SchemaName + '.ComputerDim pc ON (stage.ManagedEntityRowId = pc.ManagementEntityRowId)	    


			--------------------------------------------------------------
			--Update User Dimension
			--------------------------------------------------------------

			---3.1 Insert new Users in User Dimension 

					INSERT INTO ' + @SchemaName + '.UserDim
					(
						LogonName
					   ,Domain
					   ,UserName
					)
					SELECT DISTINCT
						 UPPER(stage.UserName) 
						 ,UPPER(
								  CASE CHARINDEX(''\'',stage.UserName)
								   WHEN 0  THEN ''''
								   ELSE
									LEFT(stage.UserName,CHARINDEX(''\'',stage.UserName) - 1)
								  END
								)
						 ,UPPER(
								  CASE CHARINDEX(''\'',stage.UserName)
								   WHEN 0  THEN stage.UserName
								   ELSE
									RIGHT(stage.UserName,LEN(stage.UserName)- CHARINDEX(''\'',stage.UserName))
								  END
								)
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.UserDim u ON (ISNULL(stage.UserName,'''') = u.LogonName)
					WHERE 
					u.UserRowid IS NULL
					AND
					stage.ManagedEntityRowid  &lt;&gt; 0

			---3.3 Update Staging with new User Dimension Key
					UPDATE stage
					 SET 
						UserRowId     = u.UserRowid
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
					JOIN ' + @SchemaName + '.UserDim u ON (ISNULL(stage.UserName,'''') = u.LogonName)
					WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0

			--------------------------------------------------------------
			--Update Process Dimension
			--------------------------------------------------------------
			---4.1. Insert new Processes in Process Dimension 

			        ;WITH ProcessByName AS
					(
					  SELECT ProcessName,ISNULL([Description],'''') AS [Description], ROW_NUMBER() OVER(PARTITION BY ProcessName ORDER BY [Description]) as Id
					  FROM 
					  ' + @SchemaName + '.ProcessStaging2Process
					  WHERE
					  ManagedEntityRowid  &lt;&gt; 0
					),
					Processes AS
					(
					  SELECT ProcessName, [Description]
					  FROM ProcessByName
					  WHERE 
					  Id = 1
					)


					INSERT INTO ' + @SchemaName + '.ProcessDim
					(
						 ProcessName
						,[Description]
					)
					SELECT 
						   stage.ProcessName
						  ,stage.[Description] 
					FROM
					Processes stage
					LEFT OUTER JOIN ' + @SchemaName + '.ProcessDim p ON (stage.ProcessName = p.ProcessName)
					WHERE 
					p.ProcessRowId IS NULL

			---4.2. Update Staging with new Process Dimension Key
					UPDATE stage
					 SET 
						ProcessRowId     = p.ProcessRowid
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
					JOIN ' + @SchemaName + '.ProcessDim p ON (stage.ProcessName = p.ProcessName)
                    WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0


			--------------------------------------------------------------
			--Update Process Command Line Dimension
			--------------------------------------------------------------

			---5.1. Insert new Process Command Lines in ProcessCmd Dimension 

					INSERT INTO ' + @SchemaName + '.ProcessCmdDim
					(
						CommandLine
						,CommandLineHash
					)
					SELECT DISTINCT
						  stage.CommandLine
						 ,ISNULL(stage.CommandLineHash, @defaultHash)
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.ProcessCmdDim p ON (ISNULL(stage.CommandLineHash,@defaultHash)  = p.CommandLineHash)
					WHERE 
					p.ProcessCmdRowId IS NULL
					AND
					 stage.ManagedEntityRowid  &lt;&gt; 0

			---5.2. Update Staging with new Process Command Line Dimension Key
					UPDATE stage
					 SET 
						ProcessCmdRowId     = p.ProcessCmdRowid
					FROM
					' + @SchemaName + '.ProcessStaging2Process stage
					JOIN ' + @SchemaName + '.ProcessCmdDim p ON (ISNULL(stage.CommandLineHash,@defaultHash)  = p.CommandLineHash)
					WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0



	    EXEC sp_releaseapplock  @Resource = @LockResourceNameDim 
	  COMMIT

    BEGIN TRAN
	   -- lock table map to ensure we insert into table opened for insertion
    SET @LockResourceName = CAST(@DatasetId AS varchar(50)) + ''_TableMap''
  
    EXEC @ExecResult = sp_getapplock
           @Resource = @LockResourceName
          ,@LockMode = ''Shared''
          ,@LockOwner = ''Transaction''

    IF (@ExecResult &lt; 0)
    BEGIN
      RAISERROR(777971001, 16, 1, ''Shared:StandardDatasetTableMap'', @ExecResult)
    END
	-------------------------------------------------------------------------------------------------
	-- Updating Fact Process Performance Table
	--------------------------------------------------------------------------------------------------

				SET @Statement = 
				''INSERT INTO ['' + @SchemaName + ''].[''+ @InsertTableName +'']
				(
						 DateKey                        
						,TimeKey                        
						,ComputerRowId                  
						,ProcessRowId                   
						,ProcessCmdRowId
						,UserRowId                
						,Pid                            
						,CpuUsage              
						,MemoryUsage           
						,HandleCount           
						,ThreadCount           
						,PageFaultCount        
						,CpuTime               
						,TotalProcessTime      
						,IOReadPerSecond       
						,IOWritePerSecond      
						,[DateTime]
				)
				SELECT
						DateKey                        
						,TimeKey                        
						,ComputerRowId                  
						,ProcessRowId                   
						,ProcessCmdRowId
						,UserRowId                  
						,ProcessId                         
						,CpuUsage              
						,MemoryUsage           
						,HandleCount           
						,ThreadCount           
						,PageFaultCount        
						,CpuTime               
						,TotalProcessTime      
						,IOReadPerSecond       
						,IOWritePerSecond          
						,CollectedDate                  
				FROM 
					' + @SchemaName + '.ProcessStaging2Process
				WHERE
				ManagedEntityRowid  &lt;&gt; 0
				''

				IF (@DebugLevel &gt; 0)
				BEGIN
				  SELECT @MessageText = ''Starting to insert '' + CAST(COUNT(*) AS varchar(30)) + '' process performance samples into '' + @InsertTableName
				  FROM ' + @SchemaName + '.ProcessStaging2Process
      
				  SET @InsertStartedDateTime = GETUTCDATE()
      
				  EXEC DebugMessageInsert
					 @DatasetId = @DatasetId
					,@MessageLevel = @InfoLevel
					,@MessageText = @MessageText
				END
			
				EXEC(@Statement)

			 -- mark existing affected aggregations as dirty
				UPDATE ah
				SET DirtyInd = 1
				   ,DataLastReceivedDateTime = GETUTCDATE()
				FROM StandardDatasetAggregationHistory ah
					  JOIN StandardDatasetAggregation a ON (ah.DatasetId = a.DatasetId AND ah.AggregationTypeId = a.AggregationTypeId)
					  CROSS JOIN ' + @SchemaName + '.ProcessStaging2Process p
				WHERE (ah.DatasetId = @DatasetId)
				  AND (ah.AggregationDateTime &gt; DATEADD(day, -@RawDataMaxAgeDays, GETUTCDATE()))
				  AND (p.[CollectedDate] &gt;= ah.AggregationDateTime)
				  AND (p.[CollectedDate] &lt; DATEADD(minute, a.AggregationIntervalDurationMinutes, ah.AggregationDateTime))

			   -- delete processed rows from staging
               DELETE ps
               FROM ' + @SchemaName + '.ProcesStaging ps
               JOIN ' + @SchemaName + '.ProcessStaging2Process psp ON (ps.ProcessStageRowId  = psp.OriginalProcessStageRowId )
    
				-- delete all inserted data from staging
				DROP TABLE ' + @SchemaName + '.ProcessStaging2Process
				
	    EXEC sp_releaseapplock  @Resource = @LockResourceName 
	COMMIT
    
	IF (@DebugLevel &gt; 0)
    BEGIN
      SET @MessageText = ''Process Monitroing Performance DataSet: Finished inserting performance state samples  into '' + @InsertTableName
      SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @InsertStartedDateTime))
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @MessageText
        ,@OperationDurationMs = @OperationDurationMs
    END

    

  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN
  
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
  END CATCH

  -- report error if any
  IF (@ErrorInd = 1)
  BEGIN
    IF (@DebugLevel &gt; 0)
    BEGIN

      
      SET @DebugMessageText = N''Failed to process data in the Process Monitroing Performance DataSet staging area. Error '' + CAST(@ErrorNumber AS varchar(15))
                      + '', Procedure '' + @ErrorProcedure
                      + '', Line '' + CAST(@ErrorLine AS varchar(15))
                      + '', Message: ''+ @ErrorMessageText

      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @ErrorLevel
        ,@MessageText = @DebugMessageText
    END
      
    DECLARE @AdjustedErrorSeverity int

    SET @AdjustedErrorSeverity = CASE
                                   WHEN @ErrorSeverity &gt; 18 THEN 18
                                   ELSE @ErrorSeverity
                                 END
    
    RAISERROR (777971002, @AdjustedErrorSeverity, 1
      ,@ErrorNumber
      ,@ErrorSeverity
      ,@ErrorState
      ,@ErrorProcedure
      ,@ErrorLine
      ,@ErrorMessageText
    )
  END

DeleteWrongDataSet:
	--------------------------------------------------------------------------
	-- Delete wrong  datasets from staging
	--------------------------------------------------------------------------
	DECLARE
	  @delBatchSize int
	 ,@ErrorIndDel int
	 
	 SET @ErrorIndDel  = 0
	 SET @delBatchSize = @MaxStagingRowsToProcess

	IF (@DebugLevel &gt; 0)
    BEGIN
      SET @MessageText = ''Process Monitroing Performance DataSet: Starting deletion of wrong DataSets records from staging ''
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @MessageText
    END

   SET @InsertStartedDateTime = GETUTCDATE()

	WHILE(1=1)
	BEGIN
	 BEGIN TRY
	     BEGIN TRAN
			DELETE TOP(@delBatchSize) FROM ' + @SchemaName + '.ProcesStaging
			WHERE (DatasetId != @DatasetId)

			IF (@@rowcount &lt; @delBatchSize)
			BEGIN
				COMMIT
				BREAK;
			END
 	     COMMIT

	 END TRY
     BEGIN CATCH
		IF (@@TRANCOUNT &gt; 0)
		  ROLLBACK TRAN
  
		SELECT 
		   @ErrorNumber = ERROR_NUMBER()
		  ,@ErrorSeverity = ERROR_SEVERITY()
		  ,@ErrorState = ERROR_STATE()
		  ,@ErrorLine = ERROR_LINE()
		  ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
		  ,@ErrorMessageText = ERROR_MESSAGE()

		SET @ErrorIndDel = 1
	 END CATCH

	 IF (@ErrorIndDel = 1)
	 BEGIN

			BREAK;
     END --IF
    END --WHILE

	 IF (@ErrorIndDel = 1)
	 BEGIN
			IF (@DebugLevel &gt; 0)
			BEGIN

      
				SET @DebugMessageText = N''Failed to delete  data from wromg dataset in the Process Monitroing Process Performance DataSet staging area. Error '' + CAST(@ErrorNumber AS varchar(15))
								+ '', Procedure '' + @ErrorProcedure
								+ '', Line '' + CAST(@ErrorLine AS varchar(15))
								+ '', Message: ''+ @ErrorMessageText

				EXEC DebugMessageInsert
					@DatasetId = @DatasetId
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessageText
			END
      
			SET @AdjustedErrorSeverity = CASE
											WHEN @ErrorSeverity &gt; 18 THEN 18
											ELSE @ErrorSeverity
											END
    
			RAISERROR (777971002, @AdjustedErrorSeverity, 1
				,@ErrorNumber
				,@ErrorSeverity
				,@ErrorState
				,@ErrorProcedure
				,@ErrorLine
				,@ErrorMessageText
			)

     END
	 ELSE
	 BEGIN
		IF (@DebugLevel &gt; 0)
		BEGIN
		  SET @MessageText = ''Process Monitroing Performance DataSet: Finished deleting wrong dataset records from staging ''
          SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @InsertStartedDateTime))
      
		  EXEC DebugMessageInsert
			 @DatasetId = @DatasetId
			,@MessageLevel = @InfoLevel
			,@MessageText = @MessageText
            ,@OperationDurationMs = @OperationDurationMs

		END

     END --IF
 Endproc:
END  --Procedure [ProcessMonitoring].[PerformanceProcessStaging]
'

DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create stage processing stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId = '$Config/DatasetId$'
		,@MessageLevel = @ErrorLevel
		,@MessageText = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Stage processing stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	@DatasetId     = '$Config/DatasetId$'
	,@MessageLevel = @InfoLevel 
	,@MessageText  = @DebugMessage

 END
END

Endproc:
GO




</Install><Uninstall>
GO

DECLARE
 @TableSchemaName sysname


SELECT 
	@TableSchemaName  = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

-- drop SPs
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME =  'PerformanceFactsAggregate')
	BEGIN
		EXECUTE('DROP PROCEDURE ' + @TableSchemaName + '.PerformanceFactsAggregate')
	END


IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME = 'PerformanceFactsAggregateDelete')
	BEGIN
		EXECUTE ('DROP PROCEDURE ' + @TableSchemaName + '.PerformanceFactsAggregateDelete')
	END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME =  'PerformanceFactsGroom')
	BEGIN
		EXECUTE('DROP PROCEDURE ' + @TableSchemaName + '.PerformanceFactsGroom')
	END


IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME = 'PerformanceProcessStaging')
	BEGIN
		EXECUTE ('DROP PROCEDURE ' + @TableSchemaName + '.PerformanceProcessStaging')
	END


IF  EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'ComputerDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.ComputerDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'UserDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.UserDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'TimeDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.TimeDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'DateDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.DateDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'ProcessDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.ProcessDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'ProcessCmdDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP VIEW ' + @TableSchemaName +'.ProcessCmdDim')
END

IF  EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'ComputerDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.ComputerDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'UserDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.UserDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'TimeDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.TimeDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'DateDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.DateDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'ProcessDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.ProcessDim')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'ProcessCmdDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE ('DROP TABLE ' + @TableSchemaName +'.ProcessCmdDim')
END

-- delete std dataset related data
EXEC StandardDatasetDelete '$Config/DatasetId$'
GO
</Uninstall><Upgrade/></DataWarehouseDataSet><DataWarehouseDataSet ID="Microsoft.Windows.Server.10.0.NetPortsCollection.Dataset" Accessibility="Internal"><Dependencies><DataWarehouseScript>SCDW!Microsoft.SystemCenter.DataWarehouse.Script.DatasetDebuggingSupport</DataWarehouseScript><DataWarehouseScript>SCDW!Microsoft.SystemCenter.DataWarehouse.Script.StandardDatasetSupport</DataWarehouseScript></Dependencies><Configuration><IncludeSchemaTypes><SchemaType>SCDW!Microsoft.SystemCenter.DataWarehouse.StandardDatasetSchema</SchemaType></IncludeSchemaTypes><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="Aggregations" type="AggregationsType"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="RawInsertTableCount" type="xsd:positiveInteger"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="DefaultAggregationIntervalCount" type="xsd:positiveInteger"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="BlockingMaintenanceDailyStartTime" type="TimeOfDayType"/><xsd:element xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="BlockingMaintenanceDurationMinutes" type="xsd:positiveInteger"/></Configuration><Install>

GO
---------------------------------------------------------------
-- Initialize Process Port State Dataset
---------------------------------------------------------------
SET NOCOUNT ON

DECLARE 
        @SchemaName sysname
	   ,@ProcessStagingSp sysname
	   ,@ErrorInd   bit
	   ,@DebugLevel tinyint
	   ,@DebugPrefix  nvarchar(max)
       ,@DebugMessage  nvarchar(max)
	   ,@ErrorLevel      int
	   ,@InfoLevel       int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugLevel   = 0
SET @SchemaName  = 'ProcessMonitoring'
SET @ProcessStagingSp = 'PortStateProcessStaging'

SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
SET @DebugMessage =  @DebugPrefix + ' Insert new definition.'


EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage



BEGIN TRY

	INSERT StandardDataset (
	   DatasetId 
	  ,SchemaName
	  ,DebugLevel
	  ,DefaultAggregationIntervalCount
	  ,RawInsertTableCount
	  ,StagingProcessorStoredProcedureName
	  ,BlockingMaintenanceDailyStartTime
	  ,BlockingMaintenanceDurationMinutes
	)
	VALUES
	(
	   '$Config/DatasetId$'
	  ,@SchemaName
	  ,@DebugLevel
	  ,$Config/DefaultAggregationIntervalCount$
	  ,$Config/RawInsertTableCount$
	  ,@SchemaName + '.' + @ProcessStagingSp
	  ,'$Config/BlockingMaintenanceDailyStartTime$'
	  ,$Config/BlockingMaintenanceDurationMinutes$
	)

	END TRY
	BEGIN CATCH
	 SET @ErrorInd = 1
	END CATCH

	IF (1 = @ErrorInd)
	BEGIN
	    SET @DebugMessage =  @DebugPrefix + 'Insert new definition failed.'

		EXEC DebugMessageInsert
				@DatasetId = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessage

	END
	ELSE
	BEGIN
	    SET @DebugMessage =  @DebugPrefix + ' Insert new definition finished successfully.'

		EXEC DebugMessageInsert
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @InfoLevel
				,@MessageText  = @DebugMessage


	END 
GO
GO



---------------------------------------------------------------------------------------
-- Create the StandardDatasetAggregation for Process Monitoring PortState Fact Tables
----------------------------------------------------------------------------------------

GO
SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugPrefix  nvarchar(max)
  ,@DebugMessage  nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int

SET @ErrorInd     = 0
SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @DebugPrefix  = 'Process Monitoring PortState DataSet: '
SET @DebugMessage = @DebugPrefix  + 'Starting aggregation setting deployment.'

DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText varchar(max)
  ,@BuildAggregationStoredProcedureName  sysname
  ,@DeleteAggregationStoredProcedureName sysname
  ,@GroomStoredProcedureName             sysname
  ,@SchemaName                           sysname

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage
  
BEGIN TRY
  SELECT @SchemaName = SchemaName
  FROM
  dbo.StandardDataSet
  WHERE DatasetId = '$Config/DatasetId$'

  IF @SchemaName IS NULL
  BEGIN
    
   SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was failed. Process Monitoring Health State Dataset does not exist.'
  
   EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage


   RAISERROR( @DebugMessage, 16,1)
  END
  
  SET @BuildAggregationStoredProcedureName  = NULL
  SET @DeleteAggregationStoredProcedureName = NULL
  SET @GroomStoredProcedureName             = @SchemaName + '.' + 'PortStateFactsGroom'
 
  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'

  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0 RAISERROR(777971000, 16, 1, 'Process Monitoring: Health State Aggregation', @ExecResult)

  IF NOT EXISTS (SELECT 1 FROM dbo.StandardDatasetAggregation WHERE  DatasetId = '$Config/DatasetId$' )
  BEGIN
	  INSERT StandardDatasetAggregation
	  (                               
		 DatasetId
		,AggregationTypeId
		,AggregationIntervalDurationMinutes
		,AggregationStartDelayMinutes
		,BuildAggregationStoredProcedureName
		,DeleteAggregationStoredProcedureName
		,GroomStoredProcedureName
		,IndexOptimizationIntervalMinutes
		,MaxDataAgeDays
		,GroomingIntervalMinutes
		,MaxRowsToGroom
		,LastGroomingDateTime
		,DataFileGroupName
		,IndexFileGroupName
	  )
	  SELECT
		 '$Config/DatasetId$'
		,CASE AggregationType
		   WHEN 'Raw' THEN 0
		   WHEN 'Subhourly' THEN 10
		   WHEN 'Hourly' THEN 20
		   WHEN 'Daily' THEN 30
		 END
		,CASE AggregationType
		   WHEN 'Raw' THEN NULL
		   WHEN 'Subhourly' THEN AggregationIntervalDurationMinutes
		   WHEN 'Hourly' THEN 60
		   WHEN 'Daily' THEN 24*60
		 END
		,AggregationStartDelayMinutes
		,@BuildAggregationStoredProcedureName
		,CASE AggregationType
		   WHEN 'Raw' THEN NULL
		   ELSE @DeleteAggregationStoredProcedureName
		 END
		,@GroomStoredProcedureName
		,IndexOptimizationIntervalMinutes
		,MaxDataAgeDays
		,GroomingIntervalMinutes
		,MaxRowsToGroom
		,GETUTCDATE()
		,DataFileGroupName
		,IndexFileGroupName
	  FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
		   AggregationType                    varchar(50)   '@mp:localname'
		  ,MaxTableRowCount                   int
		  ,MaxTableSizeKb                     int
		  ,AggregationStartDelayMinutes       int
		  ,MaxDataAgeDays                     int
		  ,GroomingIntervalMinutes            int
		  ,MaxRowsToGroom                     int
		  ,IndexOptimizationIntervalMinutes   int
		  ,DataFileGroupName                  nvarchar(256)
		  ,IndexFileGroupName                 nvarchar(256)
		  ,AggregationIntervalDurationMinutes int
	  )
  END
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int


  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

 SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was failed. Error: ' + @ErrorMessageText
  
 EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
  
  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix  + 'Aggregation setting deployment was finished successfully.'
  
 EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

END

GO
 


------------------------------------------------------------------------------------------------------------
-- Create the StandardDataset Aggregation Tables definitions for Process Monitoring PortState Fact Tables
------------------------------------------------------------------------------------------------------------

GO


SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage    nvarchar(max)
  ,@DebugPrefix     nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting dataset table definitions deployment.'


DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText nvarchar(max)
  ,@TableCompressionClause nvarchar(max) 

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

  
BEGIN TRY
  SET @TableCompressionClause = ''
  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'

  -----------------------------------------------------------------------
  -- ENBALE PAGE COMPRESSION ON FACT Tables IF AVILABLE
  -----------------------------------------------------------------------
	IF ( 3 = SERVERPROPERTY('EngineEdition') 
		 OR
		 ('SP1' = SERVERPROPERTY('ProductLevel') AND CAST(SERVERPROPERTY('ProductVersion') AS VARCHAR(50)) like '13.0%')
	   )
	BEGIN
	  SET @TableCompressionClause = ' WITH (DATA_COMPRESSION = PAGE)'
	END

  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0 
  BEGIN

	  SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was failed. Cannot parse dataset definition. Xml definition: ' + @XmlDocText
  
	  EXEC DebugMessageInsert
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel 
				,@MessageText  = @DebugMessage

     RAISERROR(777971000, 16, 1, @DebugMessage, @ExecResult)

  END

  INSERT StandardDatasetAggregationStorage
  (                               
     DatasetId
    ,AggregationTypeId
    ,BaseTableName
    ,DependentTableInd
    ,TableTemplate
    ,CoverViewSelectClause
    ,MaxTableRowCount
    ,MaxTableSizeKb 
  )
  SELECT
     '$Config/DatasetId$'
    ,CASE AggregationType
       WHEN 'Raw' THEN 0
     END
    ,BaseTableName
    ,0
    ,CASE AggregationType
       WHEN 'Raw' THEN '
                CREATE TABLE ' + QUOTENAME(d.SchemaName) + '.' + QUOTENAME(BaseTableName + '_$Guid$') + '
                (
                     ' + QUOTENAME(BaseTableName + 'RowId') + ' bigint  NOT NULL  IDENTITY(1, 1)
                    ,DateKey                        int  NOT NULL
                    ,TimeKey                        int  NOT NULL
                    ,ComputerRowId                  int  NOT NULL
                    ,ProcessRowId                   int  NOT NULL
                    ,ProcessCmdRowId                int  NOT NULL
					,UserRowId                      int  NOT NULL
                    ,PID                            int  NOT NULL
		            ,LocalAddressRowId              bigint   NOT NULL
					,RemoteAddressRowId             bigint   NOT NULL
                    ,PortType                       tinyint   NOT NULL
                    ,LocalPort                      int   NOT NULL
					,RemotePort                     int   NOT NULL
					,OldPortState                   tinyint   NOT NULL
					,PortState                      tinyint   NOT NULL
                    ,TimeInOldState                 int   NOT NULL
					,IPV6                           bit   NOT NULL
                    ,[DateTime]                  datetime  NOT NULL
                    ,CONSTRAINT ' + QUOTENAME('PK_' + BaseTableName + '_$Guid$') + ' PRIMARY KEY CLUSTERED ('
                       + QUOTENAME(BaseTableName + 'RowId') + ') ON $DataFileGroupName$
                ) ON $DataFileGroupName$
       ' + @TableCompressionClause
     END
    ,CASE AggregationType
       WHEN 'Raw' THEN '
          SELECT
               DateKey
			  ,TimeKey
	          ,ComputerRowId         
             ,ProcessRowID          
             ,ProcessCmdRowID  
             ,PID 
			 ,UserRowId  
			 ,LocalAddressRowId
			 ,RemoteAddressRowId
			 ,PortType
			 ,LocalPort
			 ,RemotePort                  
             ,OldPortState        
             ,PortState     
             ,TimeInOldState      
			 ,[DateTime]
			 ,IPV6
       '
     END
    ,MaxTableRowCount
    ,MaxTableSizeKb 
  FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
       AggregationType      varchar(50)   '@mp:localname'
      ,BaseTableName        varchar(256)
      ,MaxTableRowCount     int
      ,MaxTableSizeKb       int
      ,DataFileGroupName    varchar(256)
      ,IndexFileGroupName    varchar(256)
  )
      CROSS JOIN StandardDataset d
  WHERE (d.DatasetId = '$Config/DatasetId$' AND AggregationType = 'Raw')
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END
  
   
  SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was failed. Error: ' + @ErrorMessageText
  
  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel 
			,@MessageText  = @DebugMessage

  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )
END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix + 'Dataset table definitions deployment was finished successfully.'
 EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 
END

GO

  ------------------------------------------------------------------------------------------------------------
-- Create Indexes for the StandardDataset Aggregation Tables  for Process MonitoringPortState Fact Tables
------------------------------------------------------------------------------------------------------------

GO
SET NOCOUNT ON

-- create [DateTime] field indexes for all aggregation levels
DECLARE 
   @AggregationTypeId int
  ,@Statement nvarchar(max)
  ,@IndeGuid uniqueidentifier
  ,@ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage      nvarchar(max)
  ,@DebugPrefix       nvarchar(max)
  ,@ErrorLevel        int
  ,@InfoLevel         int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting dataset indexes deployment.'
SET @AggregationTypeId = -1

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 

BEGIN TRY
		WHILE EXISTS (SELECT *
					  FROM StandardDatasetAggregation
					  WHERE (DatasetId = '$Config/DatasetId$')
						AND (AggregationTypeId &gt; @AggregationTypeId)
					 )
		BEGIN
		  SELECT @IndeGuid = NEWID()
  
		  SELECT TOP 1 
			 @AggregationTypeId = AggregationTypeId
			,@Statement = 
			  ' EXEC StandardDatasetIndexDelete'
			+ '    @DatasetId = ''$Config/DatasetId$'''
			+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
			  + '   ,@DeleteIndexOnExistingTablesInd = 0'
			+ ' EXEC StandardDatasetIndexInsert'
			+ '    @DatasetId = ''$Config/DatasetId$'''
			+ '   ,@AggregationTypeId = ' + CAST(AggregationTypeId AS varchar(10))
			+ '   ,@DependentTableInd = 0'
			+ '   ,@TableTag = NULL'
			+ '   ,@UniqueInd = 0'
			+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
			+ '   ,@IndexDefinition = ''([DateTime])'''
			+ '   ,@CreateIndexOnExistingTablesInd = 0'
		  FROM StandardDatasetAggregation
		  WHERE (DatasetId = '$Config/DatasetId$')
			AND (AggregationTypeId &gt; @AggregationTypeId)
		  ORDER BY AggregationTypeId
  
		  EXECUTE (@Statement)
		END


		/* raw indexes for UI widget p*/

		-- Hourly data index to support Top N reports and dashboards
		EXEC StandardDatasetIndexDelete
		   @DatasetId = '$Config/DatasetId$'
		  ,@IndexGuid = '6D30F2F6-82A9-4B38-AFBE-3A1F7A17BA9E'
			,@DeleteIndexOnExistingTablesInd = 0

		EXEC StandardDatasetIndexInsert
			@DatasetId = '$Config/DatasetId$'
		  ,@AggregationTypeId = 0
		  ,@DependentTableInd = 0
		  ,@TableTag = NULL
		  ,@UniqueInd = 0
		  ,@IndexGuid = '6D30F2F6-82A9-4B38-AFBE-3A1F7A17BA9E'
		  ,@IndexDefinition = '(
				 ComputerRowId     
				,ProcessRowId      
				,ProcessCmdRowId   
				,UserRowId         
				,PID               
				,LocalAddressRowId 
				,RemoteAddressRowId               
				,DateTime
			  )
			  INCLUDE
			  (
				 PortType      
				,LocalPort     
				,RemotePort    
				,OldPortState  
				,PortState     
				,TimeInOldState
				,IPV6          
			  )
		  '
		,@CreateIndexOnExistingTablesInd = 0


		-- Index for dashboard
		EXEC StandardDatasetIndexDelete
		   @DatasetId = '$Config/DatasetId$'
		  ,@IndexGuid = 'F747FA4B-577A-4952-B77A-751212594317'
			,@DeleteIndexOnExistingTablesInd = 1

		EXEC StandardDatasetIndexInsert
			@DatasetId = '$Config/DatasetId$'
		  ,@AggregationTypeId = 0
		  ,@DependentTableInd = 0
		  ,@TableTag = NULL
		  ,@UniqueInd = 0
		  ,@IndexGuid = 'F747FA4B-577A-4952-B77A-751212594317'
		  ,@IndexDefinition = '([ComputerRowId] ASC,
	[DateTime])'
		,@CreateIndexOnExistingTablesInd = 1

END TRY
BEGIN CATCH
  SET @ErrorInd = 1

     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

END CATCH

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END
  
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was failed. Error: ' + @ErrorMessageText

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage 

  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was finished successfully.'
  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 
END

GO


------------------------------------------------------------------
--- Create SCHEMA for new Process Monitoring Port State DataSet
-------------------------------------------------------------------

GO
DECLARE 
@SchemaName sysname

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF NOT EXISTS (SELECT * FROM sys.schemas WHERE [name] = @SchemaName)
BEGIN
  EXECUTE('CREATE SCHEMA ' + @SchemaName)
END

 DECLARE @Statement  nvarchar(max)

 -- change schema ownership to allow index rebuild and reorganize

 SET  @Statement = 'ALTER AUTHORIZATION ON SCHEMA::' + @SchemaName + ' TO OpsMgrWriter'
 EXECUTE(@Statement)

 SET  @Statement = 'GRANT ALTER ON SCHEMA::' + @SchemaName + ' TO OpsMgrWriter'
 EXECUTE(@Statement)
 
 -- grant create table permissions
 GRANT CREATE TABLE TO OpsMgrWriter

GO

-----------------------------------------------------------------------
--- Start standard Process Monitoring Port State dataset  deployment
-----------------------------------------------------------------------

SET NOCOUNT ON

DECLARE 
   @ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage    nvarchar(max)
  ,@DebugPrefix     nvarchar(max)
  ,@ErrorLevel      int
  ,@InfoLevel       int
  
SET @ErrorInd     = 0
SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

DECLARE
   @ExecResult int
  ,@XmlDocHandle int
  ,@XmlDocText nvarchar(max)
 
SET @DebugPrefix  =  'Process Monitoring Performance DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting storage deployment.'



EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText = @DebugMessage
			  
BEGIN TRY

  SET @XmlDocText = '&lt;Aggregations&gt;$Config/Aggregations$&lt;/Aggregations&gt;'
  SET @DebugMessage = @DebugPrefix + 'Cannot parse configuration. Text: ' + @XmlDocText

  EXEC @ExecResult = sp_xml_preparedocument @XmlDocHandle OUTPUT, @XmlDocText
  IF @ExecResult &lt;&gt; 0
  BEGIN
          EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText = @DebugMessage
 
   RAISERROR(777971000, 16, 1,@DebugMessage , @ExecResult)
  END

  DECLARE
     @AggregationType varchar(50)
    ,@Statement nvarchar(max)
     
  SET @AggregationType = ''

  WHILE EXISTS (SELECT *
                FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
                      AggregationType      varchar(50)   '@mp:localname')
                WHERE AggregationType &gt; @AggregationType
               )
  BEGIN
    SELECT TOP 1 @AggregationType = AggregationType
    FROM OPENXML(@XmlDocHandle, 'Aggregations/*', 2) WITH (
          AggregationType      varchar(50)   '@mp:localname')
    WHERE AggregationType &gt; @AggregationType
    ORDER BY AggregationType
    
    SET @Statement = 'EXEC StandardDatasetAllocateStorage @DatasetId = ''$Config/DatasetId$'', @AggregationTypeId='
                    + CASE @AggregationType
                        WHEN 'Raw' THEN '0'
                        WHEN 'Subhourly' THEN '10'
                        WHEN 'Hourly' THEN '20'
                        WHEN 'Daily' THEN '30'
                      END
    EXECUTE (@Statement)
  END
END TRY
BEGIN CATCH
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
END CATCH

IF (@XmlDocHandle IS NOT NULL)
  EXEC sp_xml_removedocument @XmlDocHandle

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

  SET @DebugMessage = @DebugPrefix + 'Storage deployment was failed. Error: ' + @ErrorMessageText
  
  EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText = @DebugMessage
  
  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )
END
ELSE
BEGIN
 SET @DebugMessage = @DebugPrefix + 'Storage deployment was finished successfully.' 
 
 EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText = @DebugMessage
END

GO


--------------------------------------------------------------------------------------
--- Start standard Process Monitoring Port State dataset staging tables  deployment
--------------------------------------------------------------------------------------
GO

SET NOCOUNT ON

DECLARE 
   @ErrorInd         bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber      int
  ,@ErrorSeverity    int
  ,@ErrorState       int
  ,@ErrorLine        int
  ,@ErrorProcedure   nvarchar(256)
  ,@Statement        nvarchar(max)
  ,@DebugMessage     nvarchar(max)
  ,@DebugLevel       tinyint
  ,@DebugPrefix      nvarchar(max)
  ,@ErrorLevel       int
  ,@InfoLevel        int
  
  SET @ErrorInd     = 0
  SET @ErrorLevel   = 3 
  SET @InfoLevel    = 1

  SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
  SET @DebugMessage =  @DebugPrefix + ' Create staging table.'


  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

-- insert staging definition into StandardDatasetStagingArea
BEGIN TRY
	-- sometimes SCOM starts this twice...

	BEGIN TRAN

	IF EXISTS (SELECT * FROM StandardDatasetStagingArea WHERE DatasetId = '$Config/DatasetId$')
	BEGIN
	  DELETE StandardDatasetStagingArea
	  WHERE DatasetId = '$Config/DatasetId$'
	END

	INSERT StandardDatasetStagingArea
	(
	   DatasetId
	  ,StagingTableColumnDefinition
	  ,BatchedProcessingSupportedInd
	  ,MaxRowsToProcessPerTransactionCount
	)
	VALUES
	(
	   '$Config/DatasetId$'
	  ,'
	   DatasetId                      uniqueidentifier  NOT NULL
	  ,ManagementGroupGuid            uniqueidentifier  NOT NULL
	  ,ManagedEntityGuid              uniqueidentifier  NOT NULL
	  ,CollectedDate                  datetime          NOT NULL
	  ,DateKey                        int               NOT NULL
	  ,TimeKey                        int               NOT NULL
	  ,ProcessId                      int               NOT NULL
	  ,LocalAddress                   varchar(256)      NULL
	  ,RemoteAddress                  varchar(256)      NULL
	  ,LocalPort                      int               NULL
	  ,RemotePort                     int               NULL
	  ,OldPortState                   tinyint           NOT NULL
	  ,PortState                      tinyint           NOT NULL
          ,TimeInOldState                 int               NOT NULL
	  ,PortType                       tinyint           NOT NULL
	  ,IPV6                           bit               NOT NULL
	  ,ProcessName                    nvarchar(256)     NOT NULL
	  ,Description                    nvarchar(2000)    NULL
	  ,CommandLine                    nvarchar(max)     NULL
	  ,CommandLineHash                varchar(64)       NULL
	  ,UserName                       varchar(256)      NULL   
	  ,ManagedEntityRowId	          int               NULL DEFAULT(0)
	  ,ComputerRowId                  int               NULL DEFAULT(0)
	  ,ProcessRowId                   int               NULL DEFAULT(0)
	  ,ProcessCmdRowId                int               NULL DEFAULT(0)
	  ,UserRowId                      int               NULL DEFAULT(0)
	  ,LocalAddressRowId              bigint            NULL 
	  ,RemoteAddressRowId             bigint            NULL
	  ,DWCreatedDateTime              datetime          NULL DEFAULT (GETUTCDATE())
	  ,PortStageRowId                 bigint            NOT NULL    IDENTITY(1, 1)  PRIMARY KEY
	  '
	  ,1
	  ,100000
	)

	COMMIT

END TRY
BEGIN CATCH

    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN

	SELECT
		@ErrorNumber = ERROR_NUMBER()
		,@ErrorSeverity = ERROR_SEVERITY()
		,@ErrorState = ERROR_STATE()
		,@ErrorLine = ERROR_LINE()
		,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
		,@ErrorMessageText = ERROR_MESSAGE()

	SET @ErrorInd = 1

END CATCH

IF (@ErrorInd = 1)
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
									WHEN @ErrorSeverity &gt; 18 THEN 18
									ELSE @ErrorSeverity
								END

 
			SET @DebugMessage =  @DebugPrefix + 'staging table creation was failed. Error: ' + @ErrorMessageText
  
			EXEC DebugMessageInsert 
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText  = @DebugMessage


	RAISERROR (777971002, @AdjustedErrorSeverity, 1
		,@ErrorNumber
		,@ErrorSeverity
		,@ErrorState
		,@ErrorProcedure
		,@ErrorLine
		,@ErrorMessageText
		)
END
ELSE
BEGIN
    DECLARE 
	@SchemaName sysname
	,@TableName  sysname

	SET @TableName = 'PortStaging'

	SELECT @SchemaName = SchemaName
	FROM
	dbo.StandardDataSet
	WHERE DatasetId = '$Config/DatasetId$'

 BEGIN TRY	
	IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
	BEGIN
        
		SELECT @Statement = StagingTableColumnDefinition
		FROM StandardDatasetStagingArea
		WHERE DatasetId = '$Config/DatasetId$'

	    IF @Statement IS NOT NULL
		BEGIN
		  SELECT @Statement = 'CREATE TABLE ' + @SchemaName + '.' + @TableName +  '(' + @Statement + ')'
		  EXECUTE (@Statement)
		END
		ELSE
		BEGIN
			SET @DebugMessage =  @DebugPrefix + 'Staging Data definition does not exist.'
  
			EXEC DebugMessageInsert 
				@DatasetId     = '$Config/DatasetId$'
				,@MessageLevel = @ErrorLevel
				,@MessageText  = @DebugMessage

		END

	END
 END TRY
 BEGIN CATCH
  	SELECT
		@ErrorNumber = ERROR_NUMBER()
		,@ErrorSeverity = ERROR_SEVERITY()
		,@ErrorState = ERROR_STATE()
		,@ErrorLine = ERROR_LINE()
		,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
		,@ErrorMessageText = ERROR_MESSAGE()

	SET @ErrorInd = 1

	SET @DebugMessage =  @DebugPrefix + 'staging table creation was failed. Error: ' + @ErrorMessageText
  
    EXEC DebugMessageInsert 
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage

 END CATCH

 IF (0 = @ErrorInd)
 BEGIN
  SET @DebugMessage =  @DebugPrefix + 'staging table created successfully. '

  EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

 END 
END


GO


GO

DECLARE 
@SchemaName sysname
,@TableName sysname
,@Statement nvarchar(max)

SET @TableName = 'IpAddressDim'

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Port State Dataset SCHEMA  is not defined. Cannot create dimension tables.', 16,1)
  GOTO Endproc
END


IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  SET @Statement =
	'CREATE TABLE ' + @SchemaName + '.' + @TableName + 
	'(                               
			IpAddressRowId                bigint           NOT NULL IDENTITY(1,1)
			,IpAddress                    varchar(256) NOT NULL
			,DWCreatedDateTime            datetime NOT NULL    DEFAULT (GETUTCDATE())
 
			,CONSTRAINT PK_' + @TableName +'IpAddressDim PRIMARY KEY CLUSTERED (IpAddressRowId)
	)'

	EXECUTE(@Statement)

	SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_LastReceivedDateTime ON ' + @SchemaName + '.' + @TableName + ' (DWCreatedDateTime)'

    EXECUTE(@Statement)

    SET @Statement =
	'CREATE INDEX  IX_' + @TableName + '_IpAddress ON ' + @SchemaName + '.' + @TableName + ' (IpAddress)'

    EXECUTE(@Statement)

	
	SET @Statement =
	'INSERT INTO ' + @SchemaName + '.' + @TableName + 
     '(IpAddress)
	 SELECT N''''
	 '

	EXECUTE(@Statement)

	EXEC DomainTableRegisterIndexOptimization
		   @TableName = @TableName
		  ,@SchemaName = @SchemaName
		  ,@DatasetId = '$Config/DatasetId$'

END


Endproc:
GO


GO
DECLARE 
@SchemaName sysname
,@TableName sysname
,@ViewName  sysname
,@Statement nvarchar(max)

SET @TableName = 'IpAddressDim'
SET @ViewName  = 'v' + @TableName

SELECT @SchemaName = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

IF @SchemaName IS NULL 
BEGIN
  RAISERROR('Process Monitoring Port State Dataset SCHEMA  is not defined. Cannot create dimension views.', 16,1)
  GOTO Endproc
END



IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = @ViewName AND TABLE_SCHEMA = @SchemaName)
BEGIN
  EXECUTE ('CREATE VIEW ' + @SchemaName + '.' + @ViewName + ' AS SELECT A = 1')
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TableName AND TABLE_SCHEMA = @SchemaName)
BEGIN

	SET @Statement = ' ALTER VIEW '  + @SchemaName + '.' + @ViewName + 
	'
	AS
	  SELECT 
		  IpAddressRowId          
		  ,IpAddress         
		  ,DWCreatedDateTime 
  	  FROM ' + @SchemaName + '.' + @TableName + ' (NOLOCK)'

	EXECUTE(@Statement)
	EXECUTE('GRANT SELECT ON ' + @SchemaName + '.' + @ViewName + '  TO OpsMgrReader')
END


Endproc:
GO





GO
-------------------------------------------------------------------------
-- Create Grooming procedure for Process Monitoring Port State DataSet
-------------------------------------------------------------------------


DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int
  

SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

SET @DataSetMessage = 'Process Monitoring: Process Port State DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0

SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure.'


----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------

EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

SELECT 
	@fullSpName = GroomStoredProcedureName
FROM
dbo.StandardDatasetAggregation
WHERE DatasetId = '$Config/DatasetId$'




------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create Grooming stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END


SET @Statement = 'ALTER PROCEDURE ' + @fullSpName + 
'
   @DatasetId   uniqueidentifier
  ,@AggregationTypeId tinyint
  ,@TableGuid uniqueidentifier
  ,@CutoffDateTime datetime
  ,@MaxRowsToGroom int
  ,@RowsDeleted int OUTPUT
AS
BEGIN
  SET NOCOUNT ON

  DECLARE 
     @ErrorInd        bit
    ,@ErrorMessage    nvarchar(4000)
    ,@ErrorNumber     int
    ,@ErrorSeverity   int
    ,@ErrorState      int
    ,@ErrorLine       int
    ,@ErrorProcedure  nvarchar(256)
    ,@ErrorMessageText nvarchar(4000)
	,@ErrorLevel      int

  SET @ErrorInd   = 0
  SET @ErrorLevel = 0
  
  DECLARE
     @TableName sysname
    ,@Statement nvarchar(max)
    ,@DebugLevel tinyint
    ,@SchemaName sysname
  
  BEGIN TRY
    SELECT
       @DebugLevel = DebugLevel
      ,@SchemaName = SchemaName
    FROM StandardDataset
    WHERE DatasetId = @DatasetId

    -- there are no dependent tables in PortState data set
    SELECT @TableName = BaseTableName + ''_'' + REPLACE(CAST(@TableGuid AS varchar(50)), ''-'', '''')
    FROM StandardDatasetAggregationStorage
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = @AggregationTypeId)
      AND (DependentTableInd = 0)
    
    SET @Statement = ''DELETE TOP ('' + CAST(@MaxRowsToGroom AS varchar(15)) + '')''
                   + '' FROM '' + QUOTENAME(@SchemaName) + ''.'' + QUOTENAME(@TableName)
                   + '' WHERE ([DateTime] &lt; CONVERT(datetime, '''''' + CONVERT(varchar(50), @CutoffDateTime, 120) + '''''', 120))''

    EXECUTE (@Statement)
    SET @RowsDeleted = @@ROWCOUNT
    

  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN

    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
  END CATCH
    
  -- report error if any
  IF (@ErrorInd = 1)
  BEGIN
    IF (@DebugLevel &gt; 0)
    BEGIN
      DECLARE @DebugMessageText nvarchar(max)

      SET @DebugMessageText = N''Failed to groom data for Process Monitoring Port State  data set. Error '' + CAST(@ErrorNumber AS varchar(15))
                      + '', Procedure '' + @ErrorProcedure
                      + '', Line '' + CAST(@ErrorLine AS varchar(15))
                      + '', Message: ''+ @ErrorMessageText

      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @ErrorLevel
        ,@MessageText = @DebugMessageText
    END
      
    DECLARE @AdjustedErrorSeverity int

    SET @AdjustedErrorSeverity = CASE
                                   WHEN @ErrorSeverity &gt; 18 THEN 18
                                   ELSE @ErrorSeverity
                                 END

    RAISERROR (777971002, @AdjustedErrorSeverity, 1
      ,@ErrorNumber
      ,@ErrorSeverity
      ,@ErrorState
      ,@ErrorProcedure
      ,@ErrorLine
      ,@ErrorMessageText
    )
  END
  
  RETURN @RowsDeleted
END
'
DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create Grooming stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId     = '$Config/DatasetId$'
		,@MessageLevel = @ErrorLevel
		,@MessageText  = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Grooming stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	@DatasetId     = '$Config/DatasetId$'
	,@MessageLevel = @InfoLevel
	,@MessageText  = @DebugMessage

 END
END

Endproc:
GO
 
--------------------------------------------------------------------------
-- Create Staging procedure for Process Monitoring Port State DataSet
--------------------------------------------------------------------------

GO




DECLARE
 @SchemaName        sysname
,@TableSchemaName   sysname
,@defaultSchemaName sysname
,@spName            sysname
,@fullSpName        sysname
,@Statement         nvarchar(max)
,@DataSetMessage    nvarchar(max)
,@DebugPrefix       nvarchar(max)
,@DebugMessage      nvarchar(max)
,@index             int
,@spLength          int
,@DebugLevel        tinyint
,@ErrorLevel        int
,@InfoLevel         int
  

SET @ErrorLevel   = 3 
SET @InfoLevel    = 1

SET @DataSetMessage = 'Process Monitoring: Process Port State DataSet'
SET @defaultSchemaName = 'dbo'
SET @index = 0
SET @spLength = 0
----------------------------------------------------------------------------------
--- 0 - Logging disabled
--- 1 - Informational
--- 2 - Warning
--- 3 - Error
-----------------------------------------------------------------------------------


SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure.'

EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel =  @InfoLevel
			,@MessageText  = @DebugMessage

SELECT 
	 @TableSchemaName  = SchemaName
	,@fullSpName = StagingProcessorStoredProcedureName
	,@DebugLevel = DebugLevel
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'




------------------------------------------------------------------------------------------------
-- Check if ETL procedure is defined in dataset
------------------------------------------------------------------------------------------------
IF @TableSchemaName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END

IF @fullSpName IS NULL
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END


  GOTO Endproc
END
ELSE
BEGIN
     SET @index    =  CHARINDEX('.',@fullSpName)  
     SET @spLength = LEN(@fullSpName)
	 --------------------------------------------------------------
	 -- if procedure does not have schema name use dbo by default 
	 --------------------------------------------------------------
     IF (0 = @index)
	 BEGIN
	   SET @SchemaName = @defaultSchemaName
	   SET @spName     = @fullSpName
	   SET @fullSpName = @SchemaName + '.' + @fullSpName
	 END
	 ELSE
	 BEGIN
	     IF (1 = @index)
		 BEGIN
		   SET @SchemaName = @defaultSchemaName
		 END
		 ELSE
		 BEGIN
		   SET @SchemaName = LEFT(@fullSpName,@index - 1)
		 END

		 SET @spname     = LTRIM(RTRIM(RIGHT(@fullSpName,@spLength - @index)))
	     	 
		 IF (0 = LEN(@spname) )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not defined', 16, 1, @DataSetMessage )

			  IF @DebugLevel &gt; 0 
			  BEGIN

				SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not defined.'
   
				EXEC DebugMessageInsert
						@DatasetId     = '$Config/DatasetId$'
						,@MessageLevel = @ErrorLevel
						,@MessageText  = @DebugMessage
   
			  END

   	       GOTO Endproc

		 END

		 IF (CHARINDEX('.',@spName) &gt; 0 )
		 BEGIN
		   RAISERROR ('Cannot create ETL stored procedure for %s. Stored procedure name is not correct [%s]', 16, 1, @DataSetMessage,@fullSpName)

			IF @DebugLevel &gt; 0 
			BEGIN

			  SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Stored procedure name is not correct.'
   
			  EXEC DebugMessageInsert
					@DatasetId     = '$Config/DatasetId$'
					,@MessageLevel = @ErrorLevel
					,@MessageText  = @DebugMessage
   
			END

   	       GOTO Endproc

		 END

		 SET @fullSpName = @SchemaName + '.' + @spName
	 END

END

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE NAME = @SchemaName)
BEGIN
  RAISERROR ('Cannot create ETL stored procedure for %s. Dataset schema %s is not exist.', 16, 1, @DataSetMessage,@SchemaName )

  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Trying to create stage processing stored procedure. Cannot create ETL stored procedure. Dataset schema is not exist.'
   
    EXEC DebugMessageInsert
			@DatasetId     = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage
   
  END

  GOTO Endproc
END


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @SchemaName AND ROUTINE_NAME = @spName)
BEGIN
		EXECUTE ('CREATE PROCEDURE ' + @fullSpName +  ' AS RETURN 1')
END

SET @Statement = 'ALTER PROCEDURE ' +@fullSpName + 
'
   @DatasetId           uniqueidentifier
AS
BEGIN
  SET NOCOUNT ON
  
  DECLARE 
     @ErrorInd        bit
    ,@ErrorMessage    nvarchar(max)
    ,@ErrorNumber     int
    ,@ErrorSeverity   int
    ,@ErrorState      int
    ,@ErrorLine       int
    ,@ErrorProcedure  nvarchar(256)
    ,@ErrorMessageText nvarchar(max)
    ,@ErrorLevel        int
    ,@InfoLevel         int
  

    SET @ErrorLevel   = 3 
    SET @InfoLevel    = 1
    SET @ErrorInd = 0

 
    DECLARE
       @DebugLevel int
      ,@SchemaName sysname
	  ,@StagingTableName sysname
      ,@ExecResult int
      ,@LockResourceName sysname
      ,@InsertTableName sysname
      ,@InsertTableGuid uniqueidentifier
      ,@InsertStartedDateTime datetime
      ,@Statement nvarchar(max)
      ,@MessageText varchar(max)
      ,@OperationDurationMs bigint
      ,@RawDataMaxAgeDays int
      ,@MaxStagingRowsToProcess int
      ,@DebugMessageText nvarchar(max)
	  ,@StageSp nvarchar(max)
	  ,@ExecResultDim int
      ,@LockResourceNameDim sysname

	DECLARE 
		@defaultHash nvarchar(64) = ''E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855'';
 
  BEGIN TRY   
     SELECT
       @DebugLevel = DebugLevel
	  ,@SchemaName = SchemaName
	  ,@StageSp    = StagingProcessorStoredProcedureName
    FROM StandardDataset
    WHERE (DatasetId = @DatasetId)


	----------------------------------
	-- Sanity check for datasetId
	----------------------------------
	IF (@StageSp &lt;&gt; '''
	
	SET @Statement = @Statement + @fullSpName + ''')
	BEGIN
	  Goto EndProc
	END

	------------------------------------
	-- Get dataset staging settings
	----------------------------------
	
      SELECT
         @Statement = StagingTableColumnDefinition
        ,@MaxStagingRowsToProcess = ISNULL(MaxRowsToProcessPerTransactionCount,10000)
      FROM StandardDatasetStagingArea
      WHERE DatasetId = @DatasetId

 	  IF (@Statement IS NULL)
	  BEGIN
	    Goto Endproc
	  END


    -- get the minimum data retention period
    -- to make sure we do not re-aggregate something
    -- that is too old and all raw data is gone
    
    SELECT @RawDataMaxAgeDays = MaxDataAgeDays
    FROM StandardDatasetAggregation
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = 0)


	--------------------------------------------------------------------------
	-- Delete old records from staging
	--------------------------------------------------------------------------
    DELETE ' + @SchemaName + '.ProcesStaging
    WHERE (DatasetId = @DatasetId)
      AND ([CollectedDate] &lt; DATEADD(day, -@RawDataMaxAgeDays, GETUTCDATE()) )
    '

     SET @Statement = @Statement + 
'

-------------------------------------------------------
-- Tables Sanity Check
--------------------------------------------------------
			IF  NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ComputerDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ComputerDim table exiting..''
							Goto SanityCheck
				
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''UserDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find UserDim table exiting..''
							Goto SanityCheck
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ProcessDim table exiting..''
							Goto SanityCheck
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''ProcessCmdDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find ProcessCMdDim table exiting..''
							Goto SanityCheck
			END

			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''IpAddressDim'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find IpAddressDim table exiting..''
							Goto SanityCheck
			END

			  EXEC dbo.StandardDatasetGetInsertTableGuid @DatasetId, 0, @InsertTableGuid OUTPUT
    
				SELECT @InsertTableName = BaseTableName + ''_'' + REPLACE(CAST(@InsertTableGuid AS varchar(50)), ''-'', '''')
				FROM StandardDatasetAggregationStorage
				WHERE (DatasetId = @DatasetId)
				  AND (AggregationTypeId = 0)
				  AND (DependentTableInd = 0)


			IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @InsertTableName AND TABLE_SCHEMA = ''' + @SchemaName + ''')
			BEGIN
							SET @DebugMessageText = N''Cannot find '' + @InsertTableName + '' table exiting..''
							Goto SanityCheck
			END

			Goto Staging

SanityCheck:
				EXEC DebugMessageInsert
					@DatasetId = @DatasetId
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessageText

                Goto DeleteWrongDataSet
				 
'
		
	    SET @Statement = @Statement +
	    '

Staging:


    
    IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''PortStaging2Process'' AND TABLE_SCHEMA = @SchemaName)
    BEGIN
      BEGIN TRAN
        -- need to process subset of rows
        -- create extra column to store original row id

		 SELECT @Statement =
              ''CREATE TABLE '' + @SchemaName + ''.PortStaging2Process ('' 
            + @Statement
            + '',OriginalPortStageRowId  bigint  NOT NULL''
            + '')''
        EXECUTE (@Statement)
	  COMMIT

		'
      
	    SET @Statement = @Statement + 
	    '

		IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ''PortStaging2Process'' AND TABLE_SCHEMA = ''' + @SchemaName + ''')
        BEGIN
		 Goto Endproc
		END

      BEGIN TRAN

	    INSERT INTO ' + @SchemaName + '.PortStaging2Process
		(
		   DatasetId                    
		  ,ManagementGroupGuid          
		  ,ManagedEntityGuid            
		  ,CollectedDate                
		  ,DateKey                      
		  ,TimeKey                      
		  ,ManagedEntityRowId	        
		  ,ComputerRowId                
		  ,ProcessRowId                 
		  ,ProcessCmdRowId              
		  ,UserRowId                    
		  ,ProcessId                    
		  ,LocalAddress                 
		  ,RemoteAddress                
		  ,LocalPort                    
		  ,RemotePort                   
		  ,OldPortState                 
		  ,PortState                    
		  ,TimeInOldState  
		  ,PortType  
		  ,IPV6            
		  ,ProcessName                  
		  ,Description                  
		  ,CommandLine                  
		  ,CommandLineHash              
		  ,UserName                     
		  ,DWCreatedDateTime            
 		  ,OriginalPortStageRowId
		)
        SELECT TOP (@MaxStagingRowsToProcess)
		   DatasetId                    
		  ,ManagementGroupGuid          
		  ,ManagedEntityGuid            
		  ,CollectedDate                
		  ,DateKey                      
		  ,TimeKey                      
		  ,ManagedEntityRowId	        
		  ,ComputerRowId                
		  ,ProcessRowId                 
		  ,ProcessCmdRowId              
		  ,UserRowId                    
		  ,ProcessId                    
		  ,LocalAddress                 
		  ,RemoteAddress                
		  ,LocalPort                    
		  ,RemotePort                   
		  ,OldPortState                 
		  ,PortState                    
		  ,TimeInOldState               
		  ,PortType  
		  ,IPV6                 
		  ,ProcessName 
		  ,[Description]                  
		  ,CommandLine                  
		  ,CommandLineHash              
		  ,UserName                     
		  ,DWCreatedDateTime            
 		  ,PortStageRowId
		 FROM
			' + @SchemaName + '.PortStaging
		 WHERE DatasetId = @DatasetId
		 ORDER BY CollectedDate

   
      COMMIT
    END 
    
    -- create index on datetime field
    IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = ''IX_PortStaging2Process_DateTime'')
    BEGIN
      CREATE INDEX IX_PortStaging2Process_DateTime ON ' + @SchemaName + '.PortStaging2Process(CollectedDate)
    END

    BEGIN TRAN

 -- lock dimension tables  to ensure we insert into dimensions opened for insertion
					SET @LockResourceNameDim = ''ProcessMonitoringDimensions_TableMap''
  
					EXEC @ExecResultDim = sp_getapplock
						   @Resource = @LockResourceNameDim
						  ,@LockMode = ''Exclusive''
						  ,@LockOwner = ''Transaction''
 
				 IF (@ExecResultDim &lt; 0) 
				 BEGIN
				   RETURN
				 END 
   
    
    -- get the minimum data retention period
    -- to make sure we do not re-aggregate something
    -- that is too old and all raw data is gone
    
    SELECT @RawDataMaxAgeDays = MaxDataAgeDays
    FROM StandardDatasetAggregation
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = 0)

  
    EXEC dbo.StandardDatasetGetInsertTableGuid @DatasetId, 0, @InsertTableGuid OUTPUT
    
    SELECT @InsertTableName = BaseTableName + ''_'' + REPLACE(CAST(@InsertTableGuid AS varchar(50)), ''-'', '''')
    FROM StandardDatasetAggregationStorage
    WHERE (DatasetId = @DatasetId)
      AND (AggregationTypeId = 0)
      AND (DependentTableInd = 0)
      
	--------------------------------------------------------------------------
	-- Delete old records from staging
	--------------------------------------------------------------------------
    DELETE ' + @SchemaName + '.PortStaging
    WHERE (DatasetId = @DatasetId)
      AND ([CollectedDate] &lt; DATEADD(day, -@RawDataMaxAgeDays, GETUTCDATE()) )
	-------------------------------------------------------------
	-- Updating Dimensions
	--------------------------------------------------------------

			--------------------------------------------------------------
			--Update Computer Dimension
			--------------------------------------------------------------
			--- 2.1 Update Staging Table with ManagedEntityRowId from Microsoft Windows Computer

					UPDATE stage
					 SET 
						ManagedEntityRowid     = me.ManagedEntityRowid
					FROM
					' + @SchemaName + '.PortStaging2Process stage
							  JOIN vManagementGroup mg ON (stage.ManagementGroupGuid = mg.ManagementGroupGuid)
							  JOIN vManagedEntity me ON ((me.ManagedEntityGuid = stage.ManagedEntityGuid) AND (mg.ManagementGroupRowId = me.ManagementGroupRowId))
 						      JOIN vManagedEntityType met ON (met.ManagedEntityTypeRowId = me.ManagedEntityTypeRowId)
 					 WHERE (stage.DatasetId = @DatasetId) AND ( met.ManagedEntityTypeGuid = ''EA99500D-8D52-FC52-B5A5-10DCD1E9D2BD'')





			---2.2 Insert new Computers in Computer Dimension 

					INSERT INTO ' + @SchemaName + '.ComputerDim
					(
						ManagementEntityRowId
					   ,Name
					   ,NetbiosName
					   ,PrincipalName
					)
					SELECT DISTINCT
						 me.ManagedEntityRowid
						 ,UPPER(me.Name)
						 , CASE CHARINDEX(''.'',me.Name)
						   WHEN 0  THEN UPPER(me.Name)
						   ELSE
							UPPER(LEFT(me.Name,CHARINDEX(''.'',me.Name) - 1))
						   END
						 ,LOWER(me.Name)
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					JOIN vManagedEntity me ON me.ManagedEntityRowId = stage.ManagedEntityRowId
					WHERE 
					 NOT EXISTS (SELECT *
                      FROM ' + @SchemaName + '.ComputerDim 
                      WHERE (ManagementEntityRowId = me.ManagedEntityRowId)
                     )
					 AND
					 stage.ManagedEntityRowid  &lt;&gt; 0
					 AND
					 me.Name IS NOT NULL


			---2.3 Update Staging with Computer Dimension Key

					UPDATE stage
					 SET 
						ComputerRowId     = pc.ComputerRowid
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					JOIN ' + @SchemaName + '.ComputerDim pc ON (stage.ManagedEntityRowId = pc.ManagementEntityRowId)	    

			--------------------------------------------------------------
			--Update User Dimension
			--------------------------------------------------------------

			---3.1 Insert new Users in User Dimension 

					INSERT INTO ' + @SchemaName + '.UserDim
					(
						LogonName
					   ,Domain
					   ,UserName
					)
					SELECT DISTINCT
						 UPPER(stage.UserName) 
						 ,UPPER(
								  CASE CHARINDEX(''\'',stage.UserName)
								   WHEN 0  THEN ''''
								   ELSE
									LEFT(stage.UserName,CHARINDEX(''\'',stage.UserName) - 1)
								  END
								)
						 ,UPPER(
								  CASE CHARINDEX(''\'',stage.UserName)
								   WHEN 0  THEN stage.UserName
								   ELSE
									RIGHT(stage.UserName,LEN(stage.UserName)- CHARINDEX(''\'',stage.UserName))
								  END
								)
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.UserDim u ON (ISNULL(stage.UserName,'''') = u.LogonName)
					WHERE 
					u.UserRowid IS NULL
					AND
					stage.ManagedEntityRowid  &lt;&gt; 0

			---3.3 Update Staging with new User Dimension Key
					UPDATE stage
					 SET 
						UserRowId     = u.UserRowid
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					JOIN ' + @SchemaName + '.UserDim u ON (ISNULL(stage.UserName,'''') = u.LogonName)
					WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0

			--------------------------------------------------------------
			--Update Process Dimension
			--------------------------------------------------------------
			---4.1. Insert new Processes in Process Dimension 

			        ;WITH ProcessByName AS
					(
					  SELECT ProcessName,ISNULL([Description],'''') AS [Description], ROW_NUMBER() OVER(PARTITION BY ProcessName ORDER BY [Description]) as Id
					  FROM 
					  ' + @SchemaName + '.PortStaging2Process
					  WHERE
					  ManagedEntityRowid  &lt;&gt; 0
					),
					Processes AS
					(
					  SELECT ProcessName, [Description]
					  FROM ProcessByName
					  WHERE 
					  Id = 1
					)


					INSERT INTO ' + @SchemaName + '.ProcessDim
					(
						 ProcessName
						,[Description]
					)
					SELECT 
						   stage.ProcessName
						  ,stage.[Description] 
					FROM
					Processes stage
					LEFT OUTER JOIN ' + @SchemaName + '.ProcessDim p ON (stage.ProcessName = p.ProcessName)
					WHERE 
					p.ProcessRowId IS NULL

			---4.2. Update Staging with new Process Dimension Key
					UPDATE stage
					 SET 
						ProcessRowId     = p.ProcessRowid
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					JOIN ' + @SchemaName + '.ProcessDim p ON (stage.ProcessName = p.ProcessName)
                    WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0


			--------------------------------------------------------------
			--Update Process Command Line Dimension
			--------------------------------------------------------------

			---5.1. Insert new Process Command Lines in ProcessCmd Dimension 

					INSERT INTO ' + @SchemaName + '.ProcessCmdDim
					(
						CommandLine
						,CommandLineHash
					)
					SELECT DISTINCT
						  stage.CommandLine
						 ,ISNULL(stage.CommandLineHash, @defaultHash)
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.ProcessCmdDim p ON (ISNULL(stage.CommandLineHash,@defaultHash)  = p.CommandLineHash)
					WHERE 
					p.ProcessCmdRowId IS NULL
					AND
					 stage.ManagedEntityRowid  &lt;&gt; 0

			---5.2. Update Staging with new Process Command Line Dimension Key
					UPDATE stage
					 SET 
						ProcessCmdRowId     = p.ProcessCmdRowid
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					JOIN ' + @SchemaName + '.ProcessCmdDim p ON (ISNULL(stage.CommandLineHash,@defaultHash)  = p.CommandLineHash)
					WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0
					 
	    EXEC sp_releaseapplock  @Resource = @LockResourceNameDim 
	  COMMIT

	  ----------------------------------------------------------------------
	  --Update Address dimension
	  ----------------------------------------------------------------------

	  BEGIN TRAN
	        INSERT INTO ' + @SchemaName + '.IpAddressDim
					(
						IpAddress
					)
					SELECT DISTINCT
						  stage.LocalAddress
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.IpAddressDim i ON (ISNULL(stage.LocalAddress,'''') = i.IpAddress)
					WHERE 
					i.IpAddressRowId IS NULL
					AND
					 stage.ManagedEntityRowid  &lt;&gt; 0


	        INSERT INTO ' + @SchemaName + '.IpAddressDim
					(
						IpAddress
					)
					SELECT DISTINCT
						  stage.RemoteAddress
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					LEFT OUTER JOIN ' + @SchemaName + '.IpAddressDim i ON (ISNULL(stage.RemoteAddress,'''') = i.IpAddress)
					WHERE 
					i.IpAddressRowId IS NULL
					AND
					 stage.ManagedEntityRowid  &lt;&gt; 0

					UPDATE stage
					 SET 
						LocalAddressRowId      = i.IpAddressRowid
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					JOIN ' + @SchemaName + '.IpAddressDim i ON (ISNULL(stage.LocalAddress,'''') = i.IpAddress)
                    WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0

					UPDATE stage
					 SET 
						RemoteAddressRowId      = i.IpAddressRowid
					FROM
					' + @SchemaName + '.PortStaging2Process stage
					JOIN ' + @SchemaName + '.IpAddressDim i ON (ISNULL(stage.RemoteAddress,'''') = i.IpAddress)
					WHERE
					 stage.ManagedEntityRowid  &lt;&gt; 0


	  COMMIT

    BEGIN TRAN
	   -- lock table map to ensure we insert into table opened for insertion
    SET @LockResourceName = CAST(@DatasetId AS varchar(50)) + ''_TableMap''
  
    EXEC @ExecResult = sp_getapplock
           @Resource = @LockResourceName
          ,@LockMode = ''Shared''
          ,@LockOwner = ''Transaction''

    IF (@ExecResult &lt; 0)
    BEGIN
      RAISERROR(777971001, 16, 1, ''Shared:StandardDatasetTableMap'', @ExecResult)
    END
	-------------------------------------------------------------------------------------------------
	-- Updating Fact Process HealthState Table
	--------------------------------------------------------------------------------------------------

				SET @Statement = 
				''INSERT INTO ['' + @SchemaName + ''].[''+ @InsertTableName +'']
				(
				   DateKey                
				  ,TimeKey                
				  ,ComputerRowId          
				  ,ProcessRowId           
				  ,ProcessCmdRowId        
				  ,UserRowId              
				  ,PID                    
				  ,LocalAddressRowId      
				  ,RemoteAddressRowId     
				  ,PortType               
				  ,LocalPort              
				  ,RemotePort             
				  ,OldPortState           
				  ,PortState              
				  ,TimeInOldState         
				  ,IPV6                   
				  ,DateTime          
				)
				SELECT
						 DateKey                        
						,TimeKey                        
						,ComputerRowId                  
						,ProcessRowId                   
						,ProcessCmdRowId 
						,UserRowId               
						,ProcessId                         
  					    ,LocalAddressRowId      
				        ,RemoteAddressRowId 
						,PortType               
						,LocalPort              
						,RemotePort             
						,OldPortState           
						,PortState              
						,TimeInOldState         
						,IPV6              
						,CollectedDate                  
				FROM 
					' + @SchemaName + '.PortStaging2Process
					WHERE DateKey IS NOT NULL                      
						 AND TimeKey IS NOT NULL                        
						 AND ComputerRowId IS NOT NULL                  
						 AND ProcessRowId IS NOT NULL                   
						 AND ProcessCmdRowId IS NOT NULL 
						 AND UserRowId IS NOT NULL                                       
  					     AND LocalAddressRowId IS NOT NULL      
				         AND RemoteAddressRowId IS NOT NULL 
						 AND PortType IS NOT NULL               
						 AND LocalPort IS NOT NULL              
						 AND RemotePort IS NOT NULL
						 AND ManagedEntityRowid  &lt;&gt; 0''

				IF (@DebugLevel &gt; 0)
				BEGIN
				  SELECT @MessageText = ''Starting to insert '' + CAST(COUNT(*) AS varchar(30)) + '' process Port State samples into '' + @InsertTableName
				  FROM ' + @SchemaName + '.PortStaging2Process
      
				  SET @InsertStartedDateTime = GETUTCDATE()
      
				  EXEC DebugMessageInsert
					 @DatasetId = @DatasetId
					,@MessageLevel = @InfoLevel
					,@MessageText = @MessageText
				END
			
				EXEC(@Statement)

			 -- mark existing affected aggregations as dirty
				UPDATE ah
				SET DirtyInd = 1
				   ,DataLastReceivedDateTime = GETUTCDATE()
				FROM StandardDatasetAggregationHistory ah
					  JOIN StandardDatasetAggregation a ON (ah.DatasetId = a.DatasetId AND ah.AggregationTypeId = a.AggregationTypeId)
					  CROSS JOIN ' + @SchemaName + '.PortStaging2Process p
				WHERE (ah.DatasetId = @DatasetId)
				  AND (ah.AggregationDateTime &gt; DATEADD(day, -@RawDataMaxAgeDays, GETUTCDATE()))
				  AND (p.[CollectedDate] &gt;= ah.AggregationDateTime)
				  AND (p.[CollectedDate] &lt; DATEADD(minute, a.AggregationIntervalDurationMinutes, ah.AggregationDateTime))

			   -- delete processed rows from staging
               DELETE ps
               FROM ' + @SchemaName + '.PortStaging ps
               JOIN ' + @SchemaName + '.PortStaging2Process psp ON (ps.PortStageRowId  = psp.OriginalPortStageRowId )
    
				-- delete all inserted data from staging
				DROP TABLE ' + @SchemaName + '.PortStaging2Process
				
	    EXEC sp_releaseapplock  @Resource = @LockResourceName 
	COMMIT
    
	IF (@DebugLevel &gt; 0)
    BEGIN
      SET @MessageText = ''Process Monitroing Port State DataSet: Finished inserting port state samples  into '' + @InsertTableName
      SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @InsertStartedDateTime))
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @MessageText
        ,@OperationDurationMs = @OperationDurationMs
    END

    

  END TRY
  BEGIN CATCH
    IF (@@TRANCOUNT &gt; 0)
      ROLLBACK TRAN
  
    SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
      ,@ErrorMessageText = ERROR_MESSAGE()

    SET @ErrorInd = 1
  END CATCH

  -- report error if any
  IF (@ErrorInd = 1)
  BEGIN
    IF (@DebugLevel &gt; 0)
    BEGIN
      
      SET @DebugMessageText = N''Failed to process data in the Process Monitroing Port State DataSet staging area. Error '' + CAST(@ErrorNumber AS varchar(15))
                      + '', Procedure '' + @ErrorProcedure
                      + '', Line '' + CAST(@ErrorLine AS varchar(15))
                      + '', Message: ''+ @ErrorMessageText

      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @ErrorLevel
        ,@MessageText = @DebugMessageText
    END
      
    DECLARE @AdjustedErrorSeverity int

    SET @AdjustedErrorSeverity = CASE
                                   WHEN @ErrorSeverity &gt; 18 THEN 18
                                   ELSE @ErrorSeverity
                                 END
    
    RAISERROR (777971002, @AdjustedErrorSeverity, 1
      ,@ErrorNumber
      ,@ErrorSeverity
      ,@ErrorState
      ,@ErrorProcedure
      ,@ErrorLine
      ,@ErrorMessageText
    )
  END

DeleteWrongDataSet:	
	--------------------------------------------------------------------------
	-- Delete wrong  datasets from staging
	--------------------------------------------------------------------------
	DECLARE
	  @delBatchSize int
	 ,@ErrorIndDel int
	 
	 SET @ErrorIndDel  = 0
	 SET @delBatchSize = @MaxStagingRowsToProcess

	IF (@DebugLevel &gt; 0)
    BEGIN
      SET @MessageText = ''Process Monitroing Port State DataSet: Starting deletion of wrong DataSets records from staging ''
      
      EXEC DebugMessageInsert
         @DatasetId = @DatasetId
        ,@MessageLevel = @InfoLevel
        ,@MessageText = @MessageText
    END

   SET @InsertStartedDateTime = GETUTCDATE()

	WHILE(1=1)
	BEGIN
	 BEGIN TRY
	     BEGIN TRAN
			DELETE TOP(@delBatchSize) FROM ' + @SchemaName + '.PortStaging
			WHERE (DatasetId != @DatasetId)

			IF (@@rowcount &lt; @delBatchSize)
			BEGIN
				COMMIT
				BREAK;
			END
 	     COMMIT

	 END TRY
     BEGIN CATCH
		IF (@@TRANCOUNT &gt; 0)
		  ROLLBACK TRAN
  
		SELECT 
		   @ErrorNumber = ERROR_NUMBER()
		  ,@ErrorSeverity = ERROR_SEVERITY()
		  ,@ErrorState = ERROR_STATE()
		  ,@ErrorLine = ERROR_LINE()
		  ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), ''-'')
		  ,@ErrorMessageText = ERROR_MESSAGE()

		SET @ErrorIndDel = 1
	 END CATCH

	 IF (@ErrorIndDel = 1)
	 BEGIN

			BREAK;
     END --IF
    END --WHILE

	 IF (@ErrorIndDel = 1)
	 BEGIN
			IF (@DebugLevel &gt; 0)
			BEGIN

      
				SET @DebugMessageText = N''Failed to delete  data from wrong dataset in the Process Monitroing Port State DataSet staging area. Error '' + CAST(@ErrorNumber AS varchar(15))
								+ '', Procedure '' + @ErrorProcedure
								+ '', Line '' + CAST(@ErrorLine AS varchar(15))
								+ '', Message: ''+ @ErrorMessageText

				EXEC DebugMessageInsert
					@DatasetId = @DatasetId
				,@MessageLevel = @ErrorLevel
				,@MessageText = @DebugMessageText
			END
      
			SET @AdjustedErrorSeverity = CASE
											WHEN @ErrorSeverity &gt; 18 THEN 18
											ELSE @ErrorSeverity
											END
    
			RAISERROR (777971002, @AdjustedErrorSeverity, 1
				,@ErrorNumber
				,@ErrorSeverity
				,@ErrorState
				,@ErrorProcedure
				,@ErrorLine
				,@ErrorMessageText
			)

     END
	 ELSE
	 BEGIN
		IF (@DebugLevel &gt; 0)
		BEGIN
		  SET @MessageText = ''Process Monitroing Port State DataSet: Finished deleting wrong dataset records from staging ''
          SET @OperationDurationMs = ABS(DATEDIFF(ms, GETUTCDATE(), @InsertStartedDateTime))
      
		  EXEC DebugMessageInsert
			 @DatasetId = @DatasetId
			,@MessageLevel = @InfoLevel
			,@MessageText = @MessageText
            ,@OperationDurationMs = @OperationDurationMs

		END

     END --IF
 Endproc:
END  --Procedure [ProcessMonitoring].[StatePortStaging]
'

DECLARE  @ErrorInd bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)

SET @ErrorInd  = 0

BEGIN TRY
	EXECUTE (@Statement)
END TRY
BEGIN CATCH
     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

       SET @ErrorInd  = 1
	   SET @DebugMessage = @DebugPrefix +  'Cannot create stage processing stored procedure. Error: ' + @ErrorMessageText
END CATCH
       
IF (1 = @ErrorInd) 
BEGIN
	DECLARE @AdjustedErrorSeverity int

	SET @AdjustedErrorSeverity = CASE
                            WHEN @ErrorSeverity &gt; 18 THEN 18
                            ELSE @ErrorSeverity
                        END
  
   IF @DebugLevel &gt; 0
      EXEC DebugMessageInsert
		@DatasetId = '$Config/DatasetId$'
		,@MessageLevel = @ErrorLevel
		,@MessageText = @DebugMessage

	RAISERROR (777971002, @AdjustedErrorSeverity, 1
	,@ErrorNumber
	,@ErrorSeverity
	,@ErrorState
	,@ErrorProcedure
	,@ErrorLine
	,@ErrorMessageText
	)

END
ELSE
BEGIN
  IF @DebugLevel &gt; 0 
  BEGIN

    SET @DebugMessage =  @DebugPrefix + 'Stage processing stored procedure was created successfully.'
   
	EXEC DebugMessageInsert
	@DatasetId     = '$Config/DatasetId$'
	,@MessageLevel = @InfoLevel
	,@MessageText  = @DebugMessage

 END
END

Endproc:
GO


</Install><Uninstall>GO
DECLARE
 @TableSchemaName sysname


SELECT 
	@TableSchemaName  = SchemaName
FROM
dbo.StandardDataSet
WHERE DatasetId = '$Config/DatasetId$'

-- drop SPs
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME =  'PortStateProcessStaging')
	BEGIN
		EXECUTE('DROP PROCEDURE ' + @TableSchemaName + '.PortStateProcessStaging')
	END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_TYPE = 'PROCEDURE' AND ROUTINE_SCHEMA = @TableSchemaName AND ROUTINE_NAME = 'PortStateFactsGroom')
	BEGIN
		EXECUTE ('DROP PROCEDURE ' + @TableSchemaName + '.PortStateFactsGroom ')
	END

--drop views
IF  EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'vIpAddressDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE('DROP VIEW ' + @TableSchemaName + '.vIpAddressDim')
END

IF  EXISTS (SELECT * FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME = 'IpAddressDim' AND TABLE_SCHEMA = @TableSchemaName)
BEGIN
  EXECUTE('DROP Table ' + @TableSchemaName + '.IpAddressDim')
END
-- delete std dataset related data
EXEC StandardDatasetDelete '$Config/DatasetId$'
GO
</Uninstall><Upgrade>
GO
---------------------------------------------------------------
-- Update Port State Dataset
--------------------------------------------------------------


DECLARE 
         @SchemaName sysname
	    ,@ProcessStagingSp sysname
	    ,@ErrorInd        bit
		,@ErrorMessageText nvarchar(4000)
		,@ErrorNumber     int
		,@ErrorSeverity   int
		,@ErrorState      int
		,@ErrorLine       int
		,@ErrorProcedure  nvarchar(256)
	    ,@DebugMessage    nvarchar(max)
        ,@DebugLevel tinyint
	    ,@DebugPrefix  nvarchar(max)

SET @SchemaName  = 'ProcessMonitoring'
SET @ProcessStagingSp = 'PortStateProcessStaging'
SET @ErrorInd = 0
SET @DebugLevel = 0

SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
SET @DebugMessage =  @DebugPrefix + ' Update dataset definition.'


EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = 1
			,@MessageText = @DebugMessage
 BEGIN TRY
	
	UPDATE StandardDataset 
	SET
		DebugLevel = @DebugLevel
   WHERE DatasetId = '$Config/DatasetId$'

 END TRY
 BEGIN CATCH
    SET @ErrorInd = 1
 END CATCH

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int


  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END

 SET @DebugMessage =  @DebugPrefix + 'Update dataset definition was failed. Error: ' + @ErrorMessageText
  
 EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = 3
			,@MessageText = @DebugMessage
  
  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
 SET @DebugMessage =  @DebugPrefix + 'Update dataset definition was finished successfully.'
  
 EXEC DebugMessageInsert
			@DatasetId = '$Config/DatasetId$'
			,@MessageLevel = 1
			,@MessageText = @DebugMessage

END
GO

------------------------------------------------------------------------------------------------------------
-- Create Indexes for the StandardDataset Aggregation Tables  for Process MonitoringPortState Fact Tables
------------------------------------------------------------------------------------------------------------

GO
SET NOCOUNT ON

-- create [DateTime] field indexes for all aggregation levels
DECLARE 
   @AggregationTypeId int
  ,@Statement nvarchar(max)
  ,@IndeGuid uniqueidentifier
  ,@ErrorInd        bit
  ,@ErrorMessageText nvarchar(4000)
  ,@ErrorNumber     int
  ,@ErrorSeverity   int
  ,@ErrorState      int
  ,@ErrorLine       int
  ,@ErrorProcedure  nvarchar(256)
  ,@DebugMessage      nvarchar(max)
  ,@DebugPrefix       nvarchar(max)
  ,@ErrorLevel        int
  ,@InfoLevel         int


SET @ErrorLevel   = 3 
SET @InfoLevel    = 1
SET @ErrorInd     = 0
SET @DebugPrefix  =  'Process Monitoring Port State DataSet: '
SET @DebugMessage =  @DebugPrefix + 'Starting dataset indexes deployment.'
SET @AggregationTypeId = -1

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 

BEGIN TRY
		WHILE EXISTS (SELECT *
					  FROM StandardDatasetAggregation
					  WHERE (DatasetId = '$Config/DatasetId$')
						AND (AggregationTypeId &gt; @AggregationTypeId)
					 )
		BEGIN
		  SELECT @IndeGuid = NEWID()
  
		  SELECT TOP 1 
			 @AggregationTypeId = AggregationTypeId
			,@Statement = 
			  ' EXEC StandardDatasetIndexDelete'
			+ '    @DatasetId = ''$Config/DatasetId$'''
			+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
			  + '   ,@DeleteIndexOnExistingTablesInd = 0'
			+ ' EXEC StandardDatasetIndexInsert'
			+ '    @DatasetId = ''$Config/DatasetId$'''
			+ '   ,@AggregationTypeId = ' + CAST(AggregationTypeId AS varchar(10))
			+ '   ,@DependentTableInd = 0'
			+ '   ,@TableTag = NULL'
			+ '   ,@UniqueInd = 0'
			+ '   ,@IndexGuid = ''' + CAST(@IndeGuid AS varchar(100)) + ''''
			+ '   ,@IndexDefinition = ''([DateTime])'''
			+ '   ,@CreateIndexOnExistingTablesInd = 0'
		  FROM StandardDatasetAggregation
		  WHERE (DatasetId = '$Config/DatasetId$')
			AND (AggregationTypeId &gt; @AggregationTypeId)
		  ORDER BY AggregationTypeId
  
		  EXECUTE (@Statement)
		END


		/* raw indexes for UI widget p*/

		-- Hourly data index to support Top N reports and dashboards
		EXEC StandardDatasetIndexDelete
		   @DatasetId = '$Config/DatasetId$'
		  ,@IndexGuid = '6D30F2F6-82A9-4B38-AFBE-3A1F7A17BA9E'
			,@DeleteIndexOnExistingTablesInd = 0

		EXEC StandardDatasetIndexInsert
			@DatasetId = '$Config/DatasetId$'
		  ,@AggregationTypeId = 0
		  ,@DependentTableInd = 0
		  ,@TableTag = NULL
		  ,@UniqueInd = 0
		  ,@IndexGuid = '6D30F2F6-82A9-4B38-AFBE-3A1F7A17BA9E'
		  ,@IndexDefinition = '(
				 ComputerRowId     
				,ProcessRowId      
				,ProcessCmdRowId   
				,UserRowId         
				,PID               
				,LocalAddressRowId 
				,RemoteAddressRowId               
				,DateTime
			  )
			  INCLUDE
			  (
				 PortType      
				,LocalPort     
				,RemotePort    
				,OldPortState  
				,PortState     
				,TimeInOldState
				,IPV6          
			  )
		  '
		,@CreateIndexOnExistingTablesInd = 0


		-- Index for dashboard
		EXEC StandardDatasetIndexDelete
		   @DatasetId = '$Config/DatasetId$'
		  ,@IndexGuid = 'F747FA4B-577A-4952-B77A-751212594317'
			,@DeleteIndexOnExistingTablesInd = 1

		EXEC StandardDatasetIndexInsert
			@DatasetId = '$Config/DatasetId$'
		  ,@AggregationTypeId = 0
		  ,@DependentTableInd = 0
		  ,@TableTag = NULL
		  ,@UniqueInd = 0
		  ,@IndexGuid = 'F747FA4B-577A-4952-B77A-751212594317'
		  ,@IndexDefinition = '([ComputerRowId] ASC,
	[DateTime])'
		,@CreateIndexOnExistingTablesInd = 1

END TRY
BEGIN CATCH
  SET @ErrorInd = 1

     SELECT 
       @ErrorNumber = ERROR_NUMBER()
      ,@ErrorSeverity = ERROR_SEVERITY()
      ,@ErrorState = ERROR_STATE()
      ,@ErrorLine = ERROR_LINE()
      ,@ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-')
      ,@ErrorMessageText = ERROR_MESSAGE()

END CATCH

IF (@ErrorInd = 1)
BEGIN
  DECLARE @AdjustedErrorSeverity int

  SET @AdjustedErrorSeverity = CASE
                                 WHEN @ErrorSeverity &gt; 18 THEN 18
                                 ELSE @ErrorSeverity
                               END
  
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was failed. Error: ' + @ErrorMessageText

  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @ErrorLevel
			,@MessageText  = @DebugMessage 

  RAISERROR (777971002, @AdjustedErrorSeverity, 1
    ,@ErrorNumber
    ,@ErrorSeverity
    ,@ErrorState
    ,@ErrorProcedure
    ,@ErrorLine
    ,@ErrorMessageText
  )

END
ELSE
BEGIN
  SET @DebugMessage = @DebugPrefix + 'Indexes deployment was finished successfully.'
  EXEC DebugMessageInsert
			 @DatasetId    = '$Config/DatasetId$'
			,@MessageLevel = @InfoLevel
			,@MessageText  = @DebugMessage 
END

GO

</Upgrade></DataWarehouseDataSet></DataWarehouseDataSets><Reports><Report ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" Accessibility="Public" Visible="true"><Dependencies><DataWarehouseScript>Microsoft.Window.Server.10.0.Dashboard.DWScript.Microsoft.Window.Server.GetTopNProcesses.Procedure</DataWarehouseScript><ReportParameterControl>DWReport!Microsoft.SystemCenter.DataWarehouse.Report.ParameterControl.RelativeDateTimePicker</ReportParameterControl><ReportParameterControl>DWReport!Microsoft.SystemCenter.DataWarehouse.Report.ParameterControl.ComboBox</ReportParameterControl><ReportParameterControl>DWReport!Microsoft.SystemCenter.DataWarehouse.Report.ParameterControl.NumericUpDown</ReportParameterControl></Dependencies><ParameterBlock xmlns="http://schemas.microsoft.com/mom/reporting/2007/ReportParameterSettings" columns="3"><Controls><Control columnSpan="1" rowSpan="1" type="Microsoft.SystemCenter.DataWarehouse.Report.ParameterControl.ComboBox"><ReportParameters><ReportParameter name="OrderBy"><Prompt>Microsoft.Windows.Server.10.0.ProcessMonitoring!Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.OrderBy</Prompt></ReportParameter></ReportParameters></Control><Control columnSpan="1" rowSpan="1" type="Microsoft.SystemCenter.DataWarehouse.Report.ParameterControl.NumericUpDown"><ReportParameters><ReportParameter name="N"><Prompt>Microsoft.Windows.Server.10.0.ProcessMonitoring!Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.N</Prompt></ReportParameter></ReportParameters><Properties><Property name="Minimum"><Value>1</Value></Property></Properties></Control><Control type="Microsoft.SystemCenter.DataWarehouse.Report.ParameterControl.RelativeDateTimePicker" columnSpan="1" rowSpan="6"><ReportParameters><ReportParameter name="TimeZone" binding="TimeZone"><Prompt>Microsoft.SystemCenter.DataWarehouse.Report.Library!Microsoft.SystemCenter.DataWarehouse.Report.ParameterPrompt.TimeZone</Prompt></ReportParameter><ReportParameter name="TimeZoneName" binding="TimeZoneName"/><ReportParameter name="StartDate_BaseType" binding="StartDate_BaseType"/><ReportParameter name="StartDate_BaseValue" binding="StartDate_BaseValue"><Prompt>Microsoft.Windows.Server.10.0.ProcessMonitoring!Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.StartDate</Prompt></ReportParameter><ReportParameter name="StartDate_OffsetType" binding="StartDate_OffsetType"/><ReportParameter name="StartDate_OffsetValue" binding="StartDate_OffsetValue"/><ReportParameter name="EndDate_BaseType" binding="EndDate_BaseType"/><ReportParameter name="EndDate_BaseValue" binding="EndDate_BaseValue"><Prompt>Microsoft.Windows.Server.10.0.ProcessMonitoring!Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.EndDate</Prompt></ReportParameter><ReportParameter name="EndDate_OffsetType" binding="EndDate_OffsetType"/><ReportParameter name="EndDate_OffsetValue" binding="EndDate_OffsetValue"/></ReportParameters><Properties><Property name="MaxWidth"><Value>400</Value></Property></Properties></Control></Controls></ParameterBlock><ReportDefinition>Microsoft.Windows.Server.10.0.ProcessMonitoring.TopNProcesses.rdl</ReportDefinition><ReportStrings><ReportString ID="R.TopNProcesses"/><ReportString ID="R.OrderBy"/><ReportString ID="R.ComputerName"/><ReportString ID="R.ProcessName"/><ReportString ID="R.MaxCpuUsage"/><ReportString ID="R.MaxMemoryUsage"/><ReportString ID="R.MaxHandleCount"/><ReportString ID="R.MaxThreadCount"/><ReportString ID="R.MaxPageFaultCount"/><ReportString ID="R.MaxCpuTime"/><ReportString ID="R.MaxTotalProcessTime"/><ReportString ID="R.MaxReadPerSecond"/><ReportString ID="R.MaxWritePerSecond"/></ReportStrings></Report></Reports></Reporting><LanguagePacks><LanguagePack ID="ENU" IsDefault="true"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Folder.Root"><Name>Process and Port Monitoring</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Process"><Name>Process Dashboard</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Presentation.Dashboard.Port"><Name>Port Dashboard</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessList.Widget"><Name>Processes</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Presentation.Components.PortList.Widget"><Name>Ports</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Presentation.Components.ProcessTopN.Widget"><Name>Top 10 Processes</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessSeed.Full.Discovery"><Name>Windows Server 2016 and above Process and Port Monitoring Seed Discovery (Full)</Name><Description>Discovery of process and port monitoring seed objects of Windows Server 2016 and above (Full).</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessSeed.Core.Discovery"><Name>Windows Server 2016 and above Process and Port Monitoring Seed Discovery (Core)</Name><Description>Discovery of Core process and port monitoring seed objects of Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessCount.Collection"><Name>Process Monitoring: Number of Processes Collection</Name><Description>This rule collects the Number of Processes performance counter for Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert"><Name>Process Monitoring: High Handle Count</Name><Description>This rule generates an alert when handle count increases too fast.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource" SubElementID="SampleCount"><Name>Sample Count</Name><Description>Sample Count</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource" SubElementID="HandleCountIncreaseThreshold"><Name>Handle Count Increase Threshold</Name><Description>Handle Count Increase Threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource" SubElementID="MonitoringConfiguration"><Name>Monitoring Configuration</Name><Description>Allows to specify thresholds for specific processes and processes to exclude from monitoring in XML format</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource" SubElementID="LogLevel"><Name>Log Level</Name><Description>
            Determines which events should be written to Event Log.
            0 – All,  1 – Informational, 2 – Warning, 4 – Error,  8 – Verbose,
            16 – Debug,  255 – None
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert.AlertMessage"><Name>Handle Count Increases Too Fast</Name><Description>Handle Count for process {1} with PID {0} has increased more than by {2}%.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert"><Name>Process Monitoring: High Processor Time Percentage</Name><Description>This rule generates an alert when the percentage of processor time is too high.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource" SubElementID="SampleCount"><Name>Sample Count</Name><Description>Sample Count</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource" SubElementID="PercentProcessorTimeThreshold"><Name>Percent Processor Time Threshold</Name><Description>Percent processor time threshold.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource" SubElementID="MonitoringConfiguration"><Name>Monitoring Configuration</Name><Description>Allows to specify thresholds for specific processes and processes to exclude from monitoring in XML format</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource" SubElementID="LogLevel"><Name>Log Level</Name><Description>
            Determines which events should be written to Event Log.
            0 – All,  1 – Informational, 2 – Warning, 4 – Error,  8 – Verbose,
            16 – Debug,  255 – None
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert.AlertMessage"><Name>Processor Time Percentage is too high</Name><Description>Processor Time Percentage for process {1} with PID {0} is greater than threshold value: {2}%.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert"><Name>Process Monitoring: High Memory Percentage</Name><Description>This rule generates an alert when the memory percentage is too high.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource" SubElementID="SampleCount"><Name>Sample Count</Name><Description>Sample Count</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource" SubElementID="MemoryPercentageThreshold"><Name>Memory Percentage Threshold</Name><Description>Memory Percentage Threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource" SubElementID="MonitoringConfiguration"><Name>Monitoring Configuration</Name><Description>Allows to specify thresholds for specific processes and processes to exclude from monitoring in XML format</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource" SubElementID="LogLevel"><Name>Log Level</Name><Description>
            Determines which events should be written to Event Log.
            0 – All,  1 – Informational, 2 – Warning, 4 – Error,  8 – Verbose,
            16 – Debug,  255 – None
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert.AlertMessage"><Name>Memory Percentage is too high</Name><Description>Memory Percentage for process {1} with PID {0} is greater than threshold value: {2}%.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.TemplateFolder.ProcessesAndPorts"><Name>Processes and Ports</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.ContainsWindowsServer.10.0.Computer"><Name>Windows Server 2016 and above Enabled Process Monitoring Group Contains Windows Server 2016 and above</Name><Description>A relationship between Windows Server 2016 and above Enabled Process Monitoring Group and computers with Windows Server 2016 or above operating systems installed.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.ContainsWindowsServer.10.0.Computer"><Name>Windows Server 2016 and above Enabled Port Monitoring Group Contains Windows Server 2016 and above</Name><Description>A relationship between Windows Server 2016 and above Enabled Port Monitoring Group and computers with Windows Server 2016 or above operating systems installed.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringSeedGroup.ContainsProcessSeed"><Name>Windows Server 2016 and above Process and Port Monitoring Seed Group Contains Process Seed</Name><Description>A relationship between Windows Server 2016 and above Process and Port Monitoring Seed Group and the process and port monitoring seeds.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group"><Name>Windows Server 2016 and above Enabled Process Monitoring Group</Name><Description>This group contains seeds related to Windows Server 2016 and above operating systems for which process monitoring is enabled.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group"><Name>Windows Server 2016 and above Enabled Port Monitoring Group</Name><Description>This group contains seeds of Windows Server 2016 and above operating systems for which port monitoring is enabled.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group.Discovery"><Name>Populate Windows Server 2016 and above Enabled Process Monitoring Group</Name><Description>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which process monitoring is enabled via "Add Monitoring Wizard".</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group.Discovery"><Name>Populate Windows Server 2016 and above Enabled Port Monitoring Group</Name><Description>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which port monitoring is enabled via "Add Monitoring Wizard".</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Seed.Group"><Name>Windows Server 2016 and above Process and Port Monitoring Seed Group</Name><Description>This group contains process and port monitoring seeds of Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringSeed.Group.Discovery"><Name>Populate Windows Server 2016 and above Process and Port Monitoring Seed Group</Name><Description>This rule populates the Process and Port Monitoring Seed Group of Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group"><Name>Windows Server 2016 and above Disabled Process Monitoring Group</Name><Description>This group contains seeds of Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group.Discovery"><Name>Populate Windows Server 2016 and above Disabled Process Monitoring Group</Name><Description>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which process monitoring is disabled via "Add Monitoring Wizard".</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group"><Name>Windows Server 2016 and above Disabled Port Monitoring Group</Name><Description>This group contains seeds of Windows Server 2016 and above operating systems for which port monitoring is disabled.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group.Discovery"><Name>Populate Windows Server 2016 and above Disabled Port Monitoring Group</Name><Description>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which port monitoring is disabled via "Add Monitoring Wizard".</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Presentation.Components.ServerList.Widget"><Name>Servers</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.HealthStatesCollection.Dataset"><Name>Process Monitoring: Process Health State data warehouse dataset</Name><Description>Process Health State data warehouse for Process Monitoring.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.HealthStatesCollection.Dataset.DefaultConfiguration"><Name>Process monitoring: Process Health State data warehouse dataset configuration</Name><Description>
            &lt;Configuration&gt;
            &lt;Aggregations&gt;
            &lt;Raw&gt;
            &lt;BaseTableName&gt;ProcessHealthFactsRaw&lt;/BaseTableName&gt;
            &lt;MaxTableRowCount&gt;10000000&lt;/MaxTableRowCount&gt;
            &lt;MaxDataAgeDays&gt;10&lt;/MaxDataAgeDays&gt;
            &lt;GroomingIntervalMinutes&gt;240&lt;/GroomingIntervalMinutes&gt;
            &lt;MaxRowsToGroom&gt;100000&lt;/MaxRowsToGroom&gt;
            &lt;IndexOptimizationIntervalMinutes&gt;240&lt;/IndexOptimizationIntervalMinutes&gt;
            &lt;/Raw&gt;
            &lt;/Aggregations&gt;
            &lt;RawInsertTableCount&gt;1&lt;/RawInsertTableCount&gt;
            &lt;DefaultAggregationIntervalCount&gt;10&lt;/DefaultAggregationIntervalCount&gt;
            &lt;BlockingMaintenanceDailyStartTime&gt;04:00&lt;/BlockingMaintenanceDailyStartTime&gt;
            &lt;BlockingMaintenanceDurationMinutes&gt;240&lt;/BlockingMaintenanceDurationMinutes&gt;
            &lt;/Configuration&gt;
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.MetricsCollection.Dataset"><Name>Process Monitoring: Performance Metric  State data warehouse dataset</Name><Description>Process Performance Metric  data warehouse for Process Monitoring.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.MetricsCollection.Dataset.DefaultConfiguration"><Name>Process monitoring: Process Performance Metric data warehouse dataset configuration</Name><Description>
            &lt;Configuration&gt;
            &lt;Aggregations&gt;
            &lt;Raw&gt;
            &lt;BaseTableName&gt;ProcessMetricFactsRaw&lt;/BaseTableName&gt;
            &lt;MaxTableRowCount&gt;10000000&lt;/MaxTableRowCount&gt;
            &lt;MaxDataAgeDays&gt;10&lt;/MaxDataAgeDays&gt;
            &lt;GroomingIntervalMinutes&gt;240&lt;/GroomingIntervalMinutes&gt;
            &lt;MaxRowsToGroom&gt;100000&lt;/MaxRowsToGroom&gt;
            &lt;IndexOptimizationIntervalMinutes&gt;240&lt;/IndexOptimizationIntervalMinutes&gt;
            &lt;/Raw&gt;
            &lt;Hourly&gt;
            &lt;BaseTableName&gt;ProcessMetricFactsHourly&lt;/BaseTableName&gt;
            &lt;MaxTableRowCount&gt;10000000&lt;/MaxTableRowCount&gt;
            &lt;MaxDataAgeDays&gt;90&lt;/MaxDataAgeDays&gt;
            &lt;GroomingIntervalMinutes&gt;240&lt;/GroomingIntervalMinutes&gt;
            &lt;MaxRowsToGroom&gt;100000&lt;/MaxRowsToGroom&gt;
            &lt;IndexOptimizationIntervalMinutes&gt;240&lt;/IndexOptimizationIntervalMinutes&gt;
            &lt;AggregationStartDelayMinutes&gt;20&lt;/AggregationStartDelayMinutes&gt;
            &lt;/Hourly&gt;
            &lt;Daily&gt;
            &lt;BaseTableName&gt;ProcessMetricFactsDaily&lt;/BaseTableName&gt;
            &lt;MaxTableRowCount&gt;10000000&lt;/MaxTableRowCount&gt;
            &lt;MaxDataAgeDays&gt;180&lt;/MaxDataAgeDays&gt;
            &lt;GroomingIntervalMinutes&gt;240&lt;/GroomingIntervalMinutes&gt;
            &lt;MaxRowsToGroom&gt;100000&lt;/MaxRowsToGroom&gt;
            &lt;IndexOptimizationIntervalMinutes&gt;240&lt;/IndexOptimizationIntervalMinutes&gt;
            &lt;AggregationStartDelayMinutes&gt;40&lt;/AggregationStartDelayMinutes&gt;
            &lt;/Daily&gt;
            &lt;/Aggregations&gt;
            &lt;RawInsertTableCount&gt;1&lt;/RawInsertTableCount&gt;
            &lt;DefaultAggregationIntervalCount&gt;10&lt;/DefaultAggregationIntervalCount&gt;
            &lt;BlockingMaintenanceDailyStartTime&gt;04:00&lt;/BlockingMaintenanceDailyStartTime&gt;
            &lt;BlockingMaintenanceDurationMinutes&gt;240&lt;/BlockingMaintenanceDurationMinutes&gt;
            &lt;/Configuration&gt;
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.NetPortsCollection.Dataset"><Name>Process Monitoring: Process Network Ports data warehouse dataset</Name><Description>Process Network Ports data warehouse for Process Monitoring.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.NetPortsCollection.Dataset.DefaultConfiguration"><Name>Process monitoring: Process Network Ports data warehouse dataset configuration</Name><Description>

            &lt;Configuration&gt;
            &lt;Aggregations&gt;
            &lt;Raw&gt;
            &lt;BaseTableName&gt;PortFactsRaw&lt;/BaseTableName&gt;
            &lt;MaxTableRowCount&gt;10000000&lt;/MaxTableRowCount&gt;
            &lt;MaxDataAgeDays&gt;10&lt;/MaxDataAgeDays&gt;
            &lt;GroomingIntervalMinutes&gt;240&lt;/GroomingIntervalMinutes&gt;
            &lt;MaxRowsToGroom&gt;100000&lt;/MaxRowsToGroom&gt;
            &lt;IndexOptimizationIntervalMinutes&gt;240&lt;/IndexOptimizationIntervalMinutes&gt;
            &lt;/Raw&gt;
            &lt;/Aggregations&gt;
            &lt;RawInsertTableCount&gt;1&lt;/RawInsertTableCount&gt;
            &lt;DefaultAggregationIntervalCount&gt;10&lt;/DefaultAggregationIntervalCount&gt;
            &lt;BlockingMaintenanceDailyStartTime&gt;04:00&lt;/BlockingMaintenanceDailyStartTime&gt;
            &lt;BlockingMaintenanceDurationMinutes&gt;240&lt;/BlockingMaintenanceDurationMinutes&gt;
            &lt;/Configuration&gt;
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthStateSubscription.Rule"><Name>Process Monitoring: Process Health State Subscription</Name><Description>This rule saves Process Health State information to the SCOM data warehouse. To start information collection, make sure that “Process Monitoring: Health State Collection” rule is enabled.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetricsSubscription.Rule"><Name>Process Monitoring: Process Performance Metric Subscription</Name><Description>This rule saves Process Performance Metric information to the SCOM data warehouse. To start information collection, make sure that “Process Monitoring: Performance Collection” rule is enabled.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PortSubscription.Rule"><Name>Process Monitoring: Process Network Port Subscription</Name><Description>This rule saves Process Network Port information to the SCOM data warehouse. To start information collection, make sure that “Process Monitoring: Network Port State Collection” rule is enabled.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection"><Name>Process Monitoring: Health State Collection</Name><Description>This rule collects information about the health state of the processes.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection"><Name>Process Monitoring: Performance Collection</Name><Description>This rule collects information about the processes' performance metrics.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Ports.Collection"><Name>Process Monitoring: Network Port State Collection</Name><Description>This rule collects information about Network Port State.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetricsDW.WriteAction"><Name>Process Monitoring: Process Performance Collection Write Action</Name><Description>This write action writes the Process Performance into SCOM data warehouse.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthStateDW.WriteAction"><Name>Process Monitoring: Process Health State Collection Write Action</Name><Description>This write action writes the Process Health State into SCOM data warehouse.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PortDW.WriteAction"><Name>Process Monitoring: Process Health State Collection Write Action</Name><Description>This write action writes the Process Health State into SCOM data warehouse.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthStatePublish.WriteAction"><Name>Process Monitoring: Write Action For Publishing Process Health States Data</Name><Description>This write action publishes Process Health State data to a custom channel.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetricsPublish.WriteAction"><Name>Process Monitoring: Write Action For Publishing Process Performance Data</Name><Description>This write action publishes Process Performance data to a custom channel.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PortsPublish.WriteAction"><Name>Process Monitoring: Write Action For Publishing Process Network Ports Data</Name><Description>This write action publishes Process Network Ports  data to a custom channel.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Template.ProcessesAndPorts"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This template allows you to monitor Windows Server 2016 and above processes and ports</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.MainPage" SubElementID="Title"><Name>Monitoring Configuration</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.MainPage" SubElementID="SubTitle"><Name>Monitoring Configuration</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.MainPage" SubElementID="TabName"><Name>Monitoring Configuration</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.ProcessThresholdsPage" SubElementID="Title"><Name>Optional Configuration</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.ProcessThresholdsPage" SubElementID="SubTitle"><Name>Optional Configuration</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.ProcessThresholdsPage" SubElementID="TabName"><Name>Optional Configuration</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.Summary" SubElementID="Title"><Name>Summary</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.Summary" SubElementID="SubTitle"><Name>Summary</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.UIPageSet.ProcessesAndPortsTemplate.Summary" SubElementID="TabName"><Name>Summary</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.AlertSubscription.DataSource"><Name>Process Monitoring: Alert Subscription Datasource</Name><Description>Alert subscription datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.CountMonitoring.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HandleCountAlerting.DataSource"><Name>Process Monitoring: Handle Count Alerting Datasource</Name><Description>Handle count alerting datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.CountMonitoring.DataSource"><Name>Process Monitoring: Count Monitoring Datasource</Name><Description>Count monitoring datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HandleCountMonitoring.DataSource"><Name>Process Monitoring: Handle Count Monitoring Datasource</Name><Description>Handle count monitoring datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource"><Name>Process Monitoring: Alerting Datasource</Name><Description>Alerting datasource</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource" SubElementID="SampleCount"><Name>Sample Count</Name><Description>Sample count</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource" SubElementID="HandleCountIncreaseThreshold"><Name>Handle Count Increase Threshold</Name><Description>Handle count increase threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource" SubElementID="MemoryPercentageThreshold"><Name>Memory Percentage Threshold</Name><Description>Memory percentage threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Alerting.DataSource" SubElementID="PercentProcessorTimeThreshold"><Name>Process Monitoring: Processor Time Percentage Threshold</Name><Description>Processor time percentage threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.MemoryPercentageAlerting.DataSource"><Name>Process Monitoring: Memory Percentage Alerting Datasource</Name><Description>Memory percentage alerting datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.Monitoring.DataSource"><Name>Process Monitoring: Monitoring Datasource</Name><Description>Monitoring datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PercentProcessorTimeAlerting.DataSource"><Name>Process Monitoring: Processor Time Percentage Alerting Datasource</Name><Description>Processor time percentage alerting datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessSeedDiscovery.ModuleType"><Name>Process Monitoring: Seed Discovery Module Type</Name><Description>Seed discovery module type.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessSeedDiscovery.ModuleType" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessCountMonitoring.Inner.DataSource"><Name>Process Monitoring: Count Monitoring Inner Data Source</Name><Description>Count monitoring data source.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed"><Name>Process Monitoring: Disabled Group Contains Windows Server 2016 and above Process Seed</Name><Description>Monitoring disabled group contains process seed of Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.PortMonitoringDisabledGroup.ContainsWindowsServer.10.0.ProcessSeed"><Name>Port Monitoring: Disabled Group Contains Windows Server 2016 and above Process Seed</Name><Description>Port monitoring disabled group contains process seed of Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProbeAction"><Name>Process and Port Monitoring: Probe Action</Name><Description>Process and Port monitoring probe action.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.CloseAlertWriteAction"><Name>Process Monitoring: Close Alert Write Action</Name><Description>Close alert write action.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Presentation.ActiveAlert.View"><Name>Active Alerts</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.RunAs.CollectionRules"><Name>Microsoft Windows Server Process Rules Run As Profile</Name><Description>This Run As profile is used for collecting metrics from the following process collection rules: "Process Monitoring: Network Port State Collection", "Process Monitoring: Performance Collection", and "Process Monitoring: Health State Collection" and for generating alerts for the following alert rules: "Process Monitoring: High Memory Percentage", "Process Monitoring: High Processor Time Percentage" and "Process Monitoring: High Handle Count".</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource"><Name>Process Monitoring: Process Performance Collection Datasource</Name><Description>Process performance collection datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource" SubElementID="LogLevel"><Name>Log Level</Name><Description>
            Determines which events should be written to Event Log.
            0 – All,  1 – Informational, 2 – Warning, 4 – Error,  8 – Verbose,
            16 – Debug,  255 – None
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection.DataSource" SubElementID="MonitoringConfiguration"><Name>Monitoring Configuration</Name><Description>Allows to specify processes to exclude from monitoring in XML format</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource"><Name>Process Monitoring: Process Health State Collection Datasource</Name><Description>Process health state collection datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" SubElementID="LogLevel"><Name>Log Level</Name><Description>
            Determines which events should be written to Event Log.
            0 – All,  1 – Informational, 2 – Warning, 4 – Error,  8 – Verbose,
            16 – Debug,  255 – None
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" SubElementID="SampleCount"><Name>Sample Count</Name><Description>Sample Count</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" SubElementID="MemoryPercentageThreshold"><Name>Memory Percentage Threshold</Name><Description>Memory Percentage Threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" SubElementID="PercentProcessorTimeThreshold"><Name>Percent Processor Time Threshold</Name><Description>Percent Processor Time Threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" SubElementID="HandleCountIncreaseThreshold"><Name>Handle Count Increase Threshold</Name><Description>Handle Count Increase Threshold</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource" SubElementID="MonitoringConfiguration"><Name>Monitoring Configuration</Name><Description>Allows to specify thresholds for specific processes and processes to exclude from monitoring in XML format</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection.DataSource.Internal"><Name>Process Monitoring: Process Health State Collection Internal Datasource</Name><Description>Process health state collection internal datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Port.PerfMetrics.Collection.DataSource"><Name>Process Monitoring: Port State Collection Datasource</Name><Description>Port state collection datasource.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Port.PerfMetrics.Collection.DataSource" SubElementID="IntervalSeconds"><Name>Interval Seconds</Name><Description>Interval (seconds)</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Port.PerfMetrics.Collection.DataSource" SubElementID="MonitoringConfiguration"><Name>Monitoring Configuration</Name><Description>Allows to specify thresholds for specific processes and processes to exclude from monitoring in XML format</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Port.PerfMetrics.Collection.DataSource" SubElementID="LogLevel"><Name>Log Level</Name><Description>
            Determines which events should be written to Event Log.
            0 – All,  1 – Informational, 2 – Warning, 4 – Error,  8 – Verbose,
            16 – Debug,  255 – None
          </Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed"><Name>Windows Server 2016 and above Process Monitoring Seed</Name><Description>Process monitoring seed of Windows Server 2016 and above operating systems.</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.Port.DWSubscription.DataSource"><Name>Process Monitoring: Internal datasource for subscribing for Port Data</Name><Description>Process Monitoring: Internal datasource for subscribing for Port Data</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessInfo.DWSubscription.HealthState.DataSource"><Name>Process Monitoring: Internal datasource for subscribing for Process Data</Name><Description>Process Monitoring: Internal datasource for subscribing for Process Data</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessInfo.DWSubscription.PerfMetrics.DataSource"><Name>Process Monitoring: Internal datasource for subscribing for Process Data</Name><Description>Process Monitoring: Internal datasource for subscribing for Process Data</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.N"><Name>N</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.OrderBy"><Name>Order By</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.StartDate"><Name>Start Date</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses.EndDate"><Name>End Date</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses"><Name>Top N Processes</Name><Description>Top N Processes</Description></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.TopNProcesses"><Name>Top ##(N)## Processes</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.OrderBy"><Name>Order by ##(OrderBy)##</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.ComputerName"><Name>Computer Name</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.ProcessName"><Name>Process Name</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxCpuUsage"><Name>Max CPU Usage (Percent)</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxMemoryUsage"><Name>Max Memory Usage (Percent)</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxHandleCount"><Name>Max Handle Count Usage</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxThreadCount"><Name>Max Thread Count Usage</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxPageFaultCount"><Name>Max Page Fault Count</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxCpuTime"><Name>Max CPU Time</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxTotalProcessTime"><Name>Max Total Process Time</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxReadPerSecond"><Name>Max IO Read (KiloBytes/s)</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" SubElementID="R.MaxWritePerSecond"><Name>Max IO Write (KiloBytes/s)</Name></DisplayString><DisplayString ElementID="Microsoft.Windows.Server.10.0.GenerateAlertWriteAction"><Name>Process Monitoring: Generate Alert Write Action</Name><Description>Generate alert write action.</Description></DisplayString></DisplayStrings><KnowledgeArticles><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessSeed.Full.Discovery" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>Discovery of process and port monitoring seed objects of Windows Server 2016 Full. Note that this Management Pack is not supported on Nano Server.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessSeed.Core.Discovery" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>Discovery of Core process and port monitoring seed objects of Windows Server 2016 and above operating systems. Note that this Management Pack is not supported on Nano Server.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessHandleCount.Alert" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule generates an alert when handle count increases too fast.</maml:para><maml:para><maml:ui>Note:</maml:ui> If the threshold for this rule differs from the corresponding threshold for the "Process Monitoring: Health State Collection" rule, it may lead to inconsistency between alerts and process health states.
              </maml:para><maml:para>To avoid generating excessive alerts, a minimal threshold for the rule was implemented. The default value for minimal threshold is 15%. The threshold can be changed to any value via the overrides for the rule in the Operations Manager console, but if it is changed to a value lower than 15%, then the effective threshold will be 15% by default.</maml:para><maml:para>A user can change the minimal threshold by creating MinimalHandleCountIncreaseThreshold registry DWORD (32-bit) value on the appropriate agent and under the appropriate key. The effective threshold will be equal to maximum of two values: the default/overridden threshold via the Operations Manager console and the minimal threshold set in the registry.</maml:para><maml:para>The following registry key is used for the minimal threshold:</maml:para><maml:para>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Operations Manager\3.0\Modules\Global\BaseOSProcessMonitoring</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessPercentProcessorTime.Alert" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule generates an alert when processor time consumption by specific process is too high.</maml:para><maml:para><maml:ui>Note:</maml:ui> If the threshold for this rule differs from the corresponding threshold for the "Process Monitoring: Health State Collection" rule, it may lead to inconsistency between alerts and process health states.
              </maml:para><maml:para>To avoid generating excessive alerts, a minimal threshold for the rule was implemented. The default value for minimal threshold is 7%. The threshold can be changed to any value via the overrides for the rule in the Operations Manager console, but if it is changed to a value lower than 7%, then the effective threshold will be 7% by default.</maml:para><maml:para>A user can change the minimal threshold by creating MinimalPercentProcessorTimeThreshold registry DWORD (32-bit) value on the appropriate agent and under the appropriate key. The effective threshold will be equal to maximum of two values: the default/overridden threshold via the Operations Manager console and the minimal threshold set in the registry.</maml:para><maml:para>The following registry key is used for the minimal threshold:</maml:para><maml:para>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Operations Manager\3.0\Modules\Global\BaseOSProcessMonitoring</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMemoryPercentage.Alert" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule generates an alert when memory consumption by specific process is too high.</maml:para><maml:para><maml:ui>Note:</maml:ui> Note that if the threshold for this rule differs from the corresponding threshold for the "Process Monitoring: Health State Collection" rule, it may lead to inconsistency between alerts and process health states.
              </maml:para><maml:para>To avoid generating excessive alerts, a minimal threshold for the rule was implemented. The default value for minimal threshold is 7%. The threshold can be changed to any value via the overrides for the rule in the Operations Manager console, but if it is changed to a value lower than 7%, then the effective threshold will be 7% by default.</maml:para><maml:para>A user can change the minimal threshold by creating MinimalMemoryPercentageThreshold registry DWORD (32-bit) value on the appropriate agent and under the appropriate key. The effective threshold will be equal to maximum of two values: the default/overridden threshold via the Operations Manager console and the minimal threshold set in the registry.</maml:para><maml:para>The following registry key is used for the minimal threshold:</maml:para><maml:para>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Operations Manager\3.0\Modules\Global\BaseOSProcessMonitoring</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessCount.Collection" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule collects the Number of Processes performance counter for Windows Server 2016 and above operating systems.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.Process.HealthStateSubscription.Rule" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule saves Process and Port Health State information to the SCOM data warehouse. To start information collection, make sure that “Process and Port Monitoring: Health State Collection” rule is enabled.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetricsSubscription.Rule" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule saves Process and Port Performance Metric information to the SCOM data warehouse. To start information collection, make sure that “Process and Port Monitoring: Performance Collection” rule is enabled.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.Process.PortSubscription.Rule" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule saves Process Network Port information to the SCOM data warehouse. To start information collection, make sure that “Process and Port Monitoring: Network Port State Collection” rule is enabled.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.Process.HealthState.Collection" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule collects information about health state of the processes.</maml:para><maml:para><maml:ui>Note:</maml:ui> The thresholds for this rule should be overridden carefully; if the thresholds differ from those set for the alert rules, it may lead to inconsistency between alerts and process health states.
              </maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.Process.PerfMetrics.Collection" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule collects information about performance metric of the processes.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.Process.Ports.Collection" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule collects information about Network Port State of the ports.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This group contains seeds of Windows Server 2016 and above operating systems.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringDisabled.Group.Discovery" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which process monitoring is disabled via "Add Monitoring Wizard".</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This group contains seeds of Windows Server 2016 and above operating systems for which port monitoring is disabled.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.PortMonitoringDisabled.Group.Discovery" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which port monitoring is disabled via "Add Monitoring Wizard".</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Seed.Group" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This group contains process and port monitoring seeds of Windows Server 2016 and above operating systems.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringSeedGroup.ContainsProcessSeed" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>A relationship between Windows Server 2016 Process and Port Monitoring Seed Group and the process monitoring seeds.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.RunAs.CollectionRules" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This Run As profile is used for collecting metrics from the following process collection rules: "Process Monitoring: Network Port State Collection", "Process Monitoring: Performance Collection", and "Process Monitoring: Health State Collection" and for generating alerts for the following alert rules: "Process Monitoring: High Memory Percentage", "Process Monitoring: High Processor Time Percentage" and "Process Monitoring: High Handle Count".</maml:para><maml:para>Note: High-privilege "NT AUTHORITY\SYSTEM" account should be configured in SCOM for the Run As profile to receive the data regarding username and command line. If a non-system account is used (even with admin rights), the data mentioned above will not be collected properly, because it will be collected in low-privilege mode.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.ContainsWindowsServer.10.0.Computer" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>A relationship between Windows Server 2016 Enabled Process Monitoring Group and Windows Server 2016 computers.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.ContainsWindowsServer.10.0.Computer" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>A relationship between Windows Server 2016 Enabled Port Monitoring Group and Windows Server 2016 computers.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This group contains seeds related to Windows Server 2016 and above operating systems for which process monitoring is enabled.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This group contains seeds of Windows Server 2016 and above operating systems for which port monitoring is enabled.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringEnabled.Group.Discovery" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which process monitoring is enabled via "Add Monitoring Wizard".</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.PortMonitoringEnabled.Group.Discovery" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule populates the group containing seeds of Windows Server 2016 and above operating systems for which port monitoring is enabled via "Add Monitoring Wizard".</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.Views.Report.TopNProcesses" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para><maml:ui>How does this report work?</maml:ui></maml:para><maml:para>The Top N Processes report generates a table containing a top number (N) of the processes according to the following metrics:</maml:para><maml:list><maml:listItem><maml:para>CPU Usage</maml:para></maml:listItem><maml:listItem><maml:para>Memory Usage</maml:para></maml:listItem><maml:listItem><maml:para>Handle Count Usage</maml:para></maml:listItem><maml:listItem><maml:para>Thread Count</maml:para></maml:listItem><maml:listItem><maml:para>Page Fault Count</maml:para></maml:listItem><maml:listItem><maml:para>CPU Time</maml:para></maml:listItem><maml:listItem><maml:para>Total Process Time</maml:para></maml:listItem><maml:listItem><maml:para>IO Read (KiloBytes/s)</maml:para></maml:listItem><maml:listItem><maml:para>IO Write (KiloBytes/s)</maml:para></maml:listItem></maml:list><maml:para/><maml:para>The report table contains a list of records gradated according to the selected metric. The number of displayed records and the time interval can be set manually.</maml:para><maml:para><maml:ui>How to use this report?</maml:ui></maml:para><maml:list><maml:listItem><maml:para>1. Open the Reporting menu in the Operations Manager.</maml:para></maml:listItem><maml:listItem><maml:para>2. Go to Windows Server 2016 and above Process and Port Monitoring tab.</maml:para></maml:listItem><maml:listItem><maml:para>3. Run the Top N Processes report.</maml:para></maml:listItem><maml:listItem><maml:para>4. Select a metric to set an order for the table.</maml:para></maml:listItem><maml:listItem><maml:para>5. Select a number of the records in the table.</maml:para></maml:listItem><maml:listItem><maml:para>6. Select a time interval and the corresponding time zone for the report.</maml:para></maml:listItem><maml:listItem><maml:para>7. Click the Run button. The report data will be displayed.</maml:para></maml:listItem></maml:list></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoring.ProcessSeed" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>Process monitoring seed of Windows Server 2016 and above operating systems.</maml:para></maml:section></MamlContent></KnowledgeArticle><KnowledgeArticle ElementID="Microsoft.Windows.Server.10.0.ProcessMonitoringSeed.Group.Discovery" Visible="true"><MamlContent><maml:section xmlns:maml="http://schemas.microsoft.com/maml/2004/10"><maml:title>Summary</maml:title><maml:para>This rule populates the Process and Port Monitoring Seed Group of Windows Server 2016 and above operating systems.</maml:para></maml:section></MamlContent></KnowledgeArticle></KnowledgeArticles></LanguagePack><LanguagePack ID="CHS" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="CHT" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="DEU" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="ESN" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="FRA" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="HUN" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="ITA" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="JPN" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="KOR" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="NLD" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="PLK" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="PTB" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="PTG" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="RUS" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="SVE" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack><LanguagePack ID="TRK" IsDefault="false"><DisplayStrings><DisplayString ElementID="Microsoft.Windows.Server.2016.ProcessPortMonitoring"><Name>Windows Server 2016 and above Process and Port Monitoring</Name><Description>This Management Pack enables the monitoring of processes and ports of Microsoft Windows Server 2016 and above operating systems..</Description></DisplayString></DisplayStrings></LanguagePack></LanguagePacks><Resources><Assembly ID="Res.Microsoft.Windows.Server.2016.Assembly.UI" Accessibility="Public" FileName="Microsoft.Windows.Server.2016.UI.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.2016.UI, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/><Assembly ID="Res.Microsoft.Windows.Server.2016.Assembly.Components.WPF" Accessibility="Internal" FileName="Microsoft.Windows.Server.2016.Components.WPF.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.2016.Components.WPF, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/><Assembly ID="Res.Microsoft.Windows.Server.2016.Assembly.Visualization.DataProviders.Assembly" Accessibility="Public" FileName="Microsoft.Windows.Server.2016.Visualization.DataProviders.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.2016.Visualization.DataProviders, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/><ReportResource ID="ProcessMonitoring.Microsoft.Window.Server.GetAllProcessDimension.InstallUpdateScript" Accessibility="Internal" FileName="ProcessMonitoring_Microsoft_Window_Server_GetAllProcessDimension_CreateAlter.sql" HasNullStream="false" MIMEType="application/octet-stream"/><ReportResource ID="ProcessMonitoring.Microsoft.Window.Server.GetAllProcessDimension.DropScript" Accessibility="Internal" FileName="ProcessMonitoring_Microsoft_Window_Server_GetAllProcessDimension_Drop.sql" HasNullStream="false" MIMEType="application/octet-stream"/><ReportResource ID="ProcessMonitoring.Microsoft.Window.Server.GetPortState.InstallUpdateScript" Accessibility="Internal" FileName="ProcessMonitoring.Microsoft_Window_Server_GetPortState.sql" HasNullStream="false" MIMEType="application/octet-stream"/><ReportResource ID="ProcessMonitoring.Microsoft.Window.Server.GetProcessMetricAndState.InstallUpdateScript" Accessibility="Internal" FileName="ProcessMonitoring.Microsoft_Window_Server_GetProcessMetricAndState.sql" HasNullStream="false" MIMEType="application/octet-stream"/><ReportResource ID="ProcessMonitoring.Microsoft.Window.Server.GetTopNProcesses.InstallUpdateScript" Accessibility="Internal" FileName="ProcessMonitoring.Microsoft_Window_Server_GetTopNProcesses.sql" HasNullStream="false" MIMEType="application/octet-stream"/><ReportResource ID="ProcessMonitoring.Microsoft.Window.Server.DashboardSP.DropScript" Accessibility="Internal" FileName="ProcessMonitoring.Microsoft_Window_Server_SP_Drop.sql" HasNullStream="false" MIMEType="application/octet-stream"/><ReportResource ID="Microsoft.Windows.Server.10.0.ProcessMonitoring.TopNProcesses.rdl" Accessibility="Internal" FileName="TopNProcesses.rdl" HasNullStream="false" MIMEType="application/octet-stream"/><DeployableAssembly ID="Microsoft.Windows.Server.NativeApi.Assembly" Accessibility="Public" FileName="Microsoft.Windows.Server.NativeApi.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.NativeApi, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/><DeployableAssembly ID="Microsoft.Windows.Server.ProcessMonitoring.Common.Assembly" Accessibility="Public" FileName="Microsoft.Windows.Server.ProcessMonitoring.Common.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.ProcessMonitoring.Common, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/><DeployableAssembly ID="Microsoft.Windows.Server.Common.Loggers.Assembly" Accessibility="Public" FileName="Microsoft.Windows.Server.Common.Loggers.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.Common.Loggers, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/><DeployableAssembly ID="Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly" Accessibility="Public" FileName="Microsoft.Windows.Server.ProcessMonitoring.DataTypes.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.ProcessMonitoring.DataTypes, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"><Dependency ID="Microsoft.Windows.Server.ProcessMonitoring.Common.Assembly"/></DeployableAssembly><DeployableAssembly ID="Microsoft.Windows.Server.Monitoring.Providers.Assembly" Accessibility="Public" FileName="Microsoft.Windows.Server.Monitoring.Providers.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.Monitoring.Providers, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"><Dependency ID="Microsoft.Windows.Server.NativeApi.Assembly"/><Dependency ID="Microsoft.Windows.Server.ProcessMonitoring.Common.Assembly"/><Dependency ID="Microsoft.Windows.Server.Common.Loggers.Assembly"/></DeployableAssembly><DeployableAssembly ID="Microsoft.Windows.Server.2016.Modules.Assembly" Accessibility="Public" FileName="Microsoft.Windows.Server.2016.Modules.dll" HasNullStream="false" QualifiedName="Microsoft.Windows.Server.2016.Modules, Version=10.1.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"><Dependency ID="Microsoft.Windows.Server.NativeApi.Assembly"/><Dependency ID="Microsoft.Windows.Server.ProcessMonitoring.Common.Assembly"/><Dependency ID="Microsoft.Windows.Server.Common.Loggers.Assembly"/><Dependency ID="Microsoft.Windows.Server.ProcessMonitoring.DataTypes.Assembly"/><Dependency ID="Microsoft.Windows.Server.Monitoring.Providers.Assembly"/></DeployableAssembly></Resources></ManagementPack>
